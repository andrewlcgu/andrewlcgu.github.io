<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Andrewlcgu&#39;s Blog</title>
  
  <subtitle>人生如梦</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-02-04T09:27:34.082Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>andrewlcgu</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android-ClassLoader学习记录</title>
    <link href="http://yoursite.com/2020/02/03/classloader/"/>
    <id>http://yoursite.com/2020/02/03/classloader/</id>
    <published>2020-02-03T11:51:23.000Z</published>
    <updated>2020-02-04T09:27:34.082Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x7C7B;&#x52A0;&#x8F7D;&#x7B80;&#x8FF0;">&#x7C7B;&#x52A0;&#x8F7D;&#x7B80;&#x8FF0;</a></li><li><a href="#android&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x4E3B;&#x8981;&#x76F8;&#x5173;&#x7C7B;">Android&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x4E3B;&#x8981;&#x76F8;&#x5173;&#x7C7B;</a></li><li><a href="#&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;">&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;</a></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><h2 id="&#x7C7B;&#x52A0;&#x8F7D;&#x7B80;&#x8FF0;"><a href="#&#x7C7B;&#x52A0;&#x8F7D;&#x7B80;&#x8FF0;" class="headerlink" title="&#x7C7B;&#x52A0;&#x8F7D;&#x7B80;&#x8FF0;"></a>&#x7C7B;&#x52A0;&#x8F7D;&#x7B80;&#x8FF0;</h2><p>&#x865A;&#x62DF;&#x673A;&#x628A;&#x63CF;&#x8FF0;&#x6570;&#x636E;&#x7684;&#x5B57;&#x8282;&#x7801;&#x6587;&#x4EF6;&#x52A0;&#x8F7D;&#x5230;&#x5185;&#x5B58;&#xFF0C;&#x5E76;&#x5BF9;&#x6570;&#x636E;&#x8FDB;&#x884C;&#x6821;&#x9A8C;&#x3001;&#x8F6C;&#x6362;&#x89E3;&#x6790;&#x548C;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6700;&#x7EC8;&#x5F62;&#x6210;&#x88AB;&#x865A;&#x62DF;&#x673A;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7684;class&#x7C7B;&#x578B;&#x3002;</p><h2 id="android&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x4E3B;&#x8981;&#x76F8;&#x5173;&#x7C7B;"><a href="#Android&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x4E3B;&#x8981;&#x76F8;&#x5173;&#x7C7B;" class="headerlink" title="Android&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x4E3B;&#x8981;&#x76F8;&#x5173;&#x7C7B;"></a>Android&#x7C7B;&#x52A0;&#x8F7D;&#x7684;&#x4E3B;&#x8981;&#x76F8;&#x5173;&#x7C7B;</h2><p><strong>&#x4EE5;Android 10&#x6E90;&#x7801;&#x4E3A;&#x4E3B;</strong></p><img src="/2020/02/03/classloader/class_loader.jpg"><a id="more"></a><ul><li><p><code>ClassLoader</code>&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x6E90;&#x7801;&#x4F4D;&#x4E8E;<code>java.lang</code>&#x5305;&#x4E0B;&#xFF0C;&#x662F;&#x6240;&#x6709;&#x52A0;&#x8F7D;&#x7C7B;&#x7684;&#x57FA;&#x7C7B;&#x3002;&#x5176;&#x6784;&#x9020;&#x51FD;&#x6570;&#x9700;&#x8981;&#x4F20;parent classloader&#xFF0C;&#x5982;&#x679C;&#x4F20;null&#xFF0C;&#x5219;&#x9ED8;&#x8BA4;&#x4E3A;<code>PathClassLoader</code>&#x3002;&#x5B9A;&#x4E49;&#x82E5;&#x5E72;&#x91CD;&#x8981;&#x51FD;&#x6570;&#xFF1A;</p><ul><li><code>loadClass</code> &#x5982;&#x4F55;&#x52A0;&#x8F7D;&#x6307;&#x5B9A;&#x7C7B;: &#x5B9A;&#x4E49;&#x4E86;&#x53CC;&#x4EB2;&#x59D4;&#x6D3E;&#x6A21;&#x578B;&#xFF0C;parent&#x52A0;&#x8F7D;&#x4E0D;&#x5230;&#x65F6;&#x624D;&#x4F1A;&#x4F7F;&#x7528;findClass&#xFF0C; &#x901A;&#x5E38;&#x4E0D;&#x8981;override&#x53BB;&#x8FDD;&#x80CC;&#x8BE5;&#x6A21;&#x578B;</li><li><code>findClass</code> &#x5982;&#x4F55;&#x67E5;&#x627E;&#x6307;&#x5B9A;&#x7C7B;: &#x5B50;&#x7C7B;&#x5B9E;&#x73B0;&#x901A;&#x5E38;&#x9700;override&#x8BE5;&#x65B9;&#x6CD5;</li><li><code>defineClass</code> &#x6839;&#x636E;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#x52A0;&#x8F7D;&#x7C7B;&#xFF0C;Android&#x4E2D;&#x4E0D;&#x5141;&#x8BB8;&#x4F7F;&#x7528;</li></ul></li><li><p><code>BootClassLoader</code>&#x7EE7;&#x627F;<code>ClassLoader</code>&#xFF0C;&#x6E90;&#x7801;&#x4F4D;&#x4E8E;<code>java.lang</code>&#x5305;&#x4E0B;&#xFF0C;&#x6240;&#x6709;&#x52A0;&#x8F7D;&#x7C7B;&#x7684;parent&#xFF0C;&#x8D1F;&#x8D23;&#x52A0;&#x8F7D;&#x7CFB;&#x7EDF;&#x7C7B;&#x548C;Framework&#x7C7B;&#x7B49;: &#x8FD9;&#x4FDD;&#x8BC1;&#x4E86;&#x7C7B;&#x4F3C;<code>String</code>&#x7C7B;&#x5FC5;&#x987B;&#x4F7F;&#x7528;&#x7CFB;&#x7EDF;&#x9884;&#x5148;&#x5B9A;&#x4E49;&#x597D;&#x7684;&#xFF0C;&#x4E0D;&#x5141;&#x8BB8;&#x81EA;&#x5B9A;&#x4E49;&#xFF0C;&#x63D0;&#x9AD8;&#x5B89;&#x5168;&#x6027;&#x3002;</p></li><li><p><code>BaseDexClassLoader</code>&#x662F;Android&#x4F7F;&#x7528;&#x7C7B;&#x52A0;&#x8F7D;&#x5668;&#x7684;&#x57FA;&#x7C7B;&#xFF0C;&#x4FDD;&#x8BC1;Android&#x53EA;&#x5141;&#x8BB8;&#x52A0;&#x8F7D;dex&#x7ED3;&#x6784;&#x5B57;&#x8282;&#x7801;&#x3002;</p><ul><li>&#x6784;&#x9020;&#x51FD;&#x6570;&#x4F20;&#x5165;&#x53D8;&#x91CF;dexPath&#xFF0C;&#x8868;&#x793A;&#x52A0;&#x8F7D;dex&#x6240;&#x5728;&#x8DEF;&#x5F84;&#xFF0C;&#x53EF;&#x4EE5;&#x591A;&#x8DEF;&#x5F84;&#x901A;&#x8FC7;<code>File.pathSeparator</code>&#x533A;&#x5206;;&#x5982;&#x679C;&#x662F;jar/apk&#x6587;&#x4EF6;&#xFF0C;&#x5176;&#x4E2D;&#x542B;&#x6709;*.dex&#x4E5F;&#x53EF;&#x4EE5;&#x3002;</li><li>&#x91CD;&#x8F7D;<code>findClass</code>&#x51FD;&#x6570;&#xFF0C;&#x771F;&#x6B63;&#x5B9E;&#x73B0;&#x67E5;&#x627E;&#x7684;&#x7C7B;&#x662F;<code>DexPathList</code></li></ul></li><li><p><code>PathClassLoader</code>&#x7EE7;&#x627F;<code>BaseDexClassLoader</code>,Android&#x7CFB;&#x7EDF;&#x4F7F;&#x7528;&#x8BE5;&#x7C7B;&#x52A0;&#x8F7D;&#x7CFB;&#x7EDF;&#x7C7B;&#x548C;&#x5E94;&#x7528;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x7CFB;&#x7EDF;&#x8BBE;&#x7F6E;&#x5176;dexPath&#x4E3A;<code>/data/app/&lt;packagename&gt;/*.apk</code>&#x3002;</p></li><li><p><code>DexClassLoader</code>&#x7EE7;&#x627F;<code>BaseDexClassLoader</code>,&#x63D0;&#x4F9B;&#x7ED9;&#x7B2C;&#x4E09;&#x65B9;&#x52A0;&#x8F7D;&#x6267;&#x884C;&#x5E94;&#x7528;&#x672A;&#x5B89;&#x88C5;&#x4EE3;&#x7801;&#x7684;&#x80FD;&#x529B;&#x3002;</p></li><li><p><code>DexPathList</code>&#x771F;&#x6B63;&#x5B9E;&#x73B0;&#x67E5;&#x627E;&#x7C7B;&#xFF1A;&#x6839;&#x636E;dexPath&#x628A;&#x6BCF;&#x4E2A;dex&#x6587;&#x4EF6;&#x5C01;&#x88C5;&#x6210;Element&#x5BF9;&#x8C61;&#xFF0C;&#x8FD9;&#x4E9B;Element&#x5BF9;&#x8C61;&#x6392;&#x5217;&#x6210;&#x6709;&#x5E8F;&#x6570;&#x7EC4;<code>dexElement</code>&#xFF0C;&#x4F9D;&#x6B21;&#x904D;&#x5386;&#x53BB;&#x67E5;&#x627E;&#x6307;&#x5B9A;&#x7C7B;&#xFF0C;&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;&#x81F3;<code>DexFile</code>&#x4E2D;<code>defineClassNative</code>&#x65B9;&#x6CD5;&#xFF0C;&#x901A;&#x8FC7;native&#x5B9E;&#x73B0;&#x7684;&#x3002;</p></li></ul><h2 id="&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;"><a href="#&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;" class="headerlink" title="&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;"></a>&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;</h2><ul><li><p><code>ZygoteInit</code>&#x7C7B;&#x6267;&#x884C;main&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x8C03;&#x7528;<code>preloadClasses()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4F5C;&#x7528;&#x662F;&#x9884;&#x52A0;&#x8F7D;<code>/system/etc/preloaded-classes</code>&#x4E2D;&#x58F0;&#x660E;&#x7684;&#x7C7B;&#xFF0C;&#x8FD9;&#x5305;&#x62EC;&#x7C7B;&#x4F3C;<code>java.lang</code>&#x5305;&#x7684;&#x57FA;&#x7840;&#x7C7B;&#x548C;<code>Activity</code>&#x7B49;&#x6846;&#x67B6;&#x7C7B;&#x7B49;&#xFF0C;&#x8FD9;&#x65F6;&#x5019;&#x4F1A;&#x521B;&#x5EFA;<code>BootClassLoader</code>&#x53BB;&#x52A0;&#x8F7D;&#x8FD9;&#x4E9B;&#x7C7B;&#x3002;</p></li><li><p><code>ZygoteInit</code>fork<code>SystemServer</code>&#x8FDB;&#x7A0B;&#x540E;&#xFF0C;&#x5728;<code>#handleSystemServerProcess</code>&#x65B9;&#x6CD5;&#x4E2D;&#x6700;&#x7EC8;&#x4F1A;&#x521B;&#x5EFA;<code>PathClassLoader</code></p></li></ul><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><ol><li><p>&#x6E90;&#x7801;</p></li><li><p><a href="https://developer.android.com/reference/dalvik/system/" target="_blank" rel="noopener">https://developer.android.com/reference/dalvik/system/</a></p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#类加载简述&quot;&gt;类加载简述&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#android类加载的主要相关类&quot;&gt;Android类加载的主要相关类&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#创建过程&quot;&gt;创建过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;类加载简述&quot;&gt;&lt;a href=&quot;#类加载简述&quot; class=&quot;headerlink&quot; title=&quot;类加载简述&quot;&gt;&lt;/a&gt;类加载简述&lt;/h2&gt;&lt;p&gt;虚拟机把描述数据的字节码文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成被虚拟机直接使用的class类型。&lt;/p&gt;
&lt;h2 id=&quot;Android类加载的主要相关类&quot;&gt;&lt;a href=&quot;#Android类加载的主要相关类&quot; class=&quot;headerlink&quot; title=&quot;Android类加载的主要相关类&quot;&gt;&lt;/a&gt;Android类加载的主要相关类&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;以Android 10源码为主&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&quot;/2020/02/03/classloader/class_loader.jpg&quot;&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>MVC、MVP和MVVM学习</title>
    <link href="http://yoursite.com/2020/01/26/mvc-mvp-mvvm/"/>
    <id>http://yoursite.com/2020/01/26/mvc-mvp-mvvm/</id>
    <published>2020-01-26T10:54:13.000Z</published>
    <updated>2020-02-04T14:52:17.258Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#mvc">MVC</a></li><li><a href="#mvp">MVP</a></li><li><a href="#mvvm">MVVM</a></li></ul><!-- tocstop --><p><strong>&#x8BB0;&#x5F55;&#x4E2A;&#x4EBA;&#x5BF9;Android&#x4E2D;&#x4E09;&#x79CD;&#x67B6;&#x6784;&#x7684;&#x7406;&#x89E3;</strong></p><h2 id="mvc"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><img src="/2020/01/26/mvc-mvp-mvvm/mvc.png"><table><thead><tr><th style="text-align:left">Component</th><th style="text-align:left">Explantation</th></tr></thead><tbody><tr><td style="text-align:left"><code>Model</code></td><td style="text-align:left">&#x8D1F;&#x8D23;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x548C;&#x6570;&#x636E;&#x64CD;&#x4F5C;</td></tr><tr><td style="text-align:left"><code>View</code></td><td style="text-align:left">&#x754C;&#x9762;,&#x901A;&#x5E38;&#x662F;XML</td></tr><tr><td style="text-align:left"><code>Controller</code></td><td style="text-align:left">&#x901A;&#x5E38;&#x662F;ACtivity&#x6216;&#x8005;Fragment</td></tr></tbody></table><table><thead><tr><th style="text-align:left"></th><th style="text-align:left"></th></tr></thead><tbody><tr><td style="text-align:left">&#x4F18;&#x70B9;</td><td style="text-align:left">&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x89E3;&#x8026;&#x3001;&#x5F00;&#x53D1;&#x6548;&#x7387;&#x9AD8;</td></tr><tr><td style="text-align:left">&#x7F3A;&#x70B9;</td><td style="text-align:left">Controller&#x4EE3;&#x7801;&#x91CF;&#x5927;&#x3001;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4E0D;&#x5BB9;&#x6613;&#x505A;</td></tr></tbody></table><a id="more"></a><h2 id="mvp"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h2><img src="/2020/01/26/mvc-mvp-mvvm/mvp.png"><table><thead><tr><th style="text-align:left">Component</th><th style="text-align:left">Explantation</th></tr></thead><tbody><tr><td style="text-align:left"><code>Model</code></td><td style="text-align:left">&#x8D1F;&#x8D23;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x548C;&#x6570;&#x636E;&#x64CD;&#x4F5C;,&#x53EA;&#x4E0E;<code>Presenter</code>&#x901A;&#x4FE1;</td></tr><tr><td style="text-align:left"><code>View</code></td><td style="text-align:left">&#x754C;&#x9762;,&#x901A;&#x5E38;&#x662F;XML&#x3001;Activity&#x3001;Fragment</td></tr><tr><td style="text-align:left"><code>Presenter</code></td><td style="text-align:left"><code>View</code>&#x548C;<code>Model</code>&#x4E4B;&#x95F4;&#x6240;&#x6709;&#x901A;&#x4FE1;&#x90FD;&#x9700;&#x901A;&#x8FC7;<code>Presenter</code></td></tr></tbody></table><table><thead><tr><th style="text-align:left"></th><th style="text-align:left"></th></tr></thead><tbody><tr><td style="text-align:left">&#x4F18;&#x70B9;</td><td style="text-align:left"><code>View</code>&#x548C;<code>Presenter</code>&#x90FD;&#x53EF;&#x590D;&#x7528;&#xFF1B;&#x4EE3;&#x7801;&#x53EF;&#x8BFB;&#x6027;&#x597D;&#xFF1B;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x4E0E;UI&#x5B8C;&#x5168;&#x9694;&#x79BB;&#xFF0C;&#x4FBF;&#x4E8E;&#x6D4B;&#x8BD5;</td></tr><tr><td style="text-align:left">&#x7F3A;&#x70B9;</td><td style="text-align:left"><code>View</code>&#x548C;<code>Presenter</code>&#x5F3A;&#x8026;&#x5408;&#x3001;&#x6BCF;&#x5C42;&#x4E4B;&#x95F4;&#x90FD;&#x9700;&#x8981;&#x5927;&#x91CF;&#x63A5;&#x53E3;&#x7528;&#x4E8E;&#x901A;&#x4FE1;&#xFF0C;&#x4EE3;&#x7801;&#x91CF;&#x589E;&#x5927;</td></tr></tbody></table><h2 id="mvvm"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><img src="/2020/01/26/mvc-mvp-mvvm/mvvm.png"><p>&#x611F;&#x89C9;&#x76F8;&#x6BD4;MVP&#x6700;&#x5927;&#x4E0D;&#x540C;&#x5C31;&#x662F;&#x6BCF;&#x5C42;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x8FDB;&#x884C;&#x901A;&#x4FE1;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x5927;&#x91CF;&#x63A5;&#x53E3;&#xFF0C;&#x4EE5;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x4EE3;&#x66FF;&#x3002;</p><table><thead><tr><th style="text-align:left">Component</th><th style="text-align:left">Explantation</th></tr></thead><tbody><tr><td style="text-align:left"><code>Model</code></td><td style="text-align:left">&#x8D1F;&#x8D23;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x548C;&#x6570;&#x636E;&#x64CD;&#x4F5C;&#xFF0C;&#x62BD;&#x8C61;&#x51FA;<code>Repository</code>&#x7528;&#x4E8E;&#x63A5;&#x6536;<code>ViewModel</code>&#x8BF7;&#x6C42;&#x5E76;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5904;&#x7406;</td></tr><tr><td style="text-align:left"><code>View</code></td><td style="text-align:left">&#x7EAF;&#x754C;&#x9762;&#x663E;&#x793A;&#xFF0C;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x901A;&#x77E5;&#x7ED9;<code>ViewModel</code>,&#x901A;&#x8FC7;&#x89C2;&#x5BDF;<code>ViewModel</code>&#x63D0;&#x4F9B;&#x7684;&#x88AB;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x54CD;&#x5E94;UI&#x53D8;&#x5316;</td></tr><tr><td style="text-align:left"><code>ViewModel</code></td><td style="text-align:left">&#x5927;&#x90E8;&#x5206;UI&#x903B;&#x8F91;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x4EE5;&#x6570;&#x636E;&#x9A71;&#x52A8;&#x63A7;&#x5236;UI&#x53D8;&#x5316;</td></tr></tbody></table><table><thead><tr><th style="text-align:left"></th><th style="text-align:left"></th></tr></thead><tbody><tr><td style="text-align:left">&#x4F18;&#x70B9;</td><td style="text-align:left"><code>View</code>&#x548C;<code>ViewModel</code>&#x677E;&#x8026;&#x5408;&#xFF0C;&#x6BCF;&#x5C42;&#x4E4B;&#x524D;&#x901A;&#x4FE1;&#x4E0D;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x5927;&#x91CF;&#x63A5;&#x53E3;&#xFF0C;&#x4FBF;&#x4E8E;&#x5355;&#x5143;&#x6D4B;&#x8BD5;</td></tr><tr><td style="text-align:left">&#x7F3A;&#x70B9;</td><td style="text-align:left">&#x6BCF;&#x4E2A;UI Component&#x90FD;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x4EE3;&#x7801;&#x91CF;&#x589E;&#x5927;</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#mvc&quot;&gt;MVC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#mvp&quot;&gt;MVP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#mvvm&quot;&gt;MVVM&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;p&gt;&lt;strong&gt;记录个人对Android中三种架构的理解&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;MVC&quot;&gt;&lt;a href=&quot;#MVC&quot; class=&quot;headerlink&quot; title=&quot;MVC&quot;&gt;&lt;/a&gt;MVC&lt;/h2&gt;&lt;img src=&quot;/2020/01/26/mvc-mvp-mvvm/mvc.png&quot;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Component&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;Explantation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;code&gt;Model&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;负责业务逻辑和数据操作&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;code&gt;View&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;界面,通常是XML&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;&lt;code&gt;Controller&lt;/code&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;通常是ACtivity或者Fragment&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;优点&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;业务逻辑解耦、开发效率高&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;缺点&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Controller代码量大、单元测试不容易做&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="Architecture" scheme="http://yoursite.com/categories/Architecture/"/>
    
    
      <category term="Android学习笔记" scheme="http://yoursite.com/tags/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>技术图吧</title>
    <link href="http://yoursite.com/2020/01/25/flow-chart-record/"/>
    <id>http://yoursite.com/2020/01/25/flow-chart-record/</id>
    <published>2020-01-25T15:11:26.000Z</published>
    <updated>2020-02-06T15:40:13.846Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#launcher&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x542F;&#x52A8;activity">Launcher&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x542F;&#x52A8;Activity</a></li><li><a href="#application&#x521B;&#x5EFA;">Application&#x521B;&#x5EFA;</a></li><li><a href="#android&#x542F;&#x52A8;&#x6D41;&#x7A0B;">Android&#x542F;&#x52A8;&#x6D41;&#x7A0B;</a></li><li><a href="#android&#x8D44;&#x6E90;&#x6253;&#x5305;&#x53CA;&#x6846;&#x67B6;">Android&#x8D44;&#x6E90;&#x6253;&#x5305;&#x53CA;&#x6846;&#x67B6;</a></li><li><a href="#jvm&#x7ED3;&#x6784;&#x7B80;&#x56FE;">JVM&#x7ED3;&#x6784;&#x7B80;&#x56FE;</a></li><li><a href="#android-view&#x7ED8;&#x5236;">Android View&#x7ED8;&#x5236;</a></li></ul><!-- tocstop --><p>&#x8BB0;&#x5F55;&#x7F51;&#x4E0A;&#x535A;&#x5BA2;&#x4E2D;&#x4E00;&#x4E9B;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x56FE;&#xFF0C;&#x4F9B;&#x5B66;&#x4E60;&#x4F7F;&#x7528;</p><a id="more"></a><h2 id="launcher&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x542F;&#x52A8;activity"><a href="#Launcher&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x542F;&#x52A8;Activity" class="headerlink" title="Launcher&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x542F;&#x52A8;Activity"></a>Launcher&#x70B9;&#x51FB;&#x56FE;&#x6807;&#x542F;&#x52A8;Activity</h2><img src="/2020/01/25/flow-chart-record/launch_activity_start_0.png"><h2 id="application&#x521B;&#x5EFA;"><a href="#Application&#x521B;&#x5EFA;" class="headerlink" title="Application&#x521B;&#x5EFA;"></a>Application&#x521B;&#x5EFA;</h2><img src="/2020/01/25/flow-chart-record/system_application.jpg"><img src="/2020/01/25/flow-chart-record/app_application.jpg"><h2 id="android&#x542F;&#x52A8;&#x6D41;&#x7A0B;"><a href="#Android&#x542F;&#x52A8;&#x6D41;&#x7A0B;" class="headerlink" title="Android&#x542F;&#x52A8;&#x6D41;&#x7A0B;"></a>Android&#x542F;&#x52A8;&#x6D41;&#x7A0B;</h2><img src="/2020/01/25/flow-chart-record/Android_start.png"><h2 id="android&#x8D44;&#x6E90;&#x6253;&#x5305;&#x53CA;&#x6846;&#x67B6;"><a href="#Android&#x8D44;&#x6E90;&#x6253;&#x5305;&#x53CA;&#x6846;&#x67B6;" class="headerlink" title="Android&#x8D44;&#x6E90;&#x6253;&#x5305;&#x53CA;&#x6846;&#x67B6;"></a>Android&#x8D44;&#x6E90;&#x6253;&#x5305;&#x53CA;&#x6846;&#x67B6;</h2><img src="/2020/01/25/flow-chart-record/asset_arthitecture.jpeg"><ul><li>&#x8D44;&#x6E90;ID&#x662F;&#x4E00;&#x4E2A;4&#x5B57;&#x8282;&#x7684;&#x65E0;&#x7B26;&#x53F7;&#x6574;&#x6570;&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;&#x6700;&#x9AD8;&#x5B57;&#x8282;&#x8868;&#x793A;Package  ID&#xFF0C;&#x6B21;&#x9AD8;&#x5B57;&#x8282;&#x8868;&#x793A;Type ID&#xFF0C;&#x6700;&#x4F4E;&#x4E24;&#x5B57;&#x8282;&#x8868;&#x793A;Entry ID&#x3002;Package ID&#x76F8;&#x5F53;&#x4E8E;&#x662F;&#x4E00;&#x4E2A;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#xFF0C;&#x9650;&#x5B9A;&#x8D44;&#x6E90;&#x7684;&#x6765;&#x6E90;&#x3002;Android&#x7CFB;&#x7EDF;&#x5F53;&#x524D;&#x5B9A;&#x4E49;&#x4E86;&#x4E24;&#x4E2A;&#x8D44;&#x6E90;&#x547D;&#x4EE4;&#x7A7A;&#x95F4;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x7CFB;&#x7EDF;&#x8D44;&#x6E90;&#x547D;&#x4EE4;&#x7A7A;&#x95F4;&#xFF0C;&#x5B83;&#x7684;Package ID&#x7B49;&#x4E8E;0x01&#xFF0C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8D44;&#x6E90;&#x547D;&#x4EE4;&#x7A7A;&#x95F4;&#xFF0C;&#x5B83;&#x7684;Package ID&#x7B49;&#x4E8E;0x7f&#x3002;&#x6240;&#x6709;&#x4F4D;&#x4E8E;[0x01, 0x7f]&#x4E4B;&#x95F4;&#x7684;Package ID&#x90FD;&#x662F;&#x5408;&#x6CD5;&#x7684;&#xFF0C;&#x800C;&#x5728;&#x8FD9;&#x4E2A;&#x8303;&#x56F4;&#x4E4B;&#x5916;&#x7684;&#x90FD;&#x662F;&#x975E;&#x6CD5;&#x7684;Package ID&#x3002;</li></ul><h2 id="jvm&#x7ED3;&#x6784;&#x7B80;&#x56FE;"><a href="#JVM&#x7ED3;&#x6784;&#x7B80;&#x56FE;" class="headerlink" title="JVM&#x7ED3;&#x6784;&#x7B80;&#x56FE;"></a>JVM&#x7ED3;&#x6784;&#x7B80;&#x56FE;</h2><img src="/2020/01/25/flow-chart-record/jvm_structure.jpg"><h2 id="android-view&#x7ED8;&#x5236;"><a href="#Android-View&#x7ED8;&#x5236;" class="headerlink" title="Android View&#x7ED8;&#x5236;"></a>Android View&#x7ED8;&#x5236;</h2><img src="/2020/01/25/flow-chart-record/android-vsync.jpg"><img src="/2020/01/25/flow-chart-record/android-measure.jpg"><img src="/2020/01/25/flow-chart-record/android-layout.jpg"><img src="/2020/01/25/flow-chart-record/android-draw.jpg">]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#launcher点击图标启动activity&quot;&gt;Launcher点击图标启动Activity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#application创建&quot;&gt;Application创建&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#android启动流程&quot;&gt;Android启动流程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#android资源打包及框架&quot;&gt;Android资源打包及框架&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#jvm结构简图&quot;&gt;JVM结构简图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#android-view绘制&quot;&gt;Android View绘制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;p&gt;记录网上博客中一些比较好的图，供学习使用&lt;/p&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Map学习</title>
    <link href="http://yoursite.com/2020/01/16/Map-study/"/>
    <id>http://yoursite.com/2020/01/16/Map-study/</id>
    <published>2020-01-16T15:46:41.000Z</published>
    <updated>2020-02-12T14:49:06.450Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#hashmap">HashMap</a></li><li><a href="#linkedhashmap">LinkedHashMap</a></li><li><a href="#weakhashmap">WeakHashMap</a></li><li><a href="#&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;map">&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;Map</a><ul><li><a href="#1-hashtablecollectionssynchronizedmap">1. HashTable/Collections.synchronizedMap()</a></li><li><a href="#2-concurrenthashmap">2. ConcurrentHashMap</a></li></ul></li><li><a href="#android&#x7279;&#x6709;map">Android&#x7279;&#x6709;Map</a><ul><li><a href="#arraymap">ArrayMap</a></li><li><a href="#sparsearray">SparseArray</a></li></ul></li></ul><!-- tocstop --><h2 id="hashmap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>&#x4EE5;Java1.8&#x6E90;&#x7801;&#x4E3A;&#x51C6;&#xFF0C;&#x5176;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;&#xFF1A;</p><img src="/2020/01/16/Map-study/table-structure.png"><ul><li><strong>&#x9ED8;&#x8BA4;&#x503C;</strong></li></ul><table><thead><tr><th style="text-align:left">&#x5E38;&#x91CF;&#x540D;</th><th style="text-align:left">&#x89E3;&#x91CA;</th><th style="text-align:left">&#x9ED8;&#x8BA4;&#x503C;</th></tr></thead><tbody><tr><td style="text-align:left">DEFAULT_INITIAL_CAPACITY</td><td style="text-align:left">&#x521D;&#x59CB;&#x5BB9;&#x91CF;</td><td style="text-align:left">1 &lt;&lt; 4(16)</td></tr><tr><td style="text-align:left">MAXIMUM_CAPACITY</td><td style="text-align:left">&#x6700;&#x5927;&#x5BB9;&#x91CF;</td><td style="text-align:left">1 &lt;&lt; 30</td></tr><tr><td style="text-align:left">DEFAULT_LOAD_FACTOR</td><td style="text-align:left">&#x8D1F;&#x8F7D;&#x7CFB;&#x6570;</td><td style="text-align:left">0.75</td></tr><tr><td style="text-align:left">TREEIFY_THRESHOLD</td><td style="text-align:left">&#x8D85;&#x8FC7;&#x8BE5;&#x503C;&#x7684;&#x94FE;&#x8868;&#x6539;&#x7528;&#x7EA2;&#x9ED1;&#x6811;&#x5B58;&#x50A8;</td><td style="text-align:left">8</td></tr><tr><td style="text-align:left">UNTREEIFY_THRESHOLD</td><td style="text-align:left">resize&#x65F6;,&#x5982;&#x679C;&#x7EA2;&#x9ED1;&#x6811;&#x5B58;&#x50A8;&#x7684;&#x8282;&#x70B9;&#x6570;&#x5C0F;&#x4E8E;&#x8BE5;&#x503C;&#x5219;&#x4F7F;&#x7528;&#x94FE;&#x8868;&#x5B58;&#x50A8;</td><td style="text-align:left">6</td></tr><tr><td style="text-align:left">MIN_TREEIFY_CAPACITY</td><td style="text-align:left">&#x94FE;&#x8868;&#x8282;&#x70B9;&#x6570;&#x5927;&#x4E8E;8&#x4E2A;&#x65F6;&#xFF0C;&#x5148;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x5B58;&#x50A8;&#x7684;mapping&#x6570;&#x662F;&#x5426;&#x5927;&#x4E8E;&#x8BE5;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x5C0F;&#x4E8E;&#x5219;resize&#xFF0C;&#x5927;&#x4E8E;&#x5219;&#x6539;&#x7528;&#x7EA2;&#x9ED1;&#x6811;</td><td style="text-align:left">64</td></tr></tbody></table><a id="more"></a><ul><li><strong>Node</strong></li></ul><img src="/2020/01/16/Map-study/node_hash_map.png"><ol><li><p>hash&#x5982;&#x4F55;&#x6C42;&#xFF1F; </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HashMap#hash(Object key) {</span><br><span class="line">   <span class="keyword">int</span> h;</span><br><span class="line">   <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li><li><p>table&#x5927;&#x5C0F;&#x662F;2^n,&#x597D;&#x5904;&#x662F;&#x6C42;&#x4E0B;&#x6807;: <code>(table.length - 1) &amp; hash</code></p></li><li><p>&#x5982;&#x679C;&#x8D85;&#x8FC7;&#x8D1F;&#x8F7D;&#x7CFB;&#x6570;x&#x5BB9;&#x91CF;&#xFF0C;&#x5219;resize();&#x5176;&#x539F;&#x7406;&#x56FE;:</p></li></ol><img src="/2020/01/16/Map-study/hashmap_resize.png">}<br><br>4. &#x5141;&#x8BB8;key/value&#x4E3A;null,&#x975E;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;<br><br>5. <code>HashSet</code>&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x662F;<code>HashMap</code>,key&#x662F;&#x96C6;&#x5408;&#x5143;&#x7D20;e&#xFF0C;value&#x662F;dummy object<br><br>## LinkedHashMap<br><br><img src="/2020/01/16/Map-study/LinkedHashMap.webp"><p>&#x7EE7;&#x627F;HashMap,&#x5E95;&#x5C42;&#x901A;&#x8FC7;&#x53CC;&#x5411;&#x94FE;&#x8868;&#x5B58;&#x50A8;&#x987A;&#x5E8F;;&#x6392;&#x5E8F;&#x65B9;&#x5F0F;&#x6709;&#x4E24;&#x79CD;:</p><ul><li>&#x6839;&#x636E;&#x5199;&#x5165;&#x987A;&#x5E8F;&#x6392;&#x5E8F;</li><li>&#x6839;&#x636E;&#x8BBF;&#x95EE;&#x987A;&#x5E8F;&#x6392;&#x5E8F;</li></ul><p>&#x901A;&#x8FC7;<code>accessOrder</code>&#x6210;&#x5458;&#x53D8;&#x91CF;&#x6807;&#x8BC6;&#xFF0C;&#x5176;&#x4E2D;&#x6839;&#x636E;&#x8BBF;&#x95EE;&#x987A;&#x5E8F;&#x6392;&#x5E8F;&#x65F6;&#xFF0C;&#x6BCF;&#x6B21; get &#x90FD;&#x4F1A;&#x5C06;&#x8BBF;&#x95EE;&#x7684;&#x503C;&#x79FB;&#x52A8;&#x5230;&#x94FE;&#x8868;&#x672B;&#x5C3E;&#xFF0C;&#x901A;&#x8FC7;&#x8BE5;&#x6027;&#x8D28;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;LruCache</p><h2 id="weakhashmap"><a href="#WeakHashMap" class="headerlink" title="WeakHashMap"></a>WeakHashMap</h2><p>&#x4E0E;HashMap&#x7C7B;&#x4F3C;,&#x4E0D;&#x540C;&#x4E4B;&#x5904;&#x5728;Key&#x662F;&#x5F31;&#x5F15;&#x7528;&#x7684;,&#x5B9E;&#x73B0;&#x5173;&#x952E;&#x662F;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">Object</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>{...}</span><br></pre></td></tr></table></figure></p><p>&#x5728;<code>get/put</code>&#x7B49;&#x64CD;&#x4F5C;&#x4E2D;&#x4F1A;&#x9996;&#x5148;&#x8C03;&#x7528;<code>expungeStaleEntries()</code>,&#x6839;&#x636E;<code>ReferenceQueue</code>&#x6E05;&#x9664;&#x65E0;&#x7528;&#x7684;Entry</p><h2 id="&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;map"><a href="#&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;Map" class="headerlink" title="&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;Map"></a>&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;Map</h2><h3 id="1-hashtablecollectionssynchronizedmap"><a href="#1-HashTable-Collections-synchronizedMap" class="headerlink" title="1. HashTable/Collections.synchronizedMap()"></a>1. HashTable/Collections.synchronizedMap()</h3><p>&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF0C;&#x91C7;&#x7528;synchronized&#x65B9;&#x6CD5;&#x4E0A;&#x52A0;&#x9501;&#xFF0C;&#x4F7F;&#x7528;&#x963B;&#x585E;&#x540C;&#x6B65;&#xFF0C;&#x6548;&#x7387;&#x4F4E;</p><h3 id="2-concurrenthashmap"><a href="#2-ConcurrentHashMap" class="headerlink" title="2. ConcurrentHashMap"></a>2. ConcurrentHashMap</h3><p>&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E0E;HashMap&#x76F8;&#x540C;,&#x91C7;&#x7528;CAS(CompareAndSwap,&#x539F;&#x5B50;&#x64CD;&#x4F5C;)&#x548C;synchronized&#x4FDD;&#x8BC1;&#x5E76;&#x53D1;&#x5B89;&#x5168;,CAS&#x7528;&#x4E8E;Entry&#x6570;&#x7EC4;&#x6307;&#x5B9A;&#x4F4D;&#x7F6E;&#x7B2C;&#x4E00;&#x4E2A;&#x8282;&#x70B9;&#x7684;&#x63D2;&#x5165;&#xFF0C;synchronized&#x7528;&#x4E8E;&#x9501;&#x5B9A;&#x5F53;&#x524D;&#x94FE;&#x8868;&#x6216;&#x7EA2;&#x9ED1;&#x4E8C;&#x53C9;&#x6811;&#x7684;&#x9996;&#x8282;&#x70B9;</p><img src="/2020/01/16/Map-study/concurrent_hash_map.webp"><h2 id="android&#x7279;&#x6709;map"><a href="#Android&#x7279;&#x6709;Map" class="headerlink" title="Android&#x7279;&#x6709;Map"></a>Android&#x7279;&#x6709;Map</h2><h3 id="arraymap"><a href="#ArrayMap" class="headerlink" title="ArrayMap"></a>ArrayMap</h3><p>ArrayMap&#x662F;Android&#x4E13;&#x95E8;&#x9488;&#x5BF9;&#x5185;&#x5B58;&#x4F18;&#x5316;&#x800C;&#x8BBE;&#x8BA1;&#x7684;&#xFF0C;&#x7528;&#x4E8E;&#x53D6;&#x4EE3;Java API&#x4E2D;&#x7684;HashMap&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x5176;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;:</p><img src="/2020/01/16/Map-study/array_map.jpg"><ul><li><p>&#x91C7;&#x7528;&#x4E24;&#x4E2A;&#x6570;&#x7EC4;&#x5B58;&#x50A8;: <code>mHashes</code>&#x5B58;&#x50A8;key&#x7684;hash&#x503C;,&#x6309;&#x589E;&#x5E8F;&#x5B58;&#x50A8;,&#x901A;&#x8FC7;&#x4E8C;&#x5206;&#x67E5;&#x627E;&#x6307;&#x5B9A;key&#x503C;&#x7684;&#x6570;&#x7EC4;&#x4E0B;&#x6807;;&#x6839;&#x636E;<code>mHashes</code>&#x6307;&#x5B9A;&#x4E0B;&#x6807;&#x5728;<code>mArray</code>&#x4E2D;&#x8BBF;&#x95EE;key/value. &#x5185;&#x5B58;&#x4F7F;&#x7528;&#x76F8;&#x6BD4;HashMap&#x8282;&#x7701;&#xFF0C;&#x67E5;&#x627E;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;O(logN),&#x5E76;&#x4E14;&#x589E;&#x52A0;/&#x5220;&#x9664;&#x65F6;&#x9700;&#x8981;&#x6570;&#x7EC4;copy&#xFF0C;&#x901F;&#x5EA6;&#x76F8;&#x5BF9;&#x8F83;&#x6162;&#xFF0C;size&#x5C0F;&#x4E8E;1k&#x65F6;&#x57FA;&#x672C;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#x3002;</p></li><li><p>&#x76F8;&#x6BD4;HashMap&#xFF1A;ArrayMap&#x5728;&#x5BB9;&#x91CF;&#x6EE1;&#x7684;&#x65F6;&#x673A;&#x89E6;&#x53D1;&#x5BB9;&#x91CF;&#x6269;&#x5927;&#x81F3;&#x539F;&#x6765;&#x7684;1.5&#x500D;&#xFF0C;&#x5728;&#x5BB9;&#x91CF;&#x4E0D;&#x8DB3;1/3&#x65F6;&#x89E6;&#x53D1;&#x5185;&#x5B58;&#x6536;&#x7F29;&#xFF0C;&#x66F4;&#x8282;&#x7701;&#x5185;&#x5B58;&#xFF1B;&#x6709;&#x7F13;&#x5B58;&#x673A;&#x5236;&#xFF0C;&#x907F;&#x514D;&#x9891;&#x7E41;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x800C;&#x5206;&#x914D;&#x5185;&#x5B58;&#x4E0E;GC&#x64CD;&#x4F5C;</p></li><li><p>&#x975E;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;</p></li></ul><h3 id="sparsearray"><a href="#SparseArray" class="headerlink" title="SparseArray"></a>SparseArray</h3><p>SparseArray&#x662F;Android&#x9488;&#x5BF9;key&#x4E3A;int&#x800C;&#x8BBE;&#x8BA1;&#x7684;Map,&#x6CE8;&#x610F;&#x8BE5;&#x7C7B;&#x5E76;&#x6CA1;&#x6709;&#x5B9E;&#x73B0;Map&#x63A5;&#x53E3;&#x3002;&#x5176;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x5982;&#x4E0B;:</p><img src="/2020/01/16/Map-study/sparse_array.jpg"><ul><li><p>&#x76F8;&#x6BD4;HashMap: &#x6570;&#x7EC4;&#x5B58;&#x50A8;&#x8282;&#x7701;&#x5185;&#x5B58;&#xFF0C;&#x56E0;&#x65E0;&#x9700;&#x5BF9;int&#x8FDB;&#x884C;&#x88C5;&#x7BB1;&#x64CD;&#x4F5C;&#xFF0C;size&#x8F83;&#x5C0F;&#x65F6;&#x6027;&#x80FD;&#x8F83;&#x597D;</p></li><li><p>&#x975E;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;</p></li><li><p><code>SparseIntArray</code>&#x3001;<code>SparseBooleanArray</code>&#x3001;<code>SparseLongArray</code>&#x4E0E;<code>SparseArray</code>&#x7C7B;&#x4F3C;&#xFF0C;&#x552F;&#x4E00;&#x533A;&#x522B;&#x662F;&#x6307;&#x5B9A;value&#x7C7B;&#x578B;&#xFF0C;&#x5176;value&#x65E0;&#x9700;&#x88C5;&#x7BB1;</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#hashmap&quot;&gt;HashMap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#linkedhashmap&quot;&gt;LinkedHashMap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#weakhashmap&quot;&gt;WeakHashMap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#线程安全的map&quot;&gt;线程安全的Map&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-hashtablecollectionssynchronizedmap&quot;&gt;1. HashTable/Collections.synchronizedMap()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-concurrenthashmap&quot;&gt;2. ConcurrentHashMap&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#android特有map&quot;&gt;Android特有Map&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#arraymap&quot;&gt;ArrayMap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#sparsearray&quot;&gt;SparseArray&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;HashMap&quot;&gt;&lt;a href=&quot;#HashMap&quot; class=&quot;headerlink&quot; title=&quot;HashMap&quot;&gt;&lt;/a&gt;HashMap&lt;/h2&gt;&lt;p&gt;以Java1.8源码为准，其数据结构如下：&lt;/p&gt;
&lt;img src=&quot;/2020/01/16/Map-study/table-structure.png&quot;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;默认值&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;常量名&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;解释&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;默认值&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;DEFAULT_INITIAL_CAPACITY&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;初始容量&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;1 &amp;lt;&amp;lt; 4(16)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;MAXIMUM_CAPACITY&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;最大容量&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;1 &amp;lt;&amp;lt; 30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;DEFAULT_LOAD_FACTOR&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;负载系数&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;0.75&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;TREEIFY_THRESHOLD&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;超过该值的链表改用红黑树存储&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;8&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;UNTREEIFY_THRESHOLD&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;resize时,如果红黑树存储的节点数小于该值则使用链表存储&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;MIN_TREEIFY_CAPACITY&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;链表节点数大于8个时，先判断当前存储的mapping数是否大于该值，如果小于则resize，大于则改用红黑树&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;64&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="算法与数据结构" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="算法与数据结构" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>JetPack-ViewModel</title>
    <link href="http://yoursite.com/2019/09/30/JetPack-ViewModel/"/>
    <id>http://yoursite.com/2019/09/30/JetPack-ViewModel/</id>
    <published>2019-09-30T07:40:27.000Z</published>
    <updated>2019-10-11T02:23:41.842Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x7B80;&#x4ECB;">&#x7B80;&#x4ECB;</a></li><li><a href="#&#x5B9E;&#x73B0;&#x539F;&#x7406;">&#x5B9E;&#x73B0;&#x539F;&#x7406;</a></li><li><a href="#&#x8BA8;&#x8BBA;">&#x8BA8;&#x8BBA;</a></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><h2 id="&#x7B80;&#x4ECB;"><a href="#&#x7B80;&#x4ECB;" class="headerlink" title="&#x7B80;&#x4ECB;"></a>&#x7B80;&#x4ECB;</h2><p>&#x6839;&#x636E;&#x5B98;&#x7F51;&#x4ECB;&#x7ECD;<code>ViewModel</code>&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;</p><blockquote><p>The <code>ViewModel</code> class is designed to store and manage UI-related data in a lifecycle conscious way. The ViewModel class allows data to survive configuration changes such as screen rotations.<br>&#x5176;&#x751F;&#x547D;&#x5468;&#x671F;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;(&#x4EE5;<code>Activity</code>&#x4E3A;&#x4F8B;,<code>Fragment</code>&#x662F;<code>OnCreate()</code>&#x81F3;<code>OnDetach()</code>):</p></blockquote><img src="/2019/09/30/JetPack-ViewModel/viewmodel-lifecycle.png"><p>Activity/Fragment&#x88AB;&#x8BA4;&#x4E3A;&#x662F;UI Controller, ViewModel&#x628A;UI&#x65E0;&#x5173;&#x7684;&#x903B;&#x8F91;&#x64CD;&#x4F5C;&#x8FDB;&#x884C;&#x5C01;&#x88C5;,&#x6240;&#x4EE5;ViewModel&#x4E0D;&#x5EFA;&#x8BAE;&#x6301;&#x6709;View/Lifecycle/Activity&#x7B49;&#x5BF9;&#x8C61;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;Context&#xFF0C;&#x4F7F;&#x7528;<code>AndroidViewModel</code>&#xFF0C;&#x5176;&#x6301;&#x6709;<code>Application</code>&#x5F15;&#x7528;&#x3002;</p><a id="more"></a><h2 id="&#x5B9E;&#x73B0;&#x539F;&#x7406;"><a href="#&#x5B9E;&#x73B0;&#x539F;&#x7406;" class="headerlink" title="&#x5B9E;&#x73B0;&#x539F;&#x7406;"></a>&#x5B9E;&#x73B0;&#x539F;&#x7406;</h2><p>&#x4E3B;&#x8981;&#x5728;<code>lifecycle-extensions</code>&#x548C;<code>lifecycle-viewmodel</code>&#x8FD9;&#x4E24;&#x4E2A;&#x5305;&#x3002;</p><ul><li><p>&#x4E00;&#x4E2A;<code>Activity/Fragment</code>&#x53EF;&#x4EE5;&#x5173;&#x8054;&#x591A;&#x4E2A;<code>ViewModel</code>&#xFF0C;&#x5176;&#x901A;&#x8FC7;<code>ViewModelStore</code>&#x8FDB;&#x884C;&#x5173;&#x8054;&#xFF0C;&#x5728;&#x6700;&#x65B0;&#x652F;&#x6301;&#x5305;&#x4E2D;<code>Activity</code>&#x6301;&#x6709;&#x4E00;&#x4E2A;<code>ViewModelStore</code>&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x800C;<code>Fragment</code>&#x662F;&#x901A;&#x8FC7;&#x5916;&#x9762;<code>Activity</code>&#x5173;&#x8054;&#x7684;<code>FragmentManagerViewModel</code>&#x4E2D;<code>mViewModelStores</code>&#x8FDB;&#x884C;&#x5173;&#x8054;&#x3002;<code>ViewModelStore</code>&#x672C;&#x8D28;&#x5C31;&#x662F;&#x4E00;&#x4E2A;Map&#xFF0C;key&#x503C;&#x662F;&#x4E00;&#x4E2A;<code>ViewModel</code>&#x7684;&#x552F;&#x4E00;&#x6807;&#x793A;&#xFF0C;&#x5F53;&#x524D;&#x6E90;&#x7801;&#x5B9E;&#x73B0;&#x662F;<code>androidx.lifecycle.ViewModelProvider.DefaultKey:{canonicalName}</code>&#xFF0C;value&#x503C;&#x662F;ViewModel&#x5BF9;&#x8C61;&#x3002;&#x901A;&#x5E38;&#x4F7F;&#x7528;<code>ViewModelProviders</code>&#x5DE5;&#x5177;&#x7C7B;&#x62FF;&#x5230;&#x5173;&#x8054;&#x7684;<code>ViewModel</code>&#x3002;</p></li><li><p>&#x901A;&#x8FC7;<code>Lifecycle</code>&#x76D1;&#x542C;<code>ON_DESTROY</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x6267;&#x884C;<code>ViewModel</code>&#x7684;<code>onClear()</code>&#x51FD;&#x6570;&#xFF0C;&#x5B9E;&#x73B0;&#x751F;&#x547D;&#x5468;&#x671F;&#x611F;&#x77E5;&#x3002;</p></li><li><p>&#x9488;&#x5BF9;&#x5C4F;&#x5E55;&#x65CB;&#x8F6C;&#x7B49;&#x60C5;&#x51B5;&#xFF0C;&#x901A;&#x8FC7;<code>onRetainNonConfigurationInstance()/getLastNonConfigurationInstance()</code>&#x51FD;&#x6570;&#x907F;&#x514D;<code>ViewModelStore</code>&#x91CD;&#x65B0;&#x6784;&#x5EFA;</p></li></ul><h2 id="&#x8BA8;&#x8BBA;"><a href="#&#x8BA8;&#x8BBA;" class="headerlink" title="&#x8BA8;&#x8BBA;"></a>&#x8BA8;&#x8BBA;</h2><ol><li><p>&#x901A;&#x8FC7;<code>ViewModel</code>&#x5B9E;&#x73B0;Fragment&#x95F4;&#x4EA4;&#x4E92;&#xFF1A;&#x53EA;&#x8981;&#x4E0D;&#x540C;Fragment&#x5916;&#x5C42;&#x7684;Activity&#x662F;&#x540C;&#x4E00;&#x4E2A;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x7528;&#x5916;&#x5C42;Activity&#x7684;<code>ViewModel</code>&#x5B9E;&#x73B0;&#x4EA4;&#x4E92;</p></li><li><p>&#x4FDD;&#x5B58;UI&#x72B6;&#x6001;&#x4E09;&#x5F20;&#x65B9;&#x5F0F;&#x5BF9;&#x6BD4;</p></li></ol><img src="/2019/09/30/JetPack-ViewModel/save-state.png"><p>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;<code>androidx.lifecycle:lifecycle-viewmodel-savedstate</code>&#x5305;,&#x53EF;&#x4EE5;&#x7ED9;ViewModel&#x63D0;&#x4F9B;<code>SavedStateHandle</code>&#x5BF9;&#x8C61;,&#x65B9;&#x4FBF;&#x5728;ViewModel&#x4E2D;&#x8FDB;&#x884C;onSaveInstanceState()&#x64CD;&#x4F5C;&#x3002;<code>SavedStateHandle</code>&#x5BF9;&#x8C61;&#x6301;&#x6709;Map&#xFF0C;&#x5728;&#x6700;&#x5916;&#x5C42;Activity/Fragment&#x751F;&#x547D;&#x5468;&#x671F;<code>onSaveInstanceState()</code>&#x4E2D;&#x628A;Map&#x4FDD;&#x5B58;&#x5230;Bundle&#x4E2D;&#xFF0C;<code>onCreate()</code>&#x65F6;&#x53D6;&#x51FA;&#xFF0C;&#x6240;&#x4EE5;Map&#x7684;key&#x662F;String&#xFF0C;value&#x662F;Bundle&#x652F;&#x6301;&#x7684;&#x7C7B;&#x578B;</p><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><p>1.<a href="https://developer.android.com/topic/libraries/architecture/viewmodel" target="_blank" rel="noopener">https://developer.android.com/topic/libraries/architecture/viewmodel</a><br>2.<a href="https://developer.android.com/topic/libraries/architecture/saving-states" target="_blank" rel="noopener">https://developer.android.com/topic/libraries/architecture/saving-states</a><br>3.<a href="https://developer.android.com/topic/libraries/architecture/viewmodel-savedstate" target="_blank" rel="noopener">https://developer.android.com/topic/libraries/architecture/viewmodel-savedstate</a><br>4.&#x6E90;&#x7801;</p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#简介&quot;&gt;简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#实现原理&quot;&gt;实现原理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#讨论&quot;&gt;讨论&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;根据官网介绍&lt;code&gt;ViewModel&lt;/code&gt;主要作用是&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The &lt;code&gt;ViewModel&lt;/code&gt; class is designed to store and manage UI-related data in a lifecycle conscious way. The ViewModel class allows data to survive configuration changes such as screen rotations.&lt;br&gt;其生命周期如下图所示(以&lt;code&gt;Activity&lt;/code&gt;为例,&lt;code&gt;Fragment&lt;/code&gt;是&lt;code&gt;OnCreate()&lt;/code&gt;至&lt;code&gt;OnDetach()&lt;/code&gt;):&lt;/p&gt;
&lt;/blockquote&gt;
&lt;img src=&quot;/2019/09/30/JetPack-ViewModel/viewmodel-lifecycle.png&quot;&gt;
&lt;p&gt;Activity/Fragment被认为是UI Controller, ViewModel把UI无关的逻辑操作进行封装,所以ViewModel不建议持有View/Lifecycle/Activity等对象。如果需要Context，使用&lt;code&gt;AndroidViewModel&lt;/code&gt;，其持有&lt;code&gt;Application&lt;/code&gt;引用。&lt;/p&gt;
    
    </summary>
    
      <category term="JetPack" scheme="http://yoursite.com/categories/JetPack/"/>
    
    
      <category term="Android学习笔记" scheme="http://yoursite.com/tags/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>JetPack-LiveData</title>
    <link href="http://yoursite.com/2019/09/25/JetPack-LiveData/"/>
    <id>http://yoursite.com/2019/09/25/JetPack-LiveData/</id>
    <published>2019-09-25T06:12:56.000Z</published>
    <updated>2019-11-26T03:43:07.842Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x6982;&#x8FF0;">&#x6982;&#x8FF0;</a></li><li><a href="#&#x539F;&#x7406;&#x7B80;&#x8FF0;">&#x539F;&#x7406;&#x7B80;&#x8FF0;</a></li><li><a href="#&#x5176;&#x4ED6;">&#x5176;&#x4ED6;</a></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><h2 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h2><p>Google&#x5F15;&#x5165;&#x8BE5;&#x7EC4;&#x4EF6;&#x7684;&#x539F;&#x56E0;&#x5982;&#x4E0B;&#xFF1A;</p><blockquote><p> LiveData is a data holder class that can be observed within a given lifecycle.<br>   This means that an {@link Observer} can be added in a pair with a {@link LifecycleOwner}, and<br>   this observer will be notified about modifications of the wrapped data only if the paired<br>   LifecycleOwner is in active state. LifecycleOwner is considered as active, if its state is<br>   {@link Lifecycle.State#STARTED} or {@link Lifecycle.State#RESUMED}</p></blockquote><h2 id="&#x539F;&#x7406;&#x7B80;&#x8FF0;"><a href="#&#x539F;&#x7406;&#x7B80;&#x8FF0;" class="headerlink" title="&#x539F;&#x7406;&#x7B80;&#x8FF0;"></a>&#x539F;&#x7406;&#x7B80;&#x8FF0;</h2><p>&#x6838;&#x5FC3;&#x5B9E;&#x73B0;&#x5728;<code>LiveData</code>&#x62BD;&#x8C61;&#x7C7B;&#x4E2D;&#xFF0C;&#x8BE5;&#x7C7B;&#x91CD;&#x8981;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x5982;&#x4E0B;&#xFF1A;</p><ul><li><code>mData</code>: &#x6301;&#x6709;&#x7684;&#x6570;&#x636E;&#x5BF9;&#x8C61;</li><li><code>mVersion</code>: &#x6570;&#x636E;&#x5BF9;&#x8C61;&#x7684;&#x7248;&#x672C;&#x53F7;,&#x9ED8;&#x8BA4;&#x503C;&#x662F;<code>START_VERSION</code>(-1)</li><li><code>mObservers</code>: Map&#x5BF9;&#x8C61;(<code>Observer</code> <--> <code>ObserverWrapper</code>),&#x5176;&#x4E2D;<code>Observer</code>&#x5B9A;&#x4E49;&#x4E86;&#x89C2;&#x5BDF;&#x8005;&#x63A5;&#x53E3;,<code>ObserverWrapper</code>&#x5305;&#x542B;<code>LifecycleOwner</code>&#x3001;<code>Observer</code>&#x548C;&#x7248;&#x672C;&#x53F7;<code>mLastVersion</code>&#x3002;</--></li></ul><p><strong>&#x6CE8;&#x610F;:</strong> </p><p>&#x6839;&#x636E;<code>LiveData#observe</code>&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;&#x4E00;&#x4E2A;<code>Observer</code>&#x53EA;&#x80FD;&#x5728;&#x540C;&#x4E00;&#x4E2A;<code>LiveData</code>&#x6CE8;&#x518C;&#x4E00;&#x6B21;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x5728;&#x591A;&#x4E2A;&#x4E0D;&#x540C;&#x7684;<code>LiveData</code>&#x4E2D;&#x6CE8;&#x518C;&#x3002;</p><a id="more"></a><p><strong>&#x7F51;&#x4E0A;&#x4E2A;&#x4EBA;&#x611F;&#x89C9;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x793A;&#x610F;&#x56FE;:</strong> </p><img src="/2019/09/25/JetPack-LiveData/liveData-theory.webp"><p><strong>&#x5173;&#x952E;&#x89E3;&#x91CA;:</strong></p><ul><li><p><code>LiveData</code>&#x901A;&#x8FC7;<code>Lifecycle</code>&#x611F;&#x77E5;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5177;&#x4F53;&#x662F;&#x5728;<code>Lifecycle</code>&#x4E2D;&#x6CE8;&#x518C;<code>LifecycleBoundObserver</code>&#x5BF9;&#x8C61;&#xFF0C;&#x662F;&#x5BF9;<code>ObserverWrapper</code>&#x5BF9;&#x8C61;&#x5C01;&#x88C5;&#xFF0C;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E8B;&#x4EF6;&#x3002;</p></li><li><p>&#x5F53;&#x4E8B;&#x4EF6;<code>Event&gt;=STARTED</code>&#x65F6;&#xFF0C;<code>ObserverWrapper</code>&#x901A;&#x8FC7;&#x5BF9;&#x6BD4;&#x5176;<code>version</code>&#x4E0E;<code>LiveData</code>&#x7684;version&#xFF0C;&#x5982;&#x679C;&#x5C0F;&#x4E8E;&#x5219;&#x8BA4;&#x4E3A;<code>mData</code>&#x6709;&#x6700;&#x65B0;&#x503C;&#xFF0C;&#x6700;&#x7EC8;&#x901A;&#x77E5;<code>Observer</code>&#xFF1B;&#x5F53;&#x8C03;&#x7528;<code>LiveData#setValue()/#postValue()</code>&#x65F6;&#xFF0C;&#x90FD;&#x4F1A;&#x589E;&#x52A0;<code>LiveData</code>&#x7684;version&#x503C;&#xFF0C;&#x5E76;&#x4E14;&#x6B64;&#x65F6;&#x4F1A;&#x904D;&#x5386;&#x6240;&#x6709;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x5904;&#x4E8E;Active&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x4F1A;&#x7ACB;&#x5373;&#x5F97;&#x5230;&#x901A;&#x77E5;&#x3002;</p></li><li><p>&#x5F53;<code>DESTROYED</code>&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;<code>LiveData</code>&#x548C;<code>Lifecycle</code>&#x5747;&#x81EA;&#x52A8;remove&#x5404;&#x81EA;&#x5BF9;&#x5E94;&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x3002;</p></li></ul><h2 id="&#x5176;&#x4ED6;"><a href="#&#x5176;&#x4ED6;" class="headerlink" title="&#x5176;&#x4ED6;"></a>&#x5176;&#x4ED6;</h2><ul><li><p><code>LiveData#observeForever(Observer&lt;? super T&gt;)</code>&#x65B9;&#x6CD5;&#x5BFC;&#x81F4;&#x53EA;&#x8981;version&#x6709;&#x53D8;&#x5316;&#x5C31;&#x4F1A;&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#xFF0C;&#x8131;&#x79BB;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x624B;&#x52A8;remove</p></li><li><p><code>LiveData</code>&#x63D0;&#x4F9B;&#x4E24;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;<code>onActvie()</code>&#x548C;<code>OnInActive()</code>,&#x524D;&#x8005;&#x8868;&#x793A;<code>LiveData</code>&#x5904;&#x4E8E;actvie&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x4ECE;0&#x4E2A;&#x5230;1&#x4E2A;&#x65F6;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x5373;&#x7B2C;&#x4E00;&#x4E2A;&#x89C2;&#x5BDF;&#x8005;&#x88AB;&#x901A;&#x77E5;&#x524D;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x540E;&#x8005;&#x8868;&#x793A;<code>LiveData</code>&#x5904;&#x4E8E;&#x5904;&#x4E8E;actvie&#x7684;&#x89C2;&#x5BDF;&#x8005;&#x4ECE;1&#x4E2A;&#x5230;0&#x4E2A;&#x65F6;&#x7684;&#x56DE;&#x8C03;&#xFF0C;active&#x8868;&#x793A;&#x89C2;&#x5BDF;&#x8005;&#x751F;&#x547D;&#x5468;&#x671F;&#x81F3;&#x5C11;&#x5904;&#x4E8E;<code>ON_START</code>&#x72B6;&#x6001;&#x3002;</p></li><li><p><code>MutableLiveData</code>&#x7EE7;&#x627F;<code>LiveData</code>&#xFF0C;&#x552F;&#x4E00;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x66B4;&#x9732;<code>#setValue()/#postValue()</code>&#x65B9;&#x6CD5;&#x3002;</p></li><li><p><code>MediatorLiveData</code>&#x7EE7;&#x627F;<code>MutableLiveData</code>&#xFF0C;&#x63D0;&#x4F9B;&#x5728;&#x539F;&#x59CB;<code>LiveData</code>&#x4E0E;<code>Observer</code>&#x4E4B;&#x95F4;&#x6570;&#x636E;&#x5904;&#x7406;&#x7684;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x5173;&#x952E;&#x51FD;&#x6570;<code>addSource(@NonNull LiveData&lt;S&gt; source, @NonNull Observer&lt;? super S&gt; onChanged)</code>&#xFF0C;<code>source</code>&#x8868;&#x793A;&#x539F;&#x59CB;<code>LiveData</code>,<code>onChanged</code>&#x8868;&#x793A;&#x539F;&#x59CB;<code>LiveData</code>&#x6709;&#x53D8;&#x5316;&#x65F6;&#x901A;&#x77E5;&#x7684;&#x56DE;&#x8C03;&#xFF0C;&#x53EF;&#x8FDB;&#x884C;&#x4E00;&#x4E9B;&#x5904;&#x7406;&#x3002;&#x5173;&#x4E8E;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x5B98;&#x65B9;&#x7ED9;&#x51FA;&#x4F8B;&#x5B50;&#x662F;<code>Observer</code>&#x89C2;&#x5BDF;&#x591A;&#x4E2A;<code>LiveData</code>, &#x8FD8;&#x6709;&#x5C31;&#x662F;&#x4E3A;<code>Transformations</code>&#x53D8;&#x5316;&#x63D0;&#x4F9B;&#x652F;&#x6301;&#x3002;</p></li><li><p><code>Transformations</code>&#x7C7B;&#x7528;&#x4E8E;&#x53D8;&#x6362;&#xFF0C;&#x7C7B;&#x4F3C;<code>Rx</code>&#x64CD;&#x4F5C;&#x7B26;&#xFF0C;&#x5F53;&#x524D;&#x7248;&#x672C;&#x63D0;&#x4F9B;&#x4E09;&#x79CD;:</p><ol><li><code>map</code>:   LiveData<x> -&gt; LiveData<y>, &#x63D0;&#x4F9B;Function: X-&gt;Y&#x7684;&#x8F6C;&#x6362;&#x51FD;&#x6570;&#x5B9E;&#x73B0;</y></x></li><li><code>switchMap</code> : &#x529F;&#x80FD;&#x4E0E;<code>map</code>&#x7C7B;&#x4F3C;&#xFF0C;&#x4F46;&#x9700;&#x63D0;&#x4F9B;Function: X-&gt;LiveData<y>&#x7684;&#x8F6C;&#x6362;&#x51FD;&#x6570;&#xFF0C;&#x53EF;&#x7528;&#x4E8E;X-&gt;Y&#x91C7;&#x7528;&#x5F02;&#x6B65;&#x7684;&#x573A;&#x666F;</y></li><li><code>distinctUntilChanged</code> : LiveData<x> -&gt; LiveData<x>, &#x65B0;LiveData<x>&#x53EA;&#x5728;X&#x6709;&#x53D8;&#x5316;&#x65F6;&#x624D;&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;&#x3002;<code>LiveData</code>&#x662F;&#x7C98;&#x6027;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x65B0;&#x589E;&#x4E00;&#x4E2A;&#x89C2;&#x5BDF;&#x8005;&#x90FD;&#x4F1A;&#x6BD4;&#x8F83;LiveData&#x5F53;&#x524D;version&#x548C;&#x89C2;&#x5BDF;&#x8005;version(&#x65B0;&#x589E;&#x9ED8;&#x8BA4;&#x503C;&#x662F;-1)&#xFF0C;&#x5982;&#x679C;LiveData&#x8BBE;&#x7F6E;&#x8FC7;&#x503C;&#xFF0C;&#x90FD;&#x4F1A;&#x901A;&#x77E5;&#x8BE5;&#x89C2;&#x5BDF;&#x8005;&#x6700;&#x65B0;LiveData&#x503C;&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x7C98;&#x6027;&#x7684;&#xFF1B;&#x8FD9;&#x4E2A;&#x53D8;&#x6362;&#x662F;&#x4E3A;&#x4E86;&#x53D6;&#x6D88;&#x8FD9;&#x4E2A;&#x7C98;&#x6027;&#x6548;&#x679C;&#x3002;</x></x></x></li></ol></li></ul><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><p>1.<a href="https://www.jianshu.com/p/d66b2fd4d918" target="_blank" rel="noopener">https://www.jianshu.com/p/d66b2fd4d918</a><br>2.<a href="https://developer.android.com/topic/libraries/architecture/livedata#work_livedata" target="_blank" rel="noopener">https://developer.android.com/topic/libraries/architecture/livedata#work_livedata</a><br>3.&#x6E90;&#x7801;</p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#概述&quot;&gt;概述&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#原理简述&quot;&gt;原理简述&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#其他&quot;&gt;其他&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;p&gt;Google引入该组件的原因如下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; LiveData is a data holder class that can be observed within a given lifecycle.&lt;br&gt;   This means that an {@link Observer} can be added in a pair with a {@link LifecycleOwner}, and&lt;br&gt;   this observer will be notified about modifications of the wrapped data only if the paired&lt;br&gt;   LifecycleOwner is in active state. LifecycleOwner is considered as active, if its state is&lt;br&gt;   {@link Lifecycle.State#STARTED} or {@link Lifecycle.State#RESUMED}&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;原理简述&quot;&gt;&lt;a href=&quot;#原理简述&quot; class=&quot;headerlink&quot; title=&quot;原理简述&quot;&gt;&lt;/a&gt;原理简述&lt;/h2&gt;&lt;p&gt;核心实现在&lt;code&gt;LiveData&lt;/code&gt;抽象类中，该类重要成员变量如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mData&lt;/code&gt;: 持有的数据对象&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mVersion&lt;/code&gt;: 数据对象的版本号,默认值是&lt;code&gt;START_VERSION&lt;/code&gt;(-1)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mObservers&lt;/code&gt;: Map对象(&lt;code&gt;Observer&lt;/code&gt; &lt;--&gt; &lt;code&gt;ObserverWrapper&lt;/code&gt;),其中&lt;code&gt;Observer&lt;/code&gt;定义了观察者接口,&lt;code&gt;ObserverWrapper&lt;/code&gt;包含&lt;code&gt;LifecycleOwner&lt;/code&gt;、&lt;code&gt;Observer&lt;/code&gt;和版本号&lt;code&gt;mLastVersion&lt;/code&gt;。&lt;/--&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;注意:&lt;/strong&gt; &lt;/p&gt;
&lt;p&gt;根据&lt;code&gt;LiveData#observe&lt;/code&gt;方法可以得出一个&lt;code&gt;Observer&lt;/code&gt;只能在同一个&lt;code&gt;LiveData&lt;/code&gt;注册一次，但可以在多个不同的&lt;code&gt;LiveData&lt;/code&gt;中注册。&lt;/p&gt;
    
    </summary>
    
      <category term="JetPack" scheme="http://yoursite.com/categories/JetPack/"/>
    
    
      <category term="Android学习笔记" scheme="http://yoursite.com/tags/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>JetPack-Lifecycle</title>
    <link href="http://yoursite.com/2019/09/23/JetPack-Lifecycle/"/>
    <id>http://yoursite.com/2019/09/23/JetPack-Lifecycle/</id>
    <published>2019-09-23T07:13:44.000Z</published>
    <updated>2019-09-24T07:19:38.415Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x6982;&#x8FF0;">&#x6982;&#x8FF0;</a></li><li><a href="#&#x5B9E;&#x73B0;">&#x5B9E;&#x73B0;</a><ul><li><a href="#1&#x5173;&#x4E8E;observer">1.&#x5173;&#x4E8E;Observer</a></li><li><a href="#2lifecycle&#x5982;&#x4F55;&#x4E0E;&#x7CFB;&#x7EDF;&#x7EC4;&#x4EF6;&#x5173;&#x8054;">2.<code>Lifecycle</code>&#x5982;&#x4F55;&#x4E0E;&#x7CFB;&#x7EDF;&#x7EC4;&#x4EF6;&#x5173;&#x8054;</a></li></ul></li><li><a href="#processlifecycleowner&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x611F;&#x77E5;"><code>ProcessLifecycleOwner</code>&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x611F;&#x77E5;</a></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><h2 id="&#x6982;&#x8FF0;"><a href="#&#x6982;&#x8FF0;" class="headerlink" title="&#x6982;&#x8FF0;"></a>&#x6982;&#x8FF0;</h2><p>&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x6784;&#x5EFA;&#x751F;&#x547D;&#x5468;&#x671F;(Fragment/Activity)&#x53EF;&#x77E5;&#x7684;&#x7EC4;&#x4EF6;&#xFF0C;&#x4E3B;&#x8981;&#x4EE3;&#x7801;&#x5728;<code>androidx.lifecycle</code>&#x5305;&#xFF0C;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;<code>implementation androidx.lifecycle:lifecycle-extensions:2.1.0</code>&#x628A;<code>ViewModel</code>,<code>LiveData</code>&#x4E00;&#x8D77;&#x5BFC;&#x5165;&#x3002;</p><p>Lifecycle&#x628A;&#x7EC4;&#x4EF6;&#x751F;&#x547D;&#x5468;&#x671F;&#x62BD;&#x8C61;&#x6210;&#x4E94;&#x79CD;&#x72B6;&#x6001;(<code>Lifecycle#State&#x679A;&#x4E3E;</code>),&#x72B6;&#x6001;&#x4E4B;&#x95F4;&#x901A;&#x8FC7;&#x516D;&#x79CD;&#x4E8B;&#x4EF6;(<code>Lifecycle#Event&#x679A;&#x4E3E;</code>)&#x53D1;&#x751F;&#x72B6;&#x6001;&#x53D8;&#x5316;&#xFF0C;&#x793A;&#x610F;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p><img src="/2019/09/23/JetPack-Lifecycle/lifecycle-states.svg"><a id="more"></a><h2 id="&#x5B9E;&#x73B0;"><a href="#&#x5B9E;&#x73B0;" class="headerlink" title="&#x5B9E;&#x73B0;"></a>&#x5B9E;&#x73B0;</h2><p>Google&#x5F15;&#x5165;Lifecycle&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x901A;&#x8FC7;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#x628A;Activity&#x7B49;&#x548C;&#x4E0E;&#x5176;&#x751F;&#x547D;&#x5468;&#x671F;&#x76F8;&#x5173;&#x8054;&#x7684;&#x7EC4;&#x4EF6;&#x8FDB;&#x884C;&#x89E3;&#x8026;&#x3002;&#x88AB;&#x89C2;&#x5BDF;&#x8005;&#x6838;&#x5FC3;&#x62BD;&#x8C61;&#x7C7B;&#x662F;<code>Lifecycle</code>&#xFF0C;&#x7CFB;&#x7EDF;&#x552F;&#x4E00;&#x5B9E;&#x73B0;&#x7C7B;&#x662F;<code>LifecycleRegistry</code>&#xFF0C;&#x88AB;&#x89C2;&#x5BDF;&#x8005;&#x6838;&#x5FC3;&#x65B9;&#x6CD5;&#x5C31;&#x662F;<code>addObserver(observer)\removeObserver(observer)</code>&#x548C;<code>#setCurrentState(state)</code>(&#x8BBE;&#x7F6E;&#x88AB;&#x89C2;&#x5BDF;&#x8005;&#x5F53;&#x524D;&#x72B6;&#x6001;)&#xFF1B;&#x89C2;&#x5BDF;&#x8005;&#x6838;&#x5FC3;&#x63A5;&#x53E3;&#x662F;<code>LifecycleObserver</code>&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;&#x7EC4;&#x4EF6;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x8BE5;&#x63A5;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;&#x5BF9;&#x5E94;state&#x7684;&#x903B;&#x8F91;&#x3002;</p><h3 id="1&#x5173;&#x4E8E;observer"><a href="#1-&#x5173;&#x4E8E;Observer" class="headerlink" title="1.&#x5173;&#x4E8E;Observer"></a>1.&#x5173;&#x4E8E;Observer</h3><ul><li><p>Java8&#x4E4B;&#x524D;&#x5B98;&#x65B9;&#x5EFA;&#x8BAE;&#x901A;&#x8FC7;Annotation&#x5B9E;&#x73B0;&#xFF0C;&#x4F7F;&#x7528;&#x53CD;&#x5C04;&#x6267;&#x884C;&#x6307;&#x5B9A;state&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;demo&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLifeObserver</span> : <span class="type">LifecycleObserver {</span></span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_START)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">start</span><span class="params">()</span></span> {</span><br><span class="line">       ...</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">resume</span><span class="params">()</span></span> {</span><br><span class="line">       ...</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li><li><p>Java8&#x4E4B;&#x540E;&#x5B98;&#x65B9;&#x5EFA;&#x8BAE;&#x5BFC;&#x5165;<code>androidx.lifecycle:lifecycle-common-java8:2.1.0</code>&#xFF0C;&#x901A;&#x8FC7;<code>DefaultLifecycleOberser</code>&#x63A5;&#x53E3;&#x5B9E;&#x73B0;</p></li></ul><h3 id="2lifecycle&#x5982;&#x4F55;&#x4E0E;&#x7CFB;&#x7EDF;&#x7EC4;&#x4EF6;&#x5173;&#x8054;"><a href="#2-Lifecycle&#x5982;&#x4F55;&#x4E0E;&#x7CFB;&#x7EDF;&#x7EC4;&#x4EF6;&#x5173;&#x8054;" class="headerlink" title="2.Lifecycle&#x5982;&#x4F55;&#x4E0E;&#x7CFB;&#x7EDF;&#x7EC4;&#x4EF6;&#x5173;&#x8054;"></a>2.<code>Lifecycle</code>&#x5982;&#x4F55;&#x4E0E;&#x7CFB;&#x7EDF;&#x7EC4;&#x4EF6;&#x5173;&#x8054;</h3><ul><li><code>Activity</code><br>Androidx&#x63D0;&#x4F9B;<code>ComponentActivity</code>&#x5DF2;&#x5B9E;&#x73B0;<code>LifecycleOwner</code>&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;<code>LifecycleRegistry</code>&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;&#x901A;&#x8FC7;add&#x4E00;&#x4E2A;&#x6CA1;&#x6709;&#x754C;&#x9762;&#x7684;<code>ReportFragment</code>&#x76D1;&#x542C;Activity&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x5728;&#x6BCF;&#x4E2A;&#x751F;&#x547D;&#x5468;&#x4E2D;&#x901A;&#x8FC7;&#x89C2;&#x5BDF;&#x8005;&#x72B6;&#x6001;&#x53D8;&#x5316;&#x3002;&#x53C2;&#x8003;&#x7F51;&#x4E0A;&#x65F6;&#x5E8F;&#x56FE;&#xFF1A;</li></ul><img src="/2019/09/23/JetPack-Lifecycle/sequence.png"><ul><li><p><code>Fragment</code><br>AndroidX&#x63D0;&#x4F9B;<code>Fragment</code>&#x5DF2;&#x5B9E;&#x73B0;<code>LifecycleOwner</code>&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;<code>LifecycleRegistry</code>&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x5728;fragment&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x4E2D;&#x901A;&#x77E5;&#x89C2;&#x5BDF;&#x8005;state&#x7684;&#x53D8;&#x5316;&#x3002;</p></li><li><p><code>Service</code><br>AndroidX&#x63D0;&#x4F9B;<code>LifecycleService</code>&#x5B9E;&#x73B0;&#x4E86;<code>LifecycleOwner</code>&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4F9B;<code>LifecycleRegistry</code>&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;</p></li></ul><h2 id="processlifecycleowner&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x611F;&#x77E5;"><a href="#ProcessLifecycleOwner&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x611F;&#x77E5;" class="headerlink" title="ProcessLifecycleOwner&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x611F;&#x77E5;"></a><code>ProcessLifecycleOwner</code>&#x5B9E;&#x73B0;&#x524D;&#x540E;&#x611F;&#x77E5;</h2><p>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;<code>ProcessLifecycleOwner</code>&#x7528;&#x4E8E;&#x5B9E;&#x73B0;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x611F;&#x77E5;&#xFF0C;&#x5373;&#x53EA;&#x4F1A;&#x63A5;&#x53D7;&#x4E00;&#x6B21;<code>ON_CREATE</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;Activity&#x663E;&#x793A;&#x65F6;&#x63A5;&#x6536;<code>ON_START</code>/<code>ON_RESUME</code>&#x4E8B;&#x4EF6;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;Activity&#x4E0D;&#x663E;&#x793A;&#x65F6;&#x63A5;&#x6536;<code>ON_PAUSE</code>/<code>ON_STOP</code>&#x4E8B;&#x4EF6;&#x3002;&#x5185;&#x90E8;&#x901A;&#x8FC7;&#x7EDF;&#x8BA1;&#x5904;&#x4E8E;&#x8FDB;&#x5165;start/resume&#x7684;&#x6B21;&#x6570;&#x5B9E;&#x73B0;&#xFF0C;&#x8BE5;&#x7C7B;&#x53EF;&#x7528;&#x4E8E;&#x5904;&#x7406;&#x524D;&#x540E;&#x53F0;&#x7684;&#x903B;&#x8F91;&#xFF0C;demo&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ProcessLifecycleOwner.<span class="keyword">get</span>().lifecycle.addObserver(<span class="keyword">object</span> : LifecycleObserver{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onFront</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">// &#x5728;&#x524D;&#x53F0;...</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_STOP)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onBack</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="comment">// &#x5728;&#x540E;&#x53F0;...</span></span><br><span class="line">    }</span><br><span class="line">})</span><br></pre></td></tr></table></figure></p><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><ol><li><a href="https://developer.android.com/topic/libraries/architecture/lifecycle" target="_blank" rel="noopener">https://developer.android.com/topic/libraries/architecture/lifecycle</a></li><li>&#x6E90;&#x7801;</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#概述&quot;&gt;概述&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#实现&quot;&gt;实现&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1关于observer&quot;&gt;1.关于Observer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2lifecycle如何与系统组件关联&quot;&gt;2.&lt;code&gt;Lifecycle&lt;/code&gt;如何与系统组件关联&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#processlifecycleowner实现前后感知&quot;&gt;&lt;code&gt;ProcessLifecycleOwner&lt;/code&gt;实现前后感知&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;p&gt;帮助开发者构建生命周期(Fragment/Activity)可知的组件，主要代码在&lt;code&gt;androidx.lifecycle&lt;/code&gt;包，建议使用&lt;code&gt;implementation androidx.lifecycle:lifecycle-extensions:2.1.0&lt;/code&gt;把&lt;code&gt;ViewModel&lt;/code&gt;,&lt;code&gt;LiveData&lt;/code&gt;一起导入。&lt;/p&gt;
&lt;p&gt;Lifecycle把组件生命周期抽象成五种状态(&lt;code&gt;Lifecycle#State枚举&lt;/code&gt;),状态之间通过六种事件(&lt;code&gt;Lifecycle#Event枚举&lt;/code&gt;)发生状态变化，示意图如下：&lt;/p&gt;
&lt;img src=&quot;/2019/09/23/JetPack-Lifecycle/lifecycle-states.svg&quot;&gt;
    
    </summary>
    
      <category term="JetPack" scheme="http://yoursite.com/categories/JetPack/"/>
    
    
      <category term="Android学习笔记" scheme="http://yoursite.com/tags/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>最大连续子序列和</title>
    <link href="http://yoursite.com/2018/12/17/max-sub-array/"/>
    <id>http://yoursite.com/2018/12/17/max-sub-array/</id>
    <published>2018-12-17T03:04:26.000Z</published>
    <updated>2018-12-17T04:24:19.594Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x63CF;&#x8FF0;"><a href="#&#x63CF;&#x8FF0;" class="headerlink" title="&#x63CF;&#x8FF0;"></a>&#x63CF;&#x8FF0;</h2><p>&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x6570;&#x5B57;&#x5E8F;&#x5217;$A_1,A_2,&#x2026;,A_n,&#x6C42;i,j(1\le i \le j\le n)$,&#x4F7F;&#x5F97;$A_i+&#x2026;+A_j$&#x6700;&#x5927;&#x5E76;&#x8F93;&#x51FA;&#x6700;&#x5927;&#x503C;</p><a id="more"></a><h2 id="&#x4EE3;&#x7801;1"><a href="#&#x4EE3;&#x7801;1&#xFF1A;" class="headerlink" title="&#x4EE3;&#x7801;1&#xFF1A;"></a>&#x4EE3;&#x7801;1&#xFF1A;</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">maxSubArray</span><span class="params">(nums: <span class="type">IntArray</span>)</span></span>: <span class="built_in">Int</span> {</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> maxSum = <span class="built_in">Int</span>.MIN_VALUE</span><br><span class="line">    <span class="keyword">for</span>(i <span class="keyword">in</span> nums){</span><br><span class="line">        sum += i</span><br><span class="line">        <span class="keyword">if</span> (sum &gt; maxSum){</span><br><span class="line">            maxSum = sum</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (sum &lt; <span class="number">0</span>){</span><br><span class="line">            sum = <span class="number">0</span> </span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> maxSum</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="&#x89E3;&#x91CA;1"><a href="#&#x89E3;&#x91CA;1&#xFF1A;" class="headerlink" title="&#x89E3;&#x91CA;1&#xFF1A;"></a>&#x89E3;&#x91CA;1&#xFF1A;</h2><p><strong>1.</strong> &#x5047;&#x8BBE;A[0]&gt;0,A[0]+A[1]+&#x2026;+A[p-1]&gt;0&#xFF0C;A[0]+A[1]+&#x2026;+ A[p-1]+ A[p]&lt;0,p&#x662F;&#x6570;&#x7EC4;&#x7684;&#x5143;&#x7D20;&#x7D2F;&#x52A0;&#x548C;&#x8FC7;&#x7A0B;&#x4E2D;&#x9047;&#x5230;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x5C0F;&#x4E8E;&#x96F6;&#x7684;&#x4F4D;&#x7F6E;.</p><p>&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;k&#x5C5E;&#x4E8E;[0,p-1], &#x53EF;&#x63A8;&#x5BFC;&#x51FA;A[0]+&#x2026;+A[k]&gt;A[s]+&#x2026;+A[k],&#x5176;&#x4E2D;$s\in(0,k]$,&#x8FD9;&#x8BF4;&#x660E;0~k&#x4F4D;&#x7F6E;&#x7684;&#x5143;&#x7D20;&#x7D2F;&#x52A0;&#x548C;&#x5927;&#x4E8E;&#x4EFB;&#x610F;s~k&#x4F4D;&#x7F6E;&#x7684;&#x5B50;&#x5E8F;&#x5217;&#x4E4B;&#x548C;,&#x6240;&#x4EE5;&#x5728;[0,p-1]&#x533A;&#x95F4;&#x7D2F;&#x52A0;&#x6C42;&#x548C;&#x5E76;&#x8BB0;&#x5F55;&#x6700;&#x5927;&#x503C;.</p><p><strong>2.</strong> &#x6700;&#x5927;&#x8FDE;&#x7EED;&#x5B50;&#x5E8F;&#x5217;&#x4E0D;&#x53EF;&#x80FD;&#x5305;&#x542B;p,&#x56E0;&#x4E3A;A[n]+&#x2026;+A[p]+A[p+1]+&#x2026;+A[m]&#x4E2D;A[n]+&#x2026;A[p]&lt;0&#xFF0C;&#x6240;&#x4EE5;A[p+1]+&#x2026;+A[m]&#x5927;&#x4E8E;A[n]+&#x2026;+A[p]+&#x2026;+A[m], &#x5219;&#x8BF4;&#x660E;A[n]+&#x2026;+A[p]+&#x2026;+A[m]&#x4E0D;&#x662F;&#x6700;&#x5927;&#x8FDE;&#x7EED;&#x5B50;&#x5E8F;&#x5217;.</p><p><strong>3.</strong> &#x6240;&#x4EE5;&#x4ECE;p+1&#x8D77;,&#x91CD;&#x65B0;&#x7D2F;&#x52A0;&#x6C42;&#x5408;&#x5E76;&#x8BB0;&#x5F55;&#x6700;&#x5927;&#x503C;</p><h2 id="&#x4EE3;&#x7801;2"><a href="#&#x4EE3;&#x7801;2" class="headerlink" title="&#x4EE3;&#x7801;2:"></a>&#x4EE3;&#x7801;2:</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">maxSubArray</span><span class="params">(nums: <span class="type">IntArray</span>)</span></span>: <span class="built_in">Int</span> {</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> maxSum = <span class="built_in">Int</span>.MIN_VALUE</span><br><span class="line">    nums.forEachIndexed{ i, v -&gt;</span><br><span class="line">        <span class="keyword">when</span>(i){</span><br><span class="line">            <span class="number">0</span> -&gt; sum = v</span><br><span class="line">            <span class="keyword">else</span> -&gt; {</span><br><span class="line">                sum = Math.max(sum+v ,v)</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (sum &gt; maxSum){</span><br><span class="line">            maxSum = sum</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> maxSum</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="&#x89E3;&#x91CA;2&#x52A8;&#x6001;&#x89C4;&#x5212;"><a href="#&#x89E3;&#x91CA;2&#xFF08;&#x52A8;&#x6001;&#x89C4;&#x5212;&#xFF09;&#xFF1A;" class="headerlink" title="&#x89E3;&#x91CA;2&#xFF08;&#x52A8;&#x6001;&#x89C4;&#x5212;&#xFF09;&#xFF1A;"></a>&#x89E3;&#x91CA;2&#xFF08;&#x52A8;&#x6001;&#x89C4;&#x5212;&#xFF09;&#xFF1A;</h2><p>&#x4EE4;&#x72B6;&#x6001; dp[i] &#x8868;&#x793A;&#x4EE5; A[i] &#x4F5C;&#x4E3A;&#x672B;&#x5C3E;&#x7684;&#x8FDE;&#x7EED;&#x5E8F;&#x5217;&#x7684;&#x6700;&#x5927;&#x548C;.&#x56E0;&#x4E3A; dp[i] &#x8981;&#x6C42;&#x662F;&#x5FC5;&#x987B;&#x4EE5; A[i] &#x7ED3;&#x5C3E;&#x7684;&#x8FDE;&#x7EED;&#x5E8F;&#x5217;&#xFF0C;&#x90A3;&#x4E48;&#x53EA;&#x6709;&#x4E24;&#x79CD;&#x60C5;&#x51B5;:</p><ol><li>&#x8FD9;&#x4E2A;&#x6700;&#x5927;&#x548C;&#x7684;&#x8FDE;&#x7EED;&#x5E8F;&#x5217;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5143;&#x7D20;,&#x5373;&#x4EE5; A[i] &#x5F00;&#x59CB;,&#x4EE5; A[i] &#x7ED3;&#x5C3E;.</li><li>&#x8FD9;&#x4E2A;&#x6700;&#x5927;&#x548C;&#x7684;&#x8FDE;&#x7EED;&#x5E8F;&#x5217;&#x6709;&#x591A;&#x4E2A;&#x5143;&#x7D20;,&#x5373;&#x4ECE;&#x524D;&#x9762;&#x67D0;&#x5904; A[p] &#x5F00;&#x59CB; (p&lt;i),&#x4E00;&#x76F4;&#x5230; A[i] &#x7ED3;&#x5C3E;</li></ol><p>&#x72B6;&#x6001;&#x8F6C;&#x79FB;&#x65B9;&#x7A0B;: dp[i] = max{ A[i], dp[i-1]+A[i] }</p><p>&#x8FB9;&#x754C;: dp[0] = A[0]</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;描述&quot;&gt;&lt;a href=&quot;#描述&quot; class=&quot;headerlink&quot; title=&quot;描述&quot;&gt;&lt;/a&gt;描述&lt;/h2&gt;&lt;p&gt;给定一个数字序列$A_1,A_2,…,A_n,求i,j(1\le i \le j\le n)$,使得$A_i+…+A_j$最大并输出最大值&lt;/p&gt;
    
    </summary>
    
      <category term="算法与数据结构" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="算法与数据结构" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>快速排序算法</title>
    <link href="http://yoursite.com/2018/12/09/quick-sort/"/>
    <id>http://yoursite.com/2018/12/09/quick-sort/</id>
    <published>2018-12-09T03:01:55.000Z</published>
    <updated>2018-12-09T09:05:32.075Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x7B80;&#x4ECB;">&#x7B80;&#x4ECB;</a></li><li><a href="#&#x4EE3;&#x7801;&#x5B9E;&#x73B0;">&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</a></li><li><a href="#&#x6027;&#x80FD;&#x5206;&#x6790;">&#x6027;&#x80FD;&#x5206;&#x6790;</a></li></ul><!-- tocstop --><h2 id="&#x7B80;&#x4ECB;"><a href="#&#x7B80;&#x4ECB;" class="headerlink" title="&#x7B80;&#x4ECB;"></a>&#x7B80;&#x4ECB;</h2><p>&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#xFF08;Quick Sort&#xFF09;&#x662F;&#x7531;&#x56FE;&#x7075;&#x5956;&#x83B7;&#x5F97;&#x8005;Tony Hoare&#x8BBE;&#x8BA1;&#x51FA;&#x6765;&#xFF0C;&#x88AB;&#x5217;&#x4E3A;20&#x4E16;&#x7EAA;&#x5341;&#x5927;&#x7B97;&#x6CD5;&#x4E4B;&#x4E00;&#xFF0C;&#x4EE5;&#x201C;&#x5FEB;&#x901F;&#x201D;&#x547D;&#x540D;&#x8868;&#x660E;&#x8BE5;&#x7B97;&#x6CD5;&#x5728;&#x6574;&#x4F53;&#x6027;&#x80FD;&#x4E0A;&#x662F;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x7684;&#x738B;&#x8005;&#x3002;<br>&#x6838;&#x5FC3;&#x601D;&#x60F3;&#x662F;&#xFF1A;&#x901A;&#x8FC7;&#x4E00;&#x8D9F;&#x6392;&#x5E8F;&#x5C06;&#x5F85;&#x6392;&#x5E8F;&#x8BB0;&#x5F55;&#x5206;&#x5272;&#x6210;&#x72EC;&#x7ACB;&#x7684;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x90E8;&#x5206;&#x8BB0;&#x5F55;&#x5173;&#x952E;&#x5B57;&#x5747;&#x6BD4;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x8BB0;&#x5F55;&#x7684;&#x5173;&#x952E;&#x5B57;&#x5C0F;&#xFF0C;&#x5219;&#x53EF;&#x5206;&#x522B;&#x5BF9;&#x8FD9;&#x4E24;&#x90E8;&#x5206;&#x8BB0;&#x5F55;&#x7EE7;&#x7EED;&#x8FDB;&#x884C;&#x6392;&#x5E8F;&#xFF0C;&#x4EE5;&#x8FBE;&#x5230;&#x6574;&#x4E2A;&#x5E8F;&#x5217;&#x6709;&#x5E8F;&#x7684;&#x76EE;&#x7684;&#x3002;&#x4E00;&#x8D9F;&#x6392;&#x5E8F;&#x8FC7;&#x7A0B;&#x793A;&#x610F;&#x56FE;&#x5982;&#x4E0B;&#x3002;</p><a id="more"></a><img src="/2018/12/09/quick-sort/quick-sort_0.jpg"><p>&#x4E00;&#x8D9F;&#x6392;&#x5E8F;&#x4E2D;&#x9700;&#x8981;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x4F7F;&#x5F97;&#x5176;&#x5DE6;&#x8FB9;&#x7684;&#x503C;&#x90FD;&#x6BD4;&#x5B83;&#x5C0F;&#xFF0C;&#x53F3;&#x8FB9;&#x7684;&#x503C;&#x6BD4;&#x5B83;&#x5927; &#xFF0C;&#x8FD9;&#x4E2A;&#x5173;&#x952E;&#x5B57;&#x79F0;&#x4E3A;&#x67A2;&#x8F74;&#xFF08;pivot&#xFF09;&#xFF0C;pivot&#x53D6;&#x503C;&#x8D8A;&#x662F;&#x4F4D;&#x4E8E;&#x4E2D;&#x95F4;&#x5176;&#x6392;&#x5E8F;&#x6027;&#x80FD;&#x8D8A;&#x597D;&#x3002;</p><h2 id="&#x4EE3;&#x7801;&#x5B9E;&#x73B0;"><a href="#&#x4EE3;&#x7801;&#x5B9E;&#x73B0;" class="headerlink" title="&#x4EE3;&#x7801;&#x5B9E;&#x73B0;"></a>&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">fun <span class="title">quickSort</span><span class="params">(input: Array&lt;Int&gt;)</span></span>{</span><br><span class="line">    quickSort(input)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">quickSort</span><span class="params">(array: Array&lt;Int&gt;, _start: Int, _end: Int)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (_start &gt;= _end) {</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    }</span><br><span class="line">    val pivot = partition(array, _start, _end)</span><br><span class="line">    quickSort(array, _start, pivot - <span class="number">1</span>)</span><br><span class="line">    quickSort(array, pivot + <span class="number">1</span>, _end)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function">fun <span class="title">partition</span><span class="params">(array: Array&lt;Int&gt;, _start: Int, _end: Int)</span>: Int </span>{</span><br><span class="line">    val pivot = array[_start] <span class="comment">// pivot&#x9009;&#x7B2C;&#x4E00;&#x4E2A;&#xFF0C;&#x53EF;&#x4F18;&#x5316;</span></span><br><span class="line">    <span class="keyword">var</span> start = _start</span><br><span class="line">    <span class="keyword">var</span> end = _end</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (start &lt; end) {</span><br><span class="line">        <span class="keyword">while</span> (end &gt; start &amp;&amp; array[end] &gt;= pivot) {</span><br><span class="line">            end--</span><br><span class="line">        }</span><br><span class="line">        array[start] = array[end]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (start &lt; end &amp;&amp; array[start] &lt;= pivot) {</span><br><span class="line">            start++</span><br><span class="line">        }</span><br><span class="line">        array[end] = array[start]</span><br><span class="line">    }</span><br><span class="line">    array[start] = pivot</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> start</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="&#x6027;&#x80FD;&#x5206;&#x6790;"><a href="#&#x6027;&#x80FD;&#x5206;&#x6790;" class="headerlink" title="&#x6027;&#x80FD;&#x5206;&#x6790;"></a>&#x6027;&#x80FD;&#x5206;&#x6790;</h2><p>&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7684;&#x65F6;&#x95F4;&#x6027;&#x80FD;&#x53D6;&#x51B3;&#x4E8E;&#x9012;&#x5F52;&#x7684;&#x6DF1;&#x5EA6;&#xFF0C;&#x6700;&#x4F18;&#x7684;&#x60C5;&#x51B5;&#x662F;Partition&#x6BCF;&#x6B21;&#x90FD;&#x5212;&#x5206;&#x5F97;&#x6BD4;&#x8F83;&#x5747;&#x5300;&#xFF0C;&#x5982;&#x679C;&#x6392;&#x5E8F;n&#x4E2A;&#x5173;&#x952E;&#x5B57;&#xFF0C;&#x5176;&#x9012;&#x5F52;&#x6811;&#x7684;&#x6DF1;&#x5EA6;&#x4E3A;$\lfloor log_2n+1\rfloor$&#xFF0C;&#x5373;&#x4EC5;&#x9700;&#x9012;&#x5F52;&#x6B21;$log_2n$&#xFF0C;&#x6BCF;&#x6B21;&#x9700;&#x8981;&#x904D;&#x5386;&#x6574;&#x4E2A;&#x5E8F;&#x5217;&#xFF0C;&#x9700;&#x8981;$O(n)$&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x6240;&#x4EE5;&#x6574;&#x4E2A;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x5728;&#x6700;&#x4F18;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;$O(nlogn)$&#x3002;&#x6700;&#x574F;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x4E00;&#x9897;&#x659C;&#x6811;&#xFF0C;&#x5176;&#x6DF1;&#x5EA6;&#x4E3A;n&#xFF0C;&#x6240;&#x4EE5;&#x6700;&#x574F;&#x7684;&#x60C5;&#x51B5;&#x5176;&#x65F6;&#x95F4;&#x590D;&#x6742;&#x5EA6;&#x4E3A;$O(n^2)$&#x3002;&#x5E73;&#x5747;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x53EF;&#x4EE5;&#x8BC1;&#x660E;&#x5176;&#x6570;&#x91CF;&#x7EA7;&#x4E3A;$O(log_2n)$&#x3002;&#x7531;&#x4E8E;&#x5176;&#x5173;&#x952E;&#x5B57;&#x6BD4;&#x8F83;&#x548C;&#x4EA4;&#x6362;&#x662F;&#x8DF3;&#x8DC3;&#x5F0F;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5FEB;&#x901F;&#x6392;&#x5E8F;&#x662F;&#x4E00;&#x79CD;&#x4E0D;&#x7A33;&#x5B9A;&#x7684;&#x6392;&#x5E8F;&#x7B97;&#x6CD5;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#简介&quot;&gt;简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#代码实现&quot;&gt;代码实现&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#性能分析&quot;&gt;性能分析&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;快速排序（Quick Sort）是由图灵奖获得者Tony Hoare设计出来，被列为20世纪十大算法之一，以“快速”命名表明该算法在整体性能上是排序算法的王者。&lt;br&gt;核心思想是：通过一趟排序将待排序记录分割成独立的两部分，其中一部分记录关键字均比另一部分记录的关键字小，则可分别对这两部分记录继续进行排序，以达到整个序列有序的目的。一趟排序过程示意图如下。&lt;/p&gt;
    
    </summary>
    
      <category term="算法与数据结构" scheme="http://yoursite.com/categories/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
      <category term="算法与数据结构" scheme="http://yoursite.com/tags/%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>Retrofit2组件分析</title>
    <link href="http://yoursite.com/2018/11/19/retrofit2/"/>
    <id>http://yoursite.com/2018/11/19/retrofit2/</id>
    <published>2018-11-19T01:48:30.000Z</published>
    <updated>2018-11-19T01:55:41.658Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#1-&#x7B80;&#x4ECB;">1. &#x7B80;&#x4ECB;</a></li><li><a href="#2-&#x5173;&#x952E;&#x5206;&#x6790;">2. &#x5173;&#x952E;&#x5206;&#x6790;</a></li><li><a href="#3-&#x4E00;&#x4E9B;&#x7EC6;&#x8282;">3. &#x4E00;&#x4E9B;&#x7EC6;&#x8282;</a></li></ul><!-- tocstop --><h2 id="1-&#x7B80;&#x4ECB;"><a href="#1-&#x7B80;&#x4ECB;" class="headerlink" title="1. &#x7B80;&#x4ECB;"></a>1. &#x7B80;&#x4ECB;</h2><p>Retrofit2&#x662F;&#x7531;Square&#x516C;&#x53F8;&#x5F00;&#x6E90;&#x7684;HTTP&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x6846;&#x67B6;&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x6700;&#x8FD1;&#x9605;&#x8BFB;v2.4.0&#x6E90;&#x7801;&#xFF0C;&#x5728;&#x6B64;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x3002;<br>&#x5B98;&#x65B9;&#x4F7F;&#x7528;&#x7684;Demo&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GitHubService</span> </span>{</span><br><span class="line">  <span class="meta">@GET</span>(<span class="string">&quot;users/{user}/repos&quot;</span>)</span><br><span class="line">  Call&lt;List&lt;Repo&gt;&gt; listRepos(<span class="meta">@Path</span>(<span class="string">&quot;user&quot;</span>) String user);</span><br><span class="line">}</span><br><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">    .baseUrl(<span class="string">&quot;https://api.github.com/&quot;</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">GitHubService service = retrofit.create(GitHubService.class);</span><br><span class="line">Call&lt;List&lt;Repo&gt;&gt; repos = service.listRepos(<span class="string">&quot;octocat&quot;</span>);</span><br><span class="line"><span class="comment">// SYNCHRONOUS</span></span><br><span class="line">repos.execute()</span><br><span class="line"><span class="comment">//  ASYNCHRONOUS</span></span><br><span class="line">repos.enqueue(...)</span><br></pre></td></tr></table></figure></p><a id="more"></a><h2 id="2-&#x5173;&#x952E;&#x5206;&#x6790;"><a href="#2-&#x5173;&#x952E;&#x5206;&#x6790;" class="headerlink" title="2. &#x5173;&#x952E;&#x5206;&#x6790;"></a>2. &#x5173;&#x952E;&#x5206;&#x6790;</h2><p>&#x5173;&#x952E;&#x4EE3;&#x7801;&#x662F;<code>Retrofit#create(final Class&lt;T&gt; service)</code>&#xFF0C;&#x6838;&#x5FC3;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x628A;&#x5BA2;&#x6237;&#x7AEF;&#x5B9A;&#x4E49;&#x7684;interface&#x6784;&#x5EFA;&#x51FA;<code>HttpServiceMethod</code>&#x5BF9;&#x8C61;&#xFF0C;&#x91CD;&#x8981;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x6709;:</p><ul><li><code>callFactory : okhttp.Call.Factory</code>  &#x8D1F;&#x8D23;&#x5E95;&#x5C42;HTTP&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;OkHttp&#x7EC4;&#x4EF6;</li><li><code>requestFactory : RequestFactory</code>  &#x89E3;&#x6790;&#x5404;&#x79CD;&#x6CE8;&#x89E3;&#x751F;&#x6210;HTTP Request&#x7684;&#x53C2;&#x6570;</li><li><code>callAdapter : CallAdapter&lt;ResponseT, ReturnT&gt;</code> &#x7528;&#x4E8E;&#x628A;<code>ResponseT`</code>&#x8F6C;&#x5316;&#x6210;<code>ReturnT`&#xFF0C;</code>CallAdapter.Factory<code>&#x662F;&#x5176;&#x5DE5;&#x5382;&#x7C7B;&#x3002;Retrofit&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x53EF;&#x67E5;&#x770B;</code>ExecutorCallAdapterFactory<code>&#x7C7B;&#xFF0C;&#x5982;&#x679C;interface&#x51FD;&#x6570;&#x8FD4;&#x56DE;</code>Call&lt;?&gt;<code>&#x65F6;&#xFF0C;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;&#x8BE5;Adapter&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;</code>OkHttpCall<code>&#x5230;</code>ExecutorCallbackCall<code></code>&#x7684;&#x8F6C;&#x5316;&#xFF0C;&#x524D;&#x8005;&#x8868;&#x793A;&#x5E95;&#x5C42;&#x5177;&#x4F53;HTTP&#x8BF7;&#x6C42;&#xFF0C;&#x540E;&#x8005;&#x7528;&#x4E8E;&#x628A;&#x56DE;&#x8C03;&#x4ECE;&#x975E;&#x4E3B;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#x5230;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x6240;&#x4EE5;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x56DE;&#x8C03;&#x90FD;&#x662F;&#x5728;&#x4E3B;&#x7EBF;&#x7A0B;&#x4E2D;&#x3002;</li><li><code>responseConverter : Converter&lt;ResponseBody, ResponseT&gt;</code> &#x7528;&#x4E8E;HTTP&#x8BF7;&#x6C42;&#x8FD4;&#x56DE;&#x7684;ResponseBody&#x8F6C;&#x5316;&#x6210;ResponseT&#x5BF9;&#x8C61;&#xFF0C;&#x901A;&#x5E38;&#x4F7F;&#x7528;gson&#x4F20;&#x8F93;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;&#x63D0;&#x4F9B;<code>GsonResponseBodyConverter</code>&#x3002;&#x7CFB;&#x7EDF;&#x540C;&#x6837;&#x63D0;&#x4F9B;&#x5DE5;&#x5382;&#x7C7B;<code>Converter.Factory</code>:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>{</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * &#x7528;&#x4E8E;ResponseBody =&gt; type&#x7C7B;&#x578B;(&#x6BD4;&#x5982;&#x4F7F;&#x7528;Gson&#x8FDB;&#x884C;&#x89E3;&#x6790;)&#xFF0C;&#x5982;&#x679C;&#x8FD4;&#x56DE;null&#x5219;&#x8868;&#x793A;Factory&#x4E0D;&#x652F;&#x6301;&#x8BE5;type</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="meta">@Nullable</span> Converter&lt;ResponseBody, ?&gt; responseBodyConverter(Type type,</span><br><span class="line">       Annotation[] annotations, Retrofit retrofit) {...}</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * HTTP Request&#x751F;&#x6210;&#x65F6;&#xFF0C;type&#x7C7B;&#x578B; =&gt; RequestBody&#xFF0C;&#x5982;&#x679C;&#x8FD4;&#x56DE;null&#x8868;&#x793A;Factory&#x4E0D;&#x652F;&#x6301;&#x8BE5;type</span></span><br><span class="line"><span class="comment">    * &#x7528;&#x4E8E;&#x4F7F;&#x7528;<span class="doctag">@Body</span>/<span class="doctag">@Part</span>/<span class="doctag">@PartMap</span>&#x6CE8;&#x89E3;&#x7684;&#x53C2;&#x6570;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="meta">@Nullable</span> Converter&lt;?, RequestBody&gt; requestBodyConverter(Type type,</span><br><span class="line">       Annotation[] parameterAnnotations, Annotation[] methodAnnotations, Retrofit retrofit) {...}</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * HTTP Request&#x751F;&#x6210;&#x65F6;&#xFF0C;type&#x7C7B;&#x578B; =&gt; RequestBody&#xFF0C;&#x5982;&#x679C;&#x8FD4;&#x56DE;null&#x8868;&#x793A;Factory&#x4E0D;&#x652F;&#x6301;&#x8BE5;type</span></span><br><span class="line"><span class="comment">    * &#x7528;&#x4E8E;&#x4F7F;&#x7528;<span class="doctag">@Field</span>/<span class="doctag">@FieldMap</span>/<span class="doctag">@Header</span>/<span class="doctag">@HeaderMap</span>/<span class="doctag">@Path</span>/<span class="doctag">@Query</span>/<span class="doctag">@QueryMap</span>&#x6CE8;&#x89E3;&#x7684;&#x53C2;&#x6570;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="meta">@Nullable</span> Converter&lt;?, String&gt; stringConverter(Type type, Annotation[] annotations,</span><br><span class="line">       Retrofit retrofit) {...}</span><br></pre></td></tr></table></figure><p>&#x5177;&#x4F53;&#x53C2;&#x8003;Retrofit&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;<code>BuiltInConverters</code>&#x3002;Demo&#x4E2D;<code>Call&lt;List&lt;Repo&gt;&gt;#execute()</code>&#x53EF;&#x6839;&#x636E;<code>ExecutorCallbackCall#execute() -&gt; OkHttpCall#execute()</code>&#x7684;&#x6D41;&#x7A0B;&#x67E5;&#x770B;&#x6E90;&#x7801;&#x3002;</p><h2 id="3-&#x4E00;&#x4E9B;&#x7EC6;&#x8282;"><a href="#3-&#x4E00;&#x4E9B;&#x7EC6;&#x8282;" class="headerlink" title="3. &#x4E00;&#x4E9B;&#x7EC6;&#x8282;"></a>3. &#x4E00;&#x4E9B;&#x7EC6;&#x8282;</h2><ul><li>URL&#x62FC;&#x63A5;<br><code>Retrofit.Builder#baseUrl()</code>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;Base URL&#xFF0C;&#x5176;&#x5FC5;&#x987B;&#x4EE5;&#x201D;/&#x201C;&#x7ED3;&#x5C3E;&#xFF1B;&#x901A;&#x8FC7;<code>@GET(xxx)/@Url xxx</code>&#x7B49;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;Endpoint(<code>@Url</code>&#x4F18;&#x5148;&#x7EA7;&#x9AD8;&#x4E8E;<code>@Get(xxx)</code>)&#xFF0C;&#x4E24;&#x8005;&#x62FC;&#x63A5;&#x5F62;&#x6210;&#x8BF7;&#x6C42;&#x7684;URL&#xFF0C;&#x5171;&#x6709;&#x4EE5;&#x4E0B;&#x51E0;&#x79CD;&#x60C5;&#x51B5;:</li></ul><table><thead><tr><th style="text-align:left">Base URL</th><th style="text-align:left">Endpoint</th><th style="text-align:left">Result</th></tr></thead><tbody><tr><td style="text-align:left"><code>http://example.com/api/</code></td><td style="text-align:left"><code>foo/bar</code>(&#x76F8;&#x5BF9;&#x8DEF;&#x5F84;)</td><td style="text-align:left"><code>http://example.com/api/foo/bar/</code></td></tr><tr><td style="text-align:left"><code>http://example.com/api/</code></td><td style="text-align:left"><code>/foo/bar</code>&#xFF08;&#x7EDD;&#x5BF9;&#x8DEF;&#x5F84;&#xFF09;</td><td style="text-align:left"><code>http://example.com/foo/bar/</code></td></tr><tr><td style="text-align:left"><code>http://example.com/api/</code></td><td style="text-align:left"><code>https://foo.com/bar</code>(&#x5B8C;&#x6574;URL)</td><td style="text-align:left"><code>https://foo.com/bar</code></td></tr><tr><td style="text-align:left"><code>http://example.com/api/</code></td><td style="text-align:left"><code>//foo.com/bar</code>(&#x65E0;scheme)</td><td style="text-align:left"><code>http://foo.com/bar</code></td></tr></tbody></table><ul><li>HTTP&#x6CE8;&#x89E3;</li></ul><table><thead><tr><th style="text-align:left">Annotation</th><th style="text-align:left">&#x8BF4;&#x660E;</th></tr></thead><tbody><tr><td style="text-align:left"><code>@GET/@PUT/@POST/@PATCH/@DELETE/@HEAD/@OPTION</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#xFF0C;&#x8868;&#x793A;7&#x79CD;HTTP&#x8BF7;&#x6C42;&#x7C7B;&#x578B;</td></tr><tr><td style="text-align:left"><code>@HTTP</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;HTTP&#x8BF7;&#x6C42;</td></tr><tr><td style="text-align:left"><code>@FormUrlEncoded</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#xFF0C;&#x6807;&#x660E;request&#x4F7F;&#x7528;url encode,Content-Type&#x4E3A;application/x-www-form-urlencoded</td></tr><tr><td style="text-align:left"><code>@Field/@FieldMap</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#x53C2;&#x6570;&#xFF0C;&#x914D;&#x5408;<code>@FormUrlEncoded</code>&#x4F7F;&#x7528;&#xFF0C;&#x8868;&#x793A;Named pair&#x3002;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;Url encode&#x7F16;&#x7801;&#xFF0C;&#x901A;&#x8FC7;<code>encoded=true</code>&#x53EF;&#x5173;&#x95ED;&#x3002;<code>@Field</code>&#x652F;&#x6301;&#x53D8;&#x957F;&#x53C2;&#x6570;&#xFF0C;&#x6BD4;&#x5982;<code>@Field(&quot;name&quot;) String... names</code> &#x8F6C;&#x5316;&#x4E3A; <code>name=para0&amp;name=para1...</code>&#x3002;&#x6CE8;&#x610F;null&#x503C;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;</td></tr><tr><td style="text-align:left"><code>@Headers/@Header/@HeaderMap</code></td><td style="text-align:left">&#x7528;&#x4E8E;request&#x589E;&#x52A0;Header&#x53C2;&#x6570;&#xFF0C;&#x5176;&#x4E2D;<code>@Headers</code>&#x7528;&#x4E8E;&#x51FD;&#x6570;&#xFF0C;&#x5176;&#x4ED6;&#x4E24;&#x4E2A;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x3002;&#x6CE8;&#x610F;&#x76F8;&#x540C;Header&#x4E0D;&#x4F1A;override</td></tr><tr><td style="text-align:left"><code>@Query/@queryMap/@QueryName</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#x53C2;&#x6570;&#xFF0C;&#x8868;&#x793A;query parameter&#x3002;&#x9ED8;&#x8BA4;&#x4F7F;&#x7528;Url encode&#x7F16;&#x7801;&#xFF0C;&#x901A;&#x8FC7;<code>encoded=true</code>&#x53EF;&#x5173;&#x95ED;&#x3002;<code>@QueryName</code>&#x7528;&#x4E8E;&#x6CA1;&#x6709;value&#x7684;&#x60C5;&#x51B5;&#xFF0C;<code>@Query/@QueryName</code>&#x652F;&#x6301;&#x53D8;&#x957F;&#x53C2;&#x6570;&#xFF0C;null&#x503C;&#x540C;&#x6837;&#x4F1A;&#x88AB;&#x5FFD;&#x7565;</td></tr><tr><td style="text-align:left"><code>@Body</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#x53C2;&#x6570;&#xFF0C;&#x7528;&#x9014;&#x662F;PUST/PUT&#x8BF7;&#x6C42;&#x65F6;&#x4E0D;&#x4F7F;&#x7528;form&#x8868;&#x5355;&#xFF0C;&#x76F4;&#x63A5;&#x63A7;&#x5236;request body&#xFF0C;&#x9700;&#x8981;&#x6709;&#x5BF9;&#x5E94;&#x7684;converter&#x7C7B;&#x914D;&#x5408;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x652F;&#x6301;okhttp <code>RequestBody</code>&#x7C7B;</td></tr><tr><td style="text-align:left"><code>@Path</code></td><td style="text-align:left">URL Path&#x5360;&#x4F4D;&#x7B26;&#x53C2;&#x6570;&#xFF0C;&#x6BD4;&#x5982;<br><code>@GET(&quot;/image/{id}&quot;) Call&lt;ResponseBody&gt; example(@Path(&quot;id&quot;) int id);</code></td></tr><tr><td style="text-align:left"><code>@Url</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#x53C2;&#x6570;&#xFF0C;&#x53EF;&#x52A8;&#x6001;&#x4FEE;&#x6539;base URL&#xFF0C;&#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;</td></tr><tr><td style="text-align:left"><code>@Streaming</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#xFF0C;Retofit&#x9ED8;&#x8BA4;&#x4F1A;&#x628A;reponse body&#x653E;&#x4E8E;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;<code>@Streaming</code>&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5E95;&#x5C42;okhttp.ResponseBody&#x5BF9;&#x8C61;&#xFF0C;&#x6CE8;&#x610F;&#x9700;&#x8981;&#x624B;&#x52A8;&#x63A7;&#x5236;close</td></tr><tr><td style="text-align:left"><code>@Multipart</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#xFF0C;&#x6807;&#x660E;request body&#x662F;multi-part</td></tr><tr><td style="text-align:left"><code>@Part/@PartMap</code></td><td style="text-align:left">&#x4F5C;&#x7528;&#x4E8E;&#x51FD;&#x6570;&#x53C2;&#x6570;&#xFF0C;&#x901A;&#x8FC7;value&#x8BBE;&#x7F6E;&#x6BCF;&#x4E2A;part&#x7684;name&#xFF0C;encode&#x8BBE;&#x7F6E;&#x6BCF;&#x4E2A;part&#x7684;Content-Transfer-Encoding&#x3002;&#x9ED8;&#x8BA4;&#x652F;&#x6301;&#x53C2;&#x6570;&#x7C7B;&#x578B;MultipartBody.Part&#x548C;RequestBody&#xFF0C;&#x5176;&#x4ED6;&#x7C7B;&#x578B;&#x9700;&#x8981;converter</td></tr></tbody></table><ul><li><p>&#x5982;&#x679C;&#x4E0D;&#x5173;&#x5FC3;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x53EF;&#x4F7F;&#x7528;<code>Call&lt;Void&gt;/Call&lt;Unit&gt;</code>&#x3002;</p></li><li><p>&#x6574;&#x4F53;Retrofit2&#x53EF;&#x6269;&#x5C55;&#x6027;&#x975E;&#x5E38;&#x597D;&#xFF0C;&#x5404;&#x79CD;&#x53C2;&#x6570;&#x7684;&#x8F6C;&#x5316;/&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x7684;&#x89E3;&#x6790;&#x901A;&#x8FC7;<code>Converter.Factory/Converter</code>&#x63A5;&#x53E3;&#x5B9E;&#x73B0;&#xFF0C;&#x53C2;&#x8003;<code>com.squareup.retrofit2:converter-gson</code>&#x5BF9;Gson&#x7684;&#x652F;&#x6301;&#x3002;&#x5982;&#x679C;&#x5BF9;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x7684;&#x627F;&#x8F7D;&#x7C7B;&#x578B;&#x6709;&#x6240;&#x8981;&#x6C42;&#xFF0C;&#x53EF;&#x5B9E;&#x73B0;<code>CallAdapter.Factory/CallAdapter</code>&#x63A5;&#x53E3;&#xFF0C;&#x6BD4;&#x5982;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;LiveData&#x5BF9;&#x8C61;&#xFF0C;&#x4ECE;google sample&#x622A;&#x53D6;&#x5982;&#x4E0B;(&#x53EF;&#x7528;&#x4E8E;&#x81EA;&#x5DF1;&#x5DE5;&#x7A0B;&#x4E2D;)&#xFF1A;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">class LiveDataCallAdapterFactory : Factory() {</span><br><span class="line">    <span class="function">override fun <span class="title">get</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        returnType: Type,</span></span></span><br><span class="line"><span class="function"><span class="params">        annotations: Array&lt;Annotation&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">        retrofit: Retrofit</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>: CallAdapter&lt;*, *&gt;? </span>{</span><br><span class="line">        <span class="keyword">if</span> (Factory.getRawType(returnType) != LiveData::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>) </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span></span><br><span class="line">        }</span><br><span class="line">        val observableType = Factory.getParameterUpperBound(<span class="number">0</span>, returnType as ParameterizedType)</span><br><span class="line">        val rawObservableType = Factory.getRawType(observableType)</span><br><span class="line">        <span class="keyword">if</span> (rawObservableType != ApiResponse::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>) </span>{   <span class="comment">// &#x7F51;&#x7EDC;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#x89E3;&#x6790;&#x4E3A;ApiResponse</span></span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;type must be a resource&quot;</span>)</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (observableType !is ParameterizedType) {</span><br><span class="line">            <span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;resource must be parameterized&quot;</span>)</span><br><span class="line">        }</span><br><span class="line">        val bodyType = Factory.getParameterUpperBound(<span class="number">0</span>, observableType)</span><br><span class="line">        <span class="keyword">return</span> LiveDataCallAdapter&lt;Any&gt;(bodyType)</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">class LiveDataCallAdapter&lt;R&gt;(private val responseType: Type) :</span><br><span class="line">    CallAdapter&lt;R, LiveData&lt;ApiResponse&lt;R&gt;&gt;&gt; {</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">responseType</span><span class="params">()</span> </span>= responseType</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">adapt</span><span class="params">(call: Call&lt;R&gt;)</span>: LiveData&lt;ApiResponse&lt;R&gt;&gt; </span>{</span><br><span class="line">        <span class="keyword">return</span> object : LiveData&lt;ApiResponse&lt;R&gt;&gt;() {</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">var</span> started = AtomicBoolean(<span class="keyword">false</span>)</span><br><span class="line">            <span class="function">override fun <span class="title">onActive</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">super</span>.onActive()</span><br><span class="line">                <span class="keyword">if</span> (started.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>)) {</span><br><span class="line">                    call.enqueue(object : Callback&lt;R&gt; {</span><br><span class="line">                        <span class="function">override fun <span class="title">onResponse</span><span class="params">(call: Call&lt;R&gt;, response: Response&lt;R&gt;)</span> </span>{</span><br><span class="line">                            postValue(ApiResponse.create(response))</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="function">override fun <span class="title">onFailure</span><span class="params">(call: Call&lt;R&gt;, throwable: Throwable)</span> </span>{</span><br><span class="line">                            postValue(ApiResponse.create(throwable))</span><br><span class="line">                        }</span><br><span class="line">                    })</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-简介&quot;&gt;1. 简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-关键分析&quot;&gt;2. 关键分析&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-一些细节&quot;&gt;3. 一些细节&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;1-简介&quot;&gt;&lt;a href=&quot;#1-简介&quot; class=&quot;headerlink&quot; title=&quot;1. 简介&quot;&gt;&lt;/a&gt;1. 简介&lt;/h2&gt;&lt;p&gt;Retrofit2是由Square公司开源的HTTP网络请求框架的封装，最近阅读v2.4.0源码，在此记录一下。&lt;br&gt;官方使用的Demo：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;GitHubService&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@GET&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;users/&amp;#123;user&amp;#125;/repos&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Call&amp;lt;List&amp;lt;Repo&amp;gt;&amp;gt; listRepos(&lt;span class=&quot;meta&quot;&gt;@Path&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;user&quot;&lt;/span&gt;) String user);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Retrofit retrofit = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Retrofit.Builder()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .baseUrl(&lt;span class=&quot;string&quot;&gt;&quot;https://api.github.com/&quot;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    .build();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;GitHubService service = retrofit.create(GitHubService.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Call&amp;lt;List&amp;lt;Repo&amp;gt;&amp;gt; repos = service.listRepos(&lt;span class=&quot;string&quot;&gt;&quot;octocat&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// SYNCHRONOUS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;repos.execute()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//  ASYNCHRONOUS&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;repos.enqueue(...)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>okhttp组件学习</title>
    <link href="http://yoursite.com/2018/10/29/okhttp/"/>
    <id>http://yoursite.com/2018/10/29/okhttp/</id>
    <published>2018-10-29T07:34:43.000Z</published>
    <updated>2018-10-29T07:58:49.721Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x7B80;&#x4ECB;">&#x7B80;&#x4ECB;</a></li><li><a href="#&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x961F;&#x5217;-dispatcher">&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x961F;&#x5217; Dispatcher</a></li><li><a href="#socket&#x8FDE;&#x63A5;&#x6C60;-connectionpool">Socket&#x8FDE;&#x63A5;&#x6C60; ConnectionPool</a></li><li><a href="#&#x7F13;&#x5B58;&#x7BA1;&#x7406;">&#x7F13;&#x5B58;&#x7BA1;&#x7406;</a></li><li><a href="#https">HTTPS</a></li></ul><!-- tocstop --><h2 id="&#x7B80;&#x4ECB;"><a href="#&#x7B80;&#x4ECB;" class="headerlink" title="&#x7B80;&#x4ECB;"></a>&#x7B80;&#x4ECB;</h2><p>OkHttp&#x662F;&#x4E00;&#x4E2A;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x7EC4;&#x4EF6;,&#x8981;&#x6C42;Android2.3&#x4EE5;&#x4E0A;&#x6216;&#x8005;JDK1.7&#x4EE5;&#x4E0A;,&#x6700;&#x8FD1;&#x91CD;&#x65B0;&#x8BFB;&#x5176;&#x6E90;&#x7801;,&#x5BF9;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x90E8;&#x5206;&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;.</p><h2 id="&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x961F;&#x5217;-dispatcher"><a href="#&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x961F;&#x5217;-Dispatcher" class="headerlink" title="&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x961F;&#x5217; Dispatcher"></a>&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x961F;&#x5217; Dispatcher</h2><ul><li><p><code>Call#execute()</code>&#x540C;&#x6B65;&#x8BF7;&#x6C42;&#x524D;&#x4F1A;&#x8FDB;&#x5165;<code>Dispacher#runningSyncCalls</code>&#x961F;&#x5217;,&#x5B8C;&#x6210;&#x540E;remove</p></li><li><p><code>Call#enqueue()</code>&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x4F1A;&#x8FDB;&#x5165;<code>Dispatchder#runningAsyncCalls</code>&#x961F;&#x5217;,&#x8FD9;&#x91CC;&#x6709;&#x9650;&#x5236;&#x6761;&#x4EF6;&#xFF1A;<code>maxRequests&lt;=64 &amp;&amp; maxRequestsPerHost&lt;=5</code>,&#x4E0D;&#x6EE1;&#x8DB3;&#x5219;&#x653E;&#x5165;<code>Dispatcher#readyAsyncCalls</code>,&#x8FD9;&#x4E9B;&#x503C;&#x53EF;&#x901A;&#x8FC7;<code>#setMaxRequests()</code>&#x548C;<code>#setMaxRequestsPerHost()</code>&#x8BBE;&#x7F6E;. </p></li><li><p>&#x5F02;&#x6B65;&#x6267;&#x884C;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x9ED8;&#x8BA4;&#x8BBE;&#x7F6E;&#x4E3A;: </p></li></ul><table><thead><tr><th style="text-align:left">CorePoolSize</th><th style="text-align:left">MaximumPoolSize</th><th style="text-align:left">KeepAliveTime</th><th style="text-align:left">WorkQueue</th></tr></thead><tbody><tr><td style="text-align:left">0</td><td style="text-align:left">Integer.MAX_VALUE</td><td style="text-align:left">60s</td><td style="text-align:left">SynchronousQueue</td></tr></tbody></table><ul><li><code>Dispatcher#setIdleCallback()</code>&#x7528;&#x4E8E;&#x8BBE;&#x7F6E;&#x5728;&#x540C;&#x6B65;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x548C;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#x5747;&#x4E3A;&#x7A7A;&#x65F6;&#x6267;&#x884C;&#x4E00;&#x6B21;callback</li></ul><a id="more"></a><h2 id="socket&#x8FDE;&#x63A5;&#x6C60;-connectionpool"><a href="#Socket&#x8FDE;&#x63A5;&#x6C60;-ConnectionPool" class="headerlink" title="Socket&#x8FDE;&#x63A5;&#x6C60; ConnectionPool"></a>Socket&#x8FDE;&#x63A5;&#x6C60; ConnectionPool</h2><p>HTTP&#x548C;HTTP/2&#x8BF7;&#x6C42;&#x76F8;&#x540C;&#x5730;&#x5740;&#x65F6;&#x4F1A;&#x5171;&#x4EAB;&#x4E00;&#x4E2A;Connection.</p><blockquote><p><code>ConnectionPool#maxIdleConnections</code>&#x7528;&#x4E8E;&#x6807;&#x8BC6;&#x8FDE;&#x63A5;&#x6C60;&#x4E2D;&#x6700;&#x591A;&#x53EF;&#x7A7A;&#x95F2;&#x7684;&#x8FDE;&#x63A5;&#x6570;,&#x9ED8;&#x8BA4;&#x662F;5</p></blockquote><blockquote><p><code>ConnectionPool#keepAliveDurationNs</code>&#x6807;&#x8BC6;&#x8FDE;&#x63A5;&#x53EF;&#x7A7A;&#x95F2;&#x7684;&#x6700;&#x5927;&#x65F6;&#x95F4;,&#x9ED8;&#x8BA4;&#x662F;5min</p></blockquote><blockquote><p>&#x901A;&#x8FC7;<code>ConnectionPool#cleanupRunnable</code>&#x5BF9;&#x8FC7;&#x671F;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;remove&#x64CD;&#x4F5C;.</p></blockquote><h2 id="&#x7F13;&#x5B58;&#x7BA1;&#x7406;"><a href="#&#x7F13;&#x5B58;&#x7BA1;&#x7406;" class="headerlink" title="&#x7F13;&#x5B58;&#x7BA1;&#x7406;"></a>&#x7F13;&#x5B58;&#x7BA1;&#x7406;</h2><ul><li><strong><code>CacheInterceptor</code></strong> </li></ul><p>&#x7528;&#x4E8E;request&#x7F13;&#x5B58;&#x5B9E;&#x73B0;,&#x5176;&#x4E2D;&#x5BF9;request&#x83B7;&#x53D6;&#x7F13;&#x5B58;response&#x662F;&#x901A;&#x8FC7;<code>CacheStrategy</code>&#x5B9E;&#x73B0;&#x7684;,&#x53D1;&#x9001;request&#x65F6;&#x53EF;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;<code>CacheControl</code>(&#x4E5F;&#x5C31;&#x662F;&#x5934;&#x90E8;Cache-Control&#x5B57;&#x6BB5;)&#x5B9E;&#x73B0;&#x7F13;&#x5B58;&#x63A7;&#x5236;,&#x5176;&#x4E2D;&#x5185;&#x7F6E;&#x4E24;&#x79CD;&#x7B56;&#x7565;:</p><table><thead><tr><th style="text-align:left"><code>FORCE_NETWORK</code></th><th style="text-align:left"><code>FORCE_CACHE</code></th></tr></thead><tbody><tr><td style="text-align:left">&#x5F3A;&#x5236;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;</td><td style="text-align:left">&#x5F3A;&#x5236;&#x4EC5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</td></tr></tbody></table><ul><li><strong>&#x5224;&#x65AD;&#x7F13;&#x5B58;&#x7684;response&#x662F;&#x5426;&#x53EF;&#x7528;</strong></li></ul><p>1.&#x5982;&#x679C;request Header&#x548C;response Header&#x5B58;&#x5728;<code>Cache-Control:no-store</code>&#x5219;&#x4E0D;&#x4F7F;&#x7528;&#x7F13;&#x5B58;(&#x5982;&#x679C;response HTTP Code&#x4E3A;302/307&#x65F6;,&#x8FD8;&#x9700;&#x5224;&#x65AD;Header&#x662F;&#x5426;&#x5B58;&#x5728;<code>Expires</code>&#x6216;&#x8005;Cache-Control&#x503C;&#x662F;&#x4E0D;&#x662F;<code>max-age/public/private</code>)</p><p>2.&#x5982;&#x679C;request Header&#x5B58;&#x5728;<code>If-Modified-Since</code>&#x6216;<code>If-None-Match</code>&#x5219;&#x9700;&#x8981;&#x8FDB;&#x884C;Conditional Request</p><p>3.&#x5982;&#x679C;response Header&#x5B58;&#x5728;<code>Cache-control: immutable</code>&#x5219;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</p><p>4.&#x6839;&#x636E;Refreshness&#x5224;&#x65AD;</p><blockquote><p>a.&#x6839;&#x636E;RFC7234-4.2.3&#x8BA1;&#x7B97;response&#x7684;current_age</p><p>b.&#x8BA1;&#x7B97;response&#x7684;freshness_time. &#x8BA1;&#x7B97;&#x8BE5;&#x503C;&#x6240;&#x4F7F;&#x7528;&#x5B57;&#x6BB5;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4E3A;<code>Cache-Control:max-age &gt; Date &gt; Last-Modified</code>; &#x5982;&#x679C;request&#x8BBE;&#x7F6E;&#x4E86;<code>Cache-Control:max-age</code>&#x5219;freshness_time&#x53D6;&#x4E0A;&#x8FF0;&#x4E24;&#x4E2A;&#x503C;&#x7684;&#x6700;&#x5C0F;&#x503C;</p><p>c.request&#x7684;<code>Cache-Control:min-fresh</code>&#x503C;min_fresh_value(&#x65E0;&#x5219;&#x4E3A;0)</p><p>d.&#x5982;&#x679C;response&#x6CA1;&#x6709;&#x8BBE;&#x7F6E;<code>Cache-control: must-revalidate</code>&#x5219;&#x53D6;request<code>Cache-Control: max-stale</code>&#x503C;max_stale_value(&#x65E0;&#x5219;&#x4E3A;0)</p></blockquote><p>&#x5982;&#x679C;&#x6EE1;&#x8DB3;<code>current_age + min_fresh_value &lt; freshness_time + max_stale_value</code>&#x5219;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x7F13;&#x5B58;</p><p>5.&#x4E0A;&#x8FF0;&#x6761;&#x4EF6;&#x4E0D;&#x6EE1;&#x8DB3;&#x5219;&#x53D1;&#x9001;Condition request. Header condition&#x53D6;&#x503C;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4E3A;:<code>If-None-Match:&lt;Etag-Value&gt;</code> &gt; <code>If-Modified-Since:&lt;Last-Modified-Value&gt;</code> &gt; <code>If-Modified-Since:Date-Value&gt;</code></p><ul><li><strong>Cache&#x672C;&#x5730;&#x5B58;&#x50A8;</strong></li></ul><p>&#x672C;&#x5730;Cache&#x7684;&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x662F;<code>DiskLruCache</code>,&#x5305;&#x62EC;&#x4E00;&#x4E2A;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;(journal)&#x548C;&#x82E5;&#x5E72;&#x5B58;&#x50A8;&#x6587;&#x4EF6;&#x7EC4;&#x6210;.&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x7684;&#x903B;&#x8F91;&#x7ED3;&#x6784;&#x5982;&#x4E0B;:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">libcore.io.DiskLruCache     // &quot;magic number&quot;</span><br><span class="line">1                           // cache version </span><br><span class="line">201105                      // application version</span><br><span class="line">2                           // value count</span><br><span class="line">                            // &#x7A7A;&#x884C;</span><br><span class="line">CLEAN 3400330d1dfc7f3f7f4b8d4d803dfcf6 832 21054</span><br><span class="line">DIRTY 335c4c6028171cfddfbaae1a9c313c52</span><br><span class="line">CLEAN 335c4c6028171cfddfbaae1a9c313c52 3934 2342</span><br><span class="line">REMOVE 335c4c6028171cfddfbaae1a9c313c52</span><br><span class="line">DIRTY 1ab96a171faeeee38496d8b330771a7a</span><br><span class="line">CLEAN 1ab96a171faeeee38496d8b330771a7a 1600 234</span><br><span class="line">READ 335c4c6028171cfddfbaae1a9c313c52</span><br><span class="line">READ 3400330d1dfc7f3f7f4b8d4d803dfcf6</span><br></pre></td></tr></table></figure></p><p>&#x6BCF;&#x4E00;&#x884C;&#x65E5;&#x5FD7;&#x8BB0;&#x5F55;&#x7531;&#x4E09;&#x90E8;&#x5206;&#x7EC4;&#x6210;:</p><p>1.<strong>State</strong></p><table><thead><tr><th style="text-align:left">state</th><th style="text-align:left">description</th></tr></thead><tbody><tr><td style="text-align:left">DIRTY</td><td style="text-align:left">&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x5F00;&#x59CB;&#x88AB;&#x7F16;&#x8F91;&#x7684;&#x72B6;&#x6001;(create/update)</td></tr><tr><td style="text-align:left">CLEAN</td><td style="text-align:left">&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x66F4;&#x65B0;&#x5B8C;&#x6210;&#x7684;&#x72B6;&#x6001;(commit)</td></tr><tr><td style="text-align:left">READ</td><td style="text-align:left">&#x8BFB;&#x53D6;&#x7F13;&#x5B58;&#x6587;&#x4EF6;</td></tr><tr><td style="text-align:left">REMOVE</td><td style="text-align:left">&#x79FB;&#x9664;&#x8BE5;&#x7F13;&#x5B58;&#x6587;&#x4EF6;</td></tr></tbody></table><p>&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#x91C7;&#x7528;&#x4E8B;&#x52A1;&#x5904;&#x7406;&#x65B9;&#x5F0F;,&#x5373;&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x524D;&#x5148;&#x5199;&#x5165;&#x4E00;&#x4E2A;&#x540C;&#x540D;tmp&#x6587;&#x4EF6;,&#x5F53;&#x6240;&#x6709;&#x5185;&#x5BB9;&#x5199;&#x5B8C;&#x540E;&#x5C06;tmp &#x6587;&#x4EF6;&#x7684;&#x6269;&#x5C55;&#x540D;&#x53BB;&#x6389;&#x4EE5;&#x8986;&#x76D6;&#x539F;&#x6709;&#x6587;&#x4EF6;.&#x6240;&#x4EE5;&#x901A;&#x5E38;DIRTY&#x540E;&#x4F1A;&#x8DDF;&#x7740;CLEAN/REMOVE,&#x5982;&#x679C;&#x4E0D;&#x5B58;&#x5728;,&#x5219;&#x8868;&#x660E;&#x8FD9;&#x662F;&#x4E00;&#x6761;&#x65E0;&#x6548;&#x8BB0;&#x5F55;.</p><p>2.<strong>Key</strong>:  OKHttp&#x4F7F;&#x7528;url&#x7684;md5&#x503C;</p><p>3.<strong>optional state-specific values</strong></p><p>OkHttp&#x8BBE;&#x7F6E;value count&#x4E3A;2(&#x5BF9;&#x5E94;&#x7B2C;&#x56DB;&#x884C;),&#x6240;&#x4EE5;&#x662F;&#x4E24;&#x4E2A;&#x503C;. &#x8BE5;&#x503C;&#x8868;&#x793A;&#x7F13;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x5927;&#x5C0F;(&#x5355;&#x4F4D;:byte).&#x4E24;&#x4E2A;&#x7F13;&#x5B58;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x548C;&#x5185;&#x5BB9;:</p><table><thead><tr><th style="text-align:left">&#x6587;&#x4EF6;&#x540D;</th><th style="text-align:left">&#x5185;&#x5BB9;</th></tr></thead><tbody><tr><td style="text-align:left"><code>&lt;Key_value&gt;.0</code></td><td style="text-align:left">&#x5305;&#x62EC;request/response Header&#x7B49;&#x7684;METADATA</td></tr><tr><td style="text-align:left"><code>&lt;Key_value&gt;.1</code></td><td style="text-align:left">response body</td></tr></tbody></table><p>Cache&#x521D;&#x59CB;&#x5316;&#x65F6;&#x8BFB;&#x53D6;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;,&#x4F7F;&#x7528;LinkedHashMap&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x751F;&#x6210;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x7684;&#x7D22;&#x5F15;,&#x5176;&#x4E2D;Key&#x662F;url&#x7684;md5&#x503C;,Value&#x662F;&#x4FDD;&#x5B58;&#x7F13;&#x5B58;&#x6587;&#x4EF6;File&#x7684;Entry&#x5BF9;&#x8C61;.<br>LinkedHashMap&#x521D;&#x59CB;&#x5316;&#x65F6;&#x8BBE;&#x7F6E;accessOrder&#x4E3A;true,&#x5F53;&#x7F13;&#x5B58;&#x6587;&#x4EF6;&#x8D85;&#x8FC7;&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;&#x7684;&#x6700;&#x5927;&#x503C;&#x65F6;,&#x53EA;&#x9700;&#x8981;remove&#x5934;&#x90E8;&#x5BF9;&#x8C61;&#x5C31;&#x5B9E;&#x73B0;&#x4E86;LRU&#x7B97;&#x6CD5;.<br>&#x540C;&#x65F6;,&#x5F53;&#x65E5;&#x5FD7;&#x6587;&#x4EF6;&#x8BB0;&#x5F55;&#x6761;&#x6570;&#x5927;&#x4E8E;&#x9608;&#x503C;(2000)&#x5E76;&#x4E14;&#x8BB0;&#x5F55;&#x6761;&#x6570;&#x5927;&#x4E8E;LinkedHashMap&#x7684;size&#x65F6;&#x9700;&#x8981;&#x8FDB;&#x884C;&#x91CD;&#x5EFA;,&#x5176;&#x903B;&#x8F91;&#x662F;&#x904D;&#x5386;LinkedHashMap,&#x6839;&#x636E;&#x5176;&#x662F;&#x5426;&#x6B63;&#x5728;&#x7F16;&#x8F91;&#x6765;&#x5199;&#x5165;DIRTY&#x6216;CLEAN&#x8BB0;&#x5F55;.<br></p><p>&#x53E6;&#x5916;,<code>DiskLruCache#get()</code>&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;<code>DiskLruCache#Snapshot</code>&#x5BF9;&#x8C61;,&#x8868;&#x793A;&#x7F13;&#x5B58;Entry&#x7684;&#x67D0;&#x4E00;&#x7248;&#x672C;,&#x7531;Entry&#x6210;&#x5458;&#x53D8;&#x91CF;sequenceNumber&#x8868;&#x793A;.&#x4FEE;&#x6539;&#x6570;&#x636E;&#x65F6;&#x4F1A;&#x6BD4;&#x8F83;<code>Snapshot#sequenceNumber</code>&#x4E0E;&#x5BF9;&#x5E94;&#x7684;<code>Entry#sequenceNumber</code>,&#x5982;&#x679C;&#x4E0D;&#x76F8;&#x7B49;&#x5219;&#x8BF4;&#x660E;&#x7F13;&#x5B58;&#x7248;&#x672C;&#x5DF2;&#x5931;&#x6548;,&#x65E0;&#x6CD5;&#x8FDB;&#x884C;&#x7F16;&#x8F91;.</p><h2 id="https"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h2><p>1.&#x901A;&#x8FC7;<code>ConnectionSpec</code>&#x53EF;&#x4EE5;&#x6307;&#x5B9A;tls&#x7248;&#x672C;&#x53F7;&#x548C;&#x652F;&#x6301;&#x7684;cipher suites,&#x5F53;&#x524D;&#x7248;&#x672C;&#x914D;&#x7F6E;&#x53C2;&#x8003;<code>ConnectionSpec#MODERN_TLS</code>,&#x5176;&#x4E2D;&#x9ED8;&#x8BA4;&#x5141;&#x8BB8;tls1.0~tls1.3,&#x800C;&#x4E14;&#x5141;&#x8BB8;&#x534F;&#x5546;&#x5931;&#x8D25;&#x65F6;&#x5C1D;&#x8BD5;&#x660E;&#x6587;&#x4F20;&#x8F93;.</p><p>2.&#x63D0;&#x4F9B;<code>Certificate Pinning</code>&#x80FD;&#x529B;,&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x5C31;&#x662F;&#x5BF9;&#x670D;&#x52A1;&#x7AEF;&#x63D0;&#x4F9B;&#x8BC1;&#x4E66;&#x7684;&#x516C;&#x94A5;&#x8FDB;&#x884C;&#x6821;&#x9A8C;,&#x5B98;&#x65B9;Demo&#x5982;&#x4E0B;:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CertificatePinning</span><span class="params">()</span> </span>{</span><br><span class="line">  client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">      .certificatePinner(<span class="keyword">new</span> CertificatePinner.Builder()</span><br><span class="line">          .add(<span class="string">&quot;publicobject.com&quot;</span>,</span><br><span class="line">          <span class="string">&quot;sha256/afwiKY3RxoMmLkuRW1l7QsPZTJPwDS2pdDROQjXw8ig=&quot;</span>) <span class="comment">// &#x670D;&#x52A1;&#x7AEF;&#x8BC1;&#x4E66;&#x7684;&#x516C;&#x94A5;hash&#x503C;</span></span><br><span class="line">          .build())</span><br><span class="line">      .build();</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>3.&#x81EA;&#x5B9A;&#x4E49;&#x4FE1;&#x4EFB;&#x8BC1;&#x4E66;<br>&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x662F;&#x57FA;&#x4E8E;JSSE&#x6846;&#x67B6;,&#x4F7F;&#x7528;&#x81EA;&#x6709;&#x8BC1;&#x4E66;&#x6784;&#x5EFA;X509TrustManager&#x5BF9;&#x8C61;&#x5373;&#x53EF;,&#x5B98;&#x65B9;Demo&#x5982;&#x4E0B;:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generate X509Manager by custom certification</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> X509TrustManager <span class="title">trustManagerForCertificates</span><span class="params">(InputStream in)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> GeneralSecurityException </span>{</span><br><span class="line">    CertificateFactory certificateFactory = CertificateFactory.getInstance(<span class="string">&quot;X.509&quot;</span>);</span><br><span class="line">    Collection&lt;? extends Certificate&gt; certificates = certificateFactory.generateCertificates(in);</span><br><span class="line">    <span class="keyword">if</span> (certificates.isEmpty()) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;expected non-empty set of trusted certificates&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Put the certificates a key store.</span></span><br><span class="line">    <span class="keyword">char</span>[] password = <span class="string">&quot;password&quot;</span>.toCharArray(); <span class="comment">// Any password will work.</span></span><br><span class="line">    KeyStore keyStore = newEmptyKeyStore(password);</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Certificate certificate : certificates) {</span><br><span class="line">      String certificateAlias = Integer.toString(index++);</span><br><span class="line">      keyStore.setCertificateEntry(certificateAlias, certificate);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use it to build an X509 trust manager.</span></span><br><span class="line">    KeyManagerFactory keyManagerFactory = KeyManagerFactory.getInstance(</span><br><span class="line">        KeyManagerFactory.getDefaultAlgorithm());</span><br><span class="line">    keyManagerFactory.init(keyStore, password);</span><br><span class="line">    TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(</span><br><span class="line">        TrustManagerFactory.getDefaultAlgorithm());</span><br><span class="line">    trustManagerFactory.init(keyStore);</span><br><span class="line">    TrustManager[] trustManagers = trustManagerFactory.getTrustManagers();</span><br><span class="line">    <span class="keyword">if</span> (trustManagers.length != <span class="number">1</span> || !(trustManagers[<span class="number">0</span>] <span class="keyword">instanceof</span> X509TrustManager)) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Unexpected default trust managers:&quot;</span></span><br><span class="line">          + Arrays.toString(trustManagers));</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> (X509TrustManager) trustManagers[<span class="number">0</span>];</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> KeyStore <span class="title">newEmptyKeyStore</span><span class="params">(<span class="keyword">char</span>[] password)</span> <span class="keyword">throws</span> GeneralSecurityException </span>{</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">      InputStream in = <span class="keyword">null</span>; <span class="comment">// By convention, &apos;null&apos; creates an empty key store.</span></span><br><span class="line">      keyStore.load(in, password);</span><br><span class="line">      <span class="keyword">return</span> keyStore;</span><br><span class="line">    } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(e);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// client </span></span><br><span class="line">    X509TrustManager trustManager;</span><br><span class="line">    SSLSocketFactory sslSocketFactory;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      trustManager = trustManagerForCertificates(trustedCertificatesInputStream());</span><br><span class="line">      SSLContext sslContext = SSLContext.getInstance(<span class="string">&quot;TLS&quot;</span>);</span><br><span class="line">      sslContext.init(<span class="keyword">null</span>, <span class="keyword">new</span> TrustManager[] { trustManager }, <span class="keyword">null</span>);</span><br><span class="line">      sslSocketFactory = sslContext.getSocketFactory();</span><br><span class="line">    } <span class="keyword">catch</span> (GeneralSecurityException e) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    client = <span class="keyword">new</span> OkHttpClient.Builder()</span><br><span class="line">        .sslSocketFactory(sslSocketFactory, trustManager)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#简介&quot;&gt;简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#网络请求队列-dispatcher&quot;&gt;网络请求队列 Dispatcher&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#socket连接池-connectionpool&quot;&gt;Socket连接池 ConnectionPool&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#缓存管理&quot;&gt;缓存管理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#https&quot;&gt;HTTPS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;OkHttp是一个HTTP客户端组件,要求Android2.3以上或者JDK1.7以上,最近重新读其源码,对感兴趣的部分记录一下.&lt;/p&gt;
&lt;h2 id=&quot;网络请求队列-Dispatcher&quot;&gt;&lt;a href=&quot;#网络请求队列-Dispatcher&quot; class=&quot;headerlink&quot; title=&quot;网络请求队列 Dispatcher&quot;&gt;&lt;/a&gt;网络请求队列 Dispatcher&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;Call#execute()&lt;/code&gt;同步请求前会进入&lt;code&gt;Dispacher#runningSyncCalls&lt;/code&gt;队列,完成后remove&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;Call#enqueue()&lt;/code&gt;异步请求会进入&lt;code&gt;Dispatchder#runningAsyncCalls&lt;/code&gt;队列,这里有限制条件：&lt;code&gt;maxRequests&amp;lt;=64 &amp;amp;&amp;amp; maxRequestsPerHost&amp;lt;=5&lt;/code&gt;,不满足则放入&lt;code&gt;Dispatcher#readyAsyncCalls&lt;/code&gt;,这些值可通过&lt;code&gt;#setMaxRequests()&lt;/code&gt;和&lt;code&gt;#setMaxRequestsPerHost()&lt;/code&gt;设置. &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;异步执行的线程池默认设置为: &lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:left&quot;&gt;CorePoolSize&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;MaximumPoolSize&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;KeepAliveTime&lt;/th&gt;
&lt;th style=&quot;text-align:left&quot;&gt;WorkQueue&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:left&quot;&gt;0&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;Integer.MAX_VALUE&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;60s&lt;/td&gt;
&lt;td style=&quot;text-align:left&quot;&gt;SynchronousQueue&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Dispatcher#setIdleCallback()&lt;/code&gt;用于设置在同步请求队列和异步请求队列均为空时执行一次callback&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>设计模式笔记</title>
    <link href="http://yoursite.com/2017/04/05/design-pattern-note/"/>
    <id>http://yoursite.com/2017/04/05/design-pattern-note/</id>
    <published>2017-04-05T12:26:30.000Z</published>
    <updated>2017-04-05T13:57:26.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x516D;&#x5927;&#x539F;&#x5219;"><a href="#&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x516D;&#x5927;&#x539F;&#x5219;" class="headerlink" title="&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x516D;&#x5927;&#x539F;&#x5219;"></a>&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x516D;&#x5927;&#x539F;&#x5219;</h2><ol><li>Single Responsibility Principle</li><li>Open Close Principle</li><li>Liskov Substitution Principle</li><li>Dependence Inversion Principle</li><li>Interface Segregation Principle</li><li>Law of Demeter</li></ol><h2 id="&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x53EF;&#x590D;&#x7528;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8F6F;&#x4EF6;&#x7684;&#x57FA;&#x7840;23&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"><a href="#&#x300A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;-&#x53EF;&#x590D;&#x7528;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8F6F;&#x4EF6;&#x7684;&#x57FA;&#x7840;&#x300B;23&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF1A;" class="headerlink" title="&#x300A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;:&#x53EF;&#x590D;&#x7528;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8F6F;&#x4EF6;&#x7684;&#x57FA;&#x7840;&#x300B;23&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF1A;"></a>&#x300A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;:&#x53EF;&#x590D;&#x7528;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x8F6F;&#x4EF6;&#x7684;&#x57FA;&#x7840;&#x300B;23&#x79CD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF1A;</h2><h2 id="&#x521B;&#x5EFA;&#x578B;&#x6A21;&#x5F0F;"><a href="#&#x521B;&#x5EFA;&#x578B;&#x6A21;&#x5F0F;" class="headerlink" title="&#x521B;&#x5EFA;&#x578B;&#x6A21;&#x5F0F;"></a>&#x521B;&#x5EFA;&#x578B;&#x6A21;&#x5F0F;</h2><h3 id="&#x5355;&#x4F8B;&#x6A21;&#x5F0F;singleton"><a href="#&#x5355;&#x4F8B;&#x6A21;&#x5F0F;-Singleton" class="headerlink" title="&#x5355;&#x4F8B;&#x6A21;&#x5F0F;(Singleton)"></a>&#x5355;&#x4F8B;&#x6A21;&#x5F0F;(Singleton)</h3><img src="/2017/04/05/design-pattern-note/pic_0.png"><a id="more"></a><p><strong>Tips:</strong> &#x4E2A;&#x4EBA;&#x63A8;&#x8350;Java&#x4E2D;&#x4F7F;&#x7528;&#x679A;&#x4E3E;&#x5B9E;&#x73B0;</p><h3 id="&#x6784;&#x5EFA;&#x8005;&#x6A21;&#x5F0F;builder"><a href="#&#x6784;&#x5EFA;&#x8005;&#x6A21;&#x5F0F;-Builder" class="headerlink" title="&#x6784;&#x5EFA;&#x8005;&#x6A21;&#x5F0F;(Builder)"></a>&#x6784;&#x5EFA;&#x8005;&#x6A21;&#x5F0F;(Builder)</h3><img src="/2017/04/05/design-pattern-note/pic_1.png"><p><strong>Tips:</strong> &#x901A;&#x5E38;&#x4F5C;&#x4E3A;&#x914D;&#x7F6E;&#x7C7B;&#x7684;&#x6784;&#x5EFA;&#x5668;&#xFF0C;&#x907F;&#x514D;&#x8FC7;&#x591A;&#x7684;setter&#x65B9;&#x6CD5;&#xFF0C;&#x5B9E;&#x73B0;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</p><h3 id="&#x539F;&#x578B;&#x6A21;&#x5F0F;prototype"><a href="#&#x539F;&#x578B;&#x6A21;&#x5F0F;-Prototype" class="headerlink" title="&#x539F;&#x578B;&#x6A21;&#x5F0F;(Prototype)"></a>&#x539F;&#x578B;&#x6A21;&#x5F0F;(Prototype)</h3><img src="/2017/04/05/design-pattern-note/pic_2.png"><p><strong>Tips:</strong> Java&#x7684;Object#clone()&#x5B9E;&#x73B0;&#x8BE5;&#x6A21;&#x5F0F;&#xFF0C;&#x6700;&#x7EC8;&#x4F7F;&#x7528;JNI&#x8FDB;&#x884C;&#x5B57;&#x8282;&#x590D;&#x5236;&#x53BB;&#x521B;&#x5EFA;&#x65B0;&#x5BF9;&#x8C61;</p><h3 id="&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;factory-method"><a href="#&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;-Factory-Method" class="headerlink" title="&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;(Factory Method)"></a>&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;(Factory Method)</h3><img src="/2017/04/05/design-pattern-note/pic_3.png"><p><strong>Tips:</strong> Java&#x4F7F;&#x7528;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#x901A;&#x5E38;&#x4F34;&#x968F;&#x7740;&#x53CD;&#x5C04;&#x673A;&#x5236;</p><h3 id="&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;abstract-factory"><a href="#&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;-Abstract-Factory" class="headerlink" title="&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;(Abstract Factory)"></a>&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;(Abstract Factory)</h3><img src="/2017/04/05/design-pattern-note/pic_4.png"><p><strong>Tips:</strong> AbstractFactory&#x8981;&#x4FDD;&#x8BC1;&#x7ED3;&#x6784;&#x7A33;&#x5B9A;&#x6027;</p><h2 id="&#x884C;&#x4E3A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"><a href="#&#x884C;&#x4E3A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;" class="headerlink" title="&#x884C;&#x4E3A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"></a>&#x884C;&#x4E3A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</h2><h3 id="&#x7B56;&#x7565;&#x6A21;&#x5F0F;strategy"><a href="#&#x7B56;&#x7565;&#x6A21;&#x5F0F;-Strategy" class="headerlink" title="&#x7B56;&#x7565;&#x6A21;&#x5F0F;(Strategy)"></a>&#x7B56;&#x7565;&#x6A21;&#x5F0F;(Strategy)</h3><img src="/2017/04/05/design-pattern-note/pic_5.png"><p><strong>Tips:</strong> &#x7CFB;&#x7EDF;&#x4E2D;&#x67D0;&#x4E2A;&#x7C7B;&#x7684;&#x67D0;&#x4E00;&#x884C;&#x4E3A;&#x5B58;&#x5728;&#x591A;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;&#x53EF;&#x4EE5;&#x4E92;&#x6362;&#x65F6;&#x4F7F;&#x7528;&#x7B56;&#x7565;&#x6A21;&#x5F0F;</p><h3 id="&#x72B6;&#x6001;&#x6A21;&#x5F0F;state"><a href="#&#x72B6;&#x6001;&#x6A21;&#x5F0F;-State" class="headerlink" title="&#x72B6;&#x6001;&#x6A21;&#x5F0F;(State)"></a>&#x72B6;&#x6001;&#x6A21;&#x5F0F;(State)</h3><img src="/2017/04/05/design-pattern-note/pic_6.png"><p><strong>Tips:</strong> &#x7CFB;&#x7EDF;&#x4E2D;&#x67D0;&#x4E2A;&#x7C7B;&#x7684;&#x5BF9;&#x8C61;&#x5B58;&#x5728;&#x591A;&#x79CD;&#x72B6;&#x6001;&#xFF0C;&#x4E0D;&#x540C;&#x72B6;&#x6001;&#x4E0B;&#x884C;&#x4E3A;&#x6709;&#x5DEE;&#x5F02;&#xFF0C;&#x800C;&#x4E14;&#x8FD9;&#x4E9B;&#x72B6;&#x6001;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x53D1;&#x751F;&#x8F6C;&#x6362;&#x65F6;&#x4F7F;&#x7528;&#x72B6;&#x6001;&#x6A21;&#x5F0F;</p><h3 id="&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;chain-of-responsibility"><a href="#&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;-Chain-of-Responsibility" class="headerlink" title="&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;(Chain of Responsibility)"></a>&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;(Chain of Responsibility)</h3><img src="/2017/04/05/design-pattern-note/pic_7.png"><h3 id="&#x89E3;&#x91CA;&#x5668;&#x6A21;&#x5F0F;interpreter"><a href="#&#x89E3;&#x91CA;&#x5668;&#x6A21;&#x5F0F;-Interpreter" class="headerlink" title="&#x89E3;&#x91CA;&#x5668;&#x6A21;&#x5F0F;(Interpreter)"></a>&#x89E3;&#x91CA;&#x5668;&#x6A21;&#x5F0F;(Interpreter)</h3><img src="/2017/04/05/design-pattern-note/pic_8.png"><h3 id="&#x547D;&#x4EE4;&#x6A21;&#x5F0F;command"><a href="#&#x547D;&#x4EE4;&#x6A21;&#x5F0F;-Command" class="headerlink" title="&#x547D;&#x4EE4;&#x6A21;&#x5F0F;(Command)"></a>&#x547D;&#x4EE4;&#x6A21;&#x5F0F;(Command)</h3><img src="/2017/04/05/design-pattern-note/pic_9.png"><p><strong>&#x4F18;&#x52BF;:</strong> &#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x8026;&#x5408;&#x5EA6;&#xFF0C;&#x65B9;&#x4FBF;&#x589E;&#x52A0;&#x65B0;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x53EF;&#x4EE5;&#x5BB9;&#x6613;&#x5730;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x547D;&#x4EE4;&#x961F;&#x5217;&#xFF0C;&#x65B9;&#x4FBF;&#x5B9E;&#x73B0;&#x5BF9;&#x8BF7;&#x6C42;&#x7684;&#x64A4;&#x9500;&#x548C;&#x6062;&#x590D;</p><h3 id="&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;observer"><a href="#&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;-Observer" class="headerlink" title="&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;(Observer)"></a>&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;(Observer)</h3><img src="/2017/04/05/design-pattern-note/pic_10.png"><h3 id="&#x5907;&#x5FD8;&#x5F55;&#x6A21;&#x5F0F;memento"><a href="#&#x5907;&#x5FD8;&#x5F55;&#x6A21;&#x5F0F;-Memento" class="headerlink" title="&#x5907;&#x5FD8;&#x5F55;&#x6A21;&#x5F0F;(Memento)"></a>&#x5907;&#x5FD8;&#x5F55;&#x6A21;&#x5F0F;(Memento)</h3><img src="/2017/04/05/design-pattern-note/pic_11.png"><h3 id="&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;iterator"><a href="#&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;-Iterator" class="headerlink" title="&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;(Iterator)"></a>&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;(Iterator)</h3><img src="/2017/04/05/design-pattern-note/pic_12.png"><h3 id="&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;template-method"><a href="#&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;-Template-Method" class="headerlink" title="&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;(Template Method)"></a>&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;(Template Method)</h3><img src="/2017/04/05/design-pattern-note/pic_13.png"><h3 id="&#x8BBF;&#x95EE;&#x8005;&#x6A21;&#x5F0F;visitor"><a href="#&#x8BBF;&#x95EE;&#x8005;&#x6A21;&#x5F0F;-Visitor" class="headerlink" title="&#x8BBF;&#x95EE;&#x8005;&#x6A21;&#x5F0F;(Visitor)"></a>&#x8BBF;&#x95EE;&#x8005;&#x6A21;&#x5F0F;(Visitor)</h3><img src="/2017/04/05/design-pattern-note/pic_14.png"><p><strong>&#x6CE8;&#x610F;:</strong> &#x5BF9;&#x8C61;&#x7ED3;&#x6784;&#x8981;&#x7A33;&#x5B9A;</p><h3 id="&#x4E2D;&#x4ECB;&#x8005;&#x6A21;&#x5F0F;mediator"><a href="#&#x4E2D;&#x4ECB;&#x8005;&#x6A21;&#x5F0F;-Mediator" class="headerlink" title="&#x4E2D;&#x4ECB;&#x8005;&#x6A21;&#x5F0F;(Mediator)"></a>&#x4E2D;&#x4ECB;&#x8005;&#x6A21;&#x5F0F;(Mediator)</h3><img src="/2017/04/05/design-pattern-note/pic_15.png"><p><strong>&#x4F18;&#x52BF;:</strong> &#x7B80;&#x5316;&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#xFF0C;&#x65B9;&#x4FBF;&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x8FDB;&#x884C;&#x8FDB;&#x4E00;&#x6B65;&#x63A7;&#x5236;</p><h2 id="&#x7ED3;&#x6784;&#x578B;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"><a href="#&#x7ED3;&#x6784;&#x578B;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;" class="headerlink" title="&#x7ED3;&#x6784;&#x578B;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"></a>&#x7ED3;&#x6784;&#x578B;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</h2><h3 id="&#x4EE3;&#x7406;&#x6A21;&#x5F0F;proxy"><a href="#&#x4EE3;&#x7406;&#x6A21;&#x5F0F;-Proxy" class="headerlink" title="&#x4EE3;&#x7406;&#x6A21;&#x5F0F;(Proxy)"></a>&#x4EE3;&#x7406;&#x6A21;&#x5F0F;(Proxy)</h3><img src="/2017/04/05/design-pattern-note/pic_16.png"><h3 id="&#x7EC4;&#x5408;&#x6A21;&#x5F0F;composite"><a href="#&#x7EC4;&#x5408;&#x6A21;&#x5F0F;-Composite" class="headerlink" title="&#x7EC4;&#x5408;&#x6A21;&#x5F0F;(Composite)"></a>&#x7EC4;&#x5408;&#x6A21;&#x5F0F;(Composite)</h3><img src="/2017/04/05/design-pattern-note/pic_17.png"><h3 id="&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;adapter"><a href="#&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;-Adapter" class="headerlink" title="&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;(Adapter)"></a>&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;(Adapter)</h3><img src="/2017/04/05/design-pattern-note/pic_18.png"><h3 id="&#x88C5;&#x9970;&#x8005;&#x6A21;&#x5F0F;decorator"><a href="#&#x88C5;&#x9970;&#x8005;&#x6A21;&#x5F0F;-Decorator" class="headerlink" title="&#x88C5;&#x9970;&#x8005;&#x6A21;&#x5F0F;(Decorator)"></a>&#x88C5;&#x9970;&#x8005;&#x6A21;&#x5F0F;(Decorator)</h3><img src="/2017/04/05/design-pattern-note/pic_19.png"><p><strong>&#x4F18;&#x52BF;:</strong> &#x63D0;&#x4F9B;&#x6BD4;&#x7EE7;&#x627F;&#x66F4;&#x591A;&#x7684;&#x7075;&#x6D3B;&#x6027;</p><h3 id="&#x4EAB;&#x5143;&#x6A21;&#x5F0F;flyweight"><a href="#&#x4EAB;&#x5143;&#x6A21;&#x5F0F;-Flyweight" class="headerlink" title="&#x4EAB;&#x5143;&#x6A21;&#x5F0F;(Flyweight)"></a>&#x4EAB;&#x5143;&#x6A21;&#x5F0F;(Flyweight)</h3><img src="/2017/04/05/design-pattern-note/pic_20.png"><p><strong>&#x89E3;&#x91CA;:</strong> &#x7C7B;&#x4F3C;&#x4E8E;&#x5BF9;&#x8C61;&#x7F13;&#x51B2;&#x6C60;,&#x901A;&#x5E38;&#x5355;&#x94FE;&#x8868;&#x5B9E;&#x73B0;,&#x628A;&#x5185;&#x90E8;&#x72B6;&#x6001;&#x548C;&#x5916;&#x90E8;&#x72B6;&#x6001;&#x5206;&#x79BB;,&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#x4E2D;&#x5BF9;&#x8C61;&#x7684;&#x6570;&#x91CF;</p><h3 id="&#x5916;&#x89C2;&#x6A21;&#x5F0F;facade"><a href="#&#x5916;&#x89C2;&#x6A21;&#x5F0F;-Facade" class="headerlink" title="&#x5916;&#x89C2;&#x6A21;&#x5F0F;(Facade)"></a>&#x5916;&#x89C2;&#x6A21;&#x5F0F;(Facade)</h3><img src="/2017/04/05/design-pattern-note/pic_21.png"><h3 id="&#x6865;&#x8FDE;&#x63A5;&#x6A21;&#x5F0F;bridge"><a href="#&#x6865;&#x8FDE;&#x63A5;&#x6A21;&#x5F0F;-Bridge" class="headerlink" title="&#x6865;&#x8FDE;&#x63A5;&#x6A21;&#x5F0F;(Bridge)"></a>&#x6865;&#x8FDE;&#x63A5;&#x6A21;&#x5F0F;(Bridge)</h3><img src="/2017/04/05/design-pattern-note/pic_22.png"><p><strong>&#x4F18;&#x52BF;:</strong> &#x6865;&#x63A5;&#x6A21;&#x5F0F;&#x63D0;&#x9AD8;&#x4E86;&#x7CFB;&#x7EDF;&#x7684;&#x53EF;&#x6269;&#x5145;&#x6027;&#xFF0C;&#x5728;&#x4E24;&#x4E2A;&#x53D8;&#x5316;&#x7EF4;&#x5EA6;&#x4E2D;&#x4EFB;&#x610F;&#x6269;&#x5C55;&#x4E00;&#x4E2A;&#x7EF4;&#x5EA6;&#xFF0C;&#x90FD;&#x4E0D;&#x9700;&#x8981;&#x4FEE;&#x6539;&#x539F;&#x6709;&#x7CFB;&#x7EDF;</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;面向对象六大原则&quot;&gt;&lt;a href=&quot;#面向对象六大原则&quot; class=&quot;headerlink&quot; title=&quot;面向对象六大原则&quot;&gt;&lt;/a&gt;面向对象六大原则&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;Single Responsibility Principle&lt;/li&gt;
&lt;li&gt;Open Close Principle&lt;/li&gt;
&lt;li&gt;Liskov Substitution Principle&lt;/li&gt;
&lt;li&gt;Dependence Inversion Principle&lt;/li&gt;
&lt;li&gt;Interface Segregation Principle&lt;/li&gt;
&lt;li&gt;Law of Demeter&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;《设计模式-可复用面向对象软件的基础》23种设计模式：&quot;&gt;&lt;a href=&quot;#《设计模式-可复用面向对象软件的基础》23种设计模式：&quot; class=&quot;headerlink&quot; title=&quot;《设计模式:可复用面向对象软件的基础》23种设计模式：&quot;&gt;&lt;/a&gt;《设计模式:可复用面向对象软件的基础》23种设计模式：&lt;/h2&gt;&lt;h2 id=&quot;创建型模式&quot;&gt;&lt;a href=&quot;#创建型模式&quot; class=&quot;headerlink&quot; title=&quot;创建型模式&quot;&gt;&lt;/a&gt;创建型模式&lt;/h2&gt;&lt;h3 id=&quot;单例模式-Singleton&quot;&gt;&lt;a href=&quot;#单例模式-Singleton&quot; class=&quot;headerlink&quot; title=&quot;单例模式(Singleton)&quot;&gt;&lt;/a&gt;单例模式(Singleton)&lt;/h3&gt;&lt;img src=&quot;/2017/04/05/design-pattern-note/pic_0.png&quot;&gt;
    
    </summary>
    
      <category term="读书笔记" scheme="http://yoursite.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="理论知识" scheme="http://yoursite.com/tags/%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>读书笔记</title>
    <link href="http://yoursite.com/2017/03/14/read-note/"/>
    <id>http://yoursite.com/2017/03/14/read-note/</id>
    <published>2017-03-14T01:55:44.000Z</published>
    <updated>2017-04-05T13:54:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>&#x8BB0;&#x5F55;&#x8BFB;&#x4E66;&#x8FC7;&#x7A0B;&#xFF0C;&#x56DE;&#x5FC6;&#x611F;&#x89E6;&#x8BDD;&#x8BED;</p><a id="more"></a><h3 id="&#x4E07;&#x4E07;&#x6CA1;&#x60F3;&#x5230;&#x7528;&#x7406;&#x5DE5;&#x79D1;&#x601D;&#x7EF4;&#x7406;&#x89E3;&#x4E16;&#x754C;2017-03-04&#x5DF2;&#x8BFB;"><a href="#&#x4E07;&#x4E07;&#x6CA1;&#x60F3;&#x5230;&#xFF1A;&#x7528;&#x7406;&#x5DE5;&#x79D1;&#x601D;&#x7EF4;&#x7406;&#x89E3;&#x4E16;&#x754C;-2017-03-04&#x5DF2;&#x8BFB;" class="headerlink" title="&#x4E07;&#x4E07;&#x6CA1;&#x60F3;&#x5230;&#xFF1A;&#x7528;&#x7406;&#x5DE5;&#x79D1;&#x601D;&#x7EF4;&#x7406;&#x89E3;&#x4E16;&#x754C;(2017-03-04&#x5DF2;&#x8BFB;)"></a>&#x4E07;&#x4E07;&#x6CA1;&#x60F3;&#x5230;&#xFF1A;&#x7528;&#x7406;&#x5DE5;&#x79D1;&#x601D;&#x7EF4;&#x7406;&#x89E3;&#x4E16;&#x754C;(2017-03-04&#x5DF2;&#x8BFB;)</h3><img src="/2017/03/14/read-note/pic_0.jpg"><ol><li><p>&#x771F;&#x6B63;&#x7684;&#x7EC3;&#x4E60;&#x4E0D;&#x662F;&#x4E3A;&#x4E86;&#x5B8C;&#x6210;&#x8FD0;&#x52A8;&#x91CF;&#xFF0C;&#x7EC3;&#x4E60;&#x7684;&#x7CBE;&#x9AD3;&#x662F;&#x8981;&#x6301;&#x7EED;&#x5730;&#x505A;&#x81EA;&#x5DF1;&#x505A;&#x4E0D;&#x597D;&#x7684;&#x4E8B;&#x3002;</p></li><li><p>&#x4E00;&#x4E2A;&#x771F;&#x6B63;&#x7684;&#x667A;&#x8005;&#x4E0D;&#x4F1A;&#x8BA9;&#x4E0A;&#x7F51;&#x5360;&#x7528;&#x8BFB;&#x4E66;&#x65F6;&#x95F4;&#xFF0C;&#x4ED6;&#x5E94;&#x8BE5;&#x7ECF;&#x5E38;&#x80FD;&#x591F;&#x5E73;&#x9759;&#x7684;&#x6DF1;&#x5165;&#x601D;&#x8003;</p></li><li><p>&#x8BFB;&#x4E66;&#x7684;&#x76EE;&#x7684;&#x662F;&#x83B7;&#x5F97;&#x89C1;&#x8BC6;&#x4EE5;&#x53CA;&#x5B66;&#x4E60;&#x9AD8;&#x6C34;&#x5E73;&#x7684;&#x601D;&#x7EF4;&#x65B9;&#x6CD5;</p></li></ol><h3 id="&#x817E;&#x8BAF;&#x4F20;2017-03-20&#x5DF2;&#x8BFB;"><a href="#&#x817E;&#x8BAF;&#x4F20;-2017-03-20&#x5DF2;&#x8BFB;" class="headerlink" title="&#x817E;&#x8BAF;&#x4F20;(2017-03-20&#x5DF2;&#x8BFB;)"></a>&#x817E;&#x8BAF;&#x4F20;(2017-03-20&#x5DF2;&#x8BFB;)</h3><img src="/2017/03/14/read-note/pic_1.jpg"><ol><li><p>&#x9A6C;&#x5316;&#x817E;&#x65E5;&#x540E;&#x5BF9;&#x6211;&#x8BF4;&#xFF1A;&#x201C;&#x6211;&#x4EEC;&#x6700;&#x7EC8;&#x662F;&#x9760;C&#x6253;&#x5929;&#x4E0B;&#x7684;&#x3002;&#x201D; (P10)</p></li><li><p>&#x4EA7;&#x54C1;&#x89C2;(P223)</p><p> a. &#x4EFB;&#x4F55;&#x4EA7;&#x54C1;&#x90FD;&#x6709;&#x6838;&#x5FC3;&#x529F;&#x80FD;&#xFF0C;&#x6838;&#x5FC3;&#x80FD;&#x529B;&#x8981;&#x505A;&#x5230;&#x6781;&#x81F4;&#x3002;</p><p> b. &#x4EA7;&#x54C1;&#x53E3;&#x7891;&#x3002;&#x6BCF;&#x4E2A;&#x529F;&#x80FD;&#x4E0D;&#x4E00;&#x5B9A;&#x8981;&#x7528;&#x7684;&#x591A;&#x624D;&#x662F;&#x597D;&#xFF0C;&#x800C;&#x662F;&#x7528;&#x4E86;&#x7684;&#x4EBA;&#x90FD;&#x89C9;&#x5F97;&#x597D;&#x624D;&#x662F;&#x771F;&#x6B63;&#x7684;&#x597D;</p><p> c. &#x8BBE;&#x8BA1;&#x4E0A;: &#x4E0D;&#x5F3A;&#x8FEB;&#x7528;&#x6237;&#xFF1B;&#x4E0D;&#x4E3A;1%&#x7684;&#x9700;&#x6C42;&#x9A9A;&#x6270;99%&#x7684;&#x7528;&#x6237;&#xFF1B;&#x6DE1;&#x6DE1;&#x7684;&#x7F8E;&#x672F;&#xFF0C;&#x70B9;&#x5230;&#x5373;&#x6B62;&#xFF1B;&#x4E0D;&#x80FD;&#x523B;&#x610F;&#x5730;&#x8FCE;&#x5408;&#x4F4E;&#x9F84;&#x5316;</p><p> d. &#x4EA7;&#x54C1;&#x6574;&#x4F53;&#x7B56;&#x7565;: &#x4EA4;&#x4E92;&#x529F;&#x80FD;(Don&#x2019;t make me think!)&#xFF1B;&#x7F8E;&#x672F;&#x5448;&#x73B0;(&#x5C3D;&#x53EF;&#x80FD;&#x7B80;&#x5355;)&#xFF1B;&#x4EA7;&#x54C1;&#x8BBE;&#x8BA1;(&#x8BA9;&#x529F;&#x80FD;&#x5B58;&#x5728;&#x4E8E;&#x65E0;&#x5F62;&#x4E4B;&#x4E2D;)&#xFF1B;&#x8FD0;&#x8425;&#x8981;&#x6C42;(&#x4E0D;&#x7A33;&#x5B9A;&#x4F1A;&#x529F;&#x4E8F;&#x4E00;&#x7BD1;!)&#xFF1B;&#x603B;&#x4F53;&#x8981;&#x6C42;(&#x5FEB;&#x901F;&#xFF0C;&#x7A33;&#x5B9A;&#xFF0C;&#x529F;&#x80FD;&#x5F3A;&#xFF0C;&#x4F53;&#x9A8C;&#x597D;&#xFF01;)&#xFF1B;&#x53D1;&#x73B0;&#x9700;&#x6C42;(&#x52E4;&#x770B;BBS&#x548C;Blog)</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录读书过程，回忆感触话语&lt;/p&gt;
    
    </summary>
    
      <category term="read-note" scheme="http://yoursite.com/categories/read-note/"/>
    
    
      <category term="读书笔记" scheme="http://yoursite.com/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>greenDAO组件分析</title>
    <link href="http://yoursite.com/2017/03/13/greenDAO-analysis/"/>
    <id>http://yoursite.com/2017/03/13/greenDAO-analysis/</id>
    <published>2017-03-13T07:32:14.000Z</published>
    <updated>2017-03-13T07:48:49.000Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x7B80;&#x4ECB;">&#x7B80;&#x4ECB;</a></li><li><a href="#&#x5EFA;&#x6A21;">&#x5EFA;&#x6A21;</a></li><li><a href="#&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5B9E;&#x73B0;">&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5B9E;&#x73B0;</a><ul><li><a href="#a-master&#x7C7B;">a. Master&#x7C7B;</a></li><li><a href="#b-daosession&#x7C7B;">b. DaoSession&#x7C7B;</a></li><li><a href="#c-&#x76F8;&#x5E94;java-pojo&#x7684;dao&#x5BF9;&#x8C61;">c. &#x76F8;&#x5E94;java POJO&#x7684;Dao&#x5BF9;&#x8C61;</a></li><li><a href="#d-java-pojo&#x5BF9;&#x8C61;">d. java POJO&#x5BF9;&#x8C61;</a></li></ul></li><li><a href="#&#x5176;&#x4ED6;&#x7EC6;&#x8282;">&#x5176;&#x4ED6;&#x7EC6;&#x8282;</a><ul><li><a href="#1-mn&#x5173;&#x7CFB;">1. m:n&#x5173;&#x7CFB;</a></li><li><a href="#2-&#x67E5;&#x8BE2;query">2. &#x67E5;&#x8BE2;Query</a></li><li><a href="#3-&#x7EBF;&#x7A0B;&#x5B89;&#x5168;">3. &#x7EBF;&#x7A0B;&#x5B89;&#x5168;</a></li></ul></li><li><a href="#&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</a></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><h2 id="&#x7B80;&#x4ECB;"><a href="#&#x7B80;&#x4ECB;" class="headerlink" title="&#x7B80;&#x4ECB;"></a>&#x7B80;&#x4ECB;</h2><p>greenDAO&#x662F;&#x4E00;&#x4E2A;&#x5F00;&#x6E90;&#x7684;&#x9488;&#x5BF9;Android SQLite&#x6570;&#x636E;&#x5E93;&#x7684;ORM&#x7EC4;&#x4EF6;&#xFF0C;&#x6839;&#x636E;&#x5B98;&#x65B9;&#x4FE1;&#x606F;&#xFF0C;&#x5176;&#x4E3B;&#x8981;&#x7279;&#x70B9;&#x6709;&#x6027;&#x80FD;&#x597D;&#xFF0C;&#x5305;&#x5C0F;(&lt;100KB)&#x7B49;&#xFF0C;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x5206;&#x6790;greenDAO&#x8BBE;&#x8BA1;&#x539F;&#x7406;&#x548C;&#x601D;&#x60F3;&#xFF0C;&#x4E3A;&#x4ECA;&#x540E;&#x6211;&#x4EEC;&#x81EA;&#x5DF1;&#x4F7F;&#x7528;&#x548C;&#x5F00;&#x53D1;ORM&#x7EC4;&#x4EF6;&#x63D0;&#x4F9B;&#x6307;&#x5BFC;&#x3002;</p><h2 id="&#x5EFA;&#x6A21;"><a href="#&#x5EFA;&#x6A21;" class="headerlink" title="&#x5EFA;&#x6A21;"></a>&#x5EFA;&#x6A21;</h2><p>ORM&#x7EC4;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x6211;&#x4EEC;&#x6446;&#x8131;&#x67AF;&#x71E5;&#x7684;&#x5404;&#x79CD;SQL&#x64CD;&#x4F5C;&#xFF0C;&#x4F7F;&#x6211;&#x4EEC;&#x4E13;&#x5FC3;&#x4E8E;&#x5BF9;&#x8C61;&#x64CD;&#x4F5C;&#x3002;&#x7B2C;&#x4E00;&#x6B65;&#x5C31;&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x5EFA;&#x6A21;&#xFF0C;&#x5047;&#x8BBE;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x6570;&#x636E;&#x5E93;:</p><img src="/2017/03/13/greenDAO-analysis/db.png"><p>&#x6309;&#x7167;greenDAO&#x89C4;&#x8303;&#xFF0C;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x6839;&#x636E;&#x6570;&#x636E;&#x5E93;schema&#x521B;&#x5EFA;&#x5982;&#x4E0B;&#x4E24;&#x4E2A;&#x5B9E;&#x4F53;&#x7C7B;:<br><a id="more"></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>(active = <span class="keyword">true</span>, nameInDb = <span class="string">&quot;USER&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id; <span class="comment">// Long&#x8868;&#x793A;&#x8BE5;&#x503C;&#x53EF;&#x4EE5;&#x521D;&#x59CB;&#x4E3A;&#x7A7A;&#xFF0C;&#x7531;&#x6570;&#x636E;&#x5E93;&#x751F;&#x6210;&#xFF1B;long&#x8868;&#x793A;&#x5F00;&#x53D1;&#x8005;&#x6307;&#x5B9A;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Property</span>(nameInDb = <span class="string">&quot;USER_NAME&quot;</span>)</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>(active = <span class="keyword">true</span>, nameInDb = <span class="string">&quot;DIALOG&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dialog</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Property</span>(nameInDb = <span class="string">&quot;DIALOG_ID&quot;</span>)</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> dialogId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Property</span>(nameInDb = <span class="string">&quot;USER_ID&quot;</span>)</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToOne</span>(joinProperty = <span class="string">&quot;userId&quot;</span>)</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x7531;&#x6B64;&#x6211;&#x4EEC;&#x53D1;&#x73B0;&#x5176;&#x8BBE;&#x8BA1;&#x7406;&#x5FF5;&#xFF1A;&#x901A;&#x8FC7;java POJO&#x5BF9;&#x8C61;&#x6784;&#x5EFA;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x8868;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x6BCF;&#x4E2A;&#x7C7B;&#x4EE3;&#x8868;&#x4E00;&#x5F20;&#x8868;&#xFF0C;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x8868;&#x793A;Column&#xFF0C;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#x8868;&#x793A;Row&#xFF0C;&#x8F85;&#x52A9;&#x4E00;&#x4E9B;&#x81EA;&#x5B9A;&#x4E49;&#x6CE8;&#x89E3;&#x6765;&#x5B9A;&#x4E49;Column&#x3002;&#x6211;&#x4EEC;&#x53EA;&#x9700;&#x8981;&#x5B9A;&#x4E49;java POJO&#x5C31;&#x53EF;&#x4EE5;&#x5B9A;&#x4E49;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x5728;greendao-api&#x6587;&#x4EF6;&#x5939;&#x4E0B;&#x5B9A;&#x4E49;&#x4E86;&#x5F53;&#x524D;&#x6240;&#x6709;&#x5BF9;&#x6570;&#x636E;&#x5E93;&#x5B9A;&#x4E49;&#x7684;&#x6CE8;&#x89E3;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x80FD;&#x6EE1;&#x8DB3;&#x6B63;&#x5E38;&#x4F7F;&#x7528;&#xFF0C;&#x5176;&#x8868;&#x73B0;&#x529B;&#x662F;&#x53EF;&#x4EE5;&#x7684;&#x3002;&#x4E0B;&#x8868;&#x5C55;&#x793A;&#x5E38;&#x7528;&#x6CE8;&#x89E3;&#x548C;&#x89E3;&#x91CA;&#xFF1A;</p><table><thead><tr><th style="text-align:left">annotation</th><th style="text-align:left">&#x89E3;&#x91CA;</th><th style="text-align:left">&#x5C5E;&#x6027;&#x503C;</th></tr></thead><tbody><tr><td style="text-align:left"><code>@Entity</code></td><td style="text-align:left">&#x8868;&#x7684;&#x76F8;&#x5173;&#x5B9A;&#x4E49;</td><td style="text-align:left">nameInDb:&#x8868;&#x540D;<br>indexes:&#x7EC4;&#x5408;&#x7D22;&#x5F15;<br>createInDB:&#x662F;&#x5426;&#x5728;&#x6570;&#x636E;&#x5E93;&#x521B;&#x5EFA;&#x5BF9;&#x5E94;&#x7269;&#x7406;&#x8868;<br>schema:&#x5C5E;&#x4E8E;&#x54EA;&#x4E2A;schema<br>active:update/delete/refresh&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x751F;&#x6210;<br>generateGettersSetters:&#x662F;&#x5426;&#x751F;&#x6210;getter/setter<br>generateConstructors:&#x662F;&#x5426;&#x751F;&#x6210;&#x6240;&#x6709;&#x5C5E;&#x6027;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;</td></tr><tr><td style="text-align:left"><code>@Property</code></td><td style="text-align:left">&#x8868;&#x7684;&#x5217;</td><td style="text-align:left">nameInDb:&#x5217;&#x540D;</td></tr><tr><td style="text-align:left"><code>@Id</code></td><td style="text-align:left">&#x4E3B;&#x952E;&#x58F0;&#x660E;</td><td style="text-align:left">autoincrement:&#x662F;&#x5426;&#x81EA;&#x589E;&#xFF0C;&#x6839;&#x636E;sqlite3 ROWID&#x7279;&#x70B9;&#xFF0C;&#x5EFA;&#x8BAE;False</td></tr><tr><td style="text-align:left"><code>@Index</code></td><td style="text-align:left">&#x5217;&#x7684;&#x7D22;&#x5F15;</td><td style="text-align:left">name:&#x540D;&#x5B57;<br>unique:&#x662F;&#x5426;&#x552F;&#x4E00;</td></tr><tr><td style="text-align:left"><code>@Unique</code><br><code>@NotNull</code></td><td style="text-align:left">SQLite&#x7EA6;&#x675F;</td><td style="text-align:left">UNIQUE&#x7EA6;&#x675F;<br>NOT NULL&#x7EA6;&#x675F;</td></tr><tr><td style="text-align:left"><code>@ToOne</code></td><td style="text-align:left">&#x4E00;&#x5BF9;&#x4E00;&#x5173;&#x7CFB;</td><td style="text-align:left">joinProperty:&#x6307;&#x5B9A;&#x5916;&#x952E;</td></tr><tr><td style="text-align:left"><code>@ToMany</code></td><td style="text-align:left">&#x4E00;&#x5BF9;&#x591A;&#x5173;&#x7CFB;</td><td style="text-align:left">referencedJoinProperty/joinProperties(&#x6839;&#x636E;&#x662F;&#x4E0D;&#x662F;&#x5916;&#x952E;)</td></tr><tr><td style="text-align:left"><code>@JoinEntity</code></td><td style="text-align:left">&#x591A;&#x5BF9;&#x591A;&#x5173;&#x7CFB;</td><td style="text-align:left">entity/sourceProperty/targetProperty</td></tr></tbody></table><h2 id="&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5B9E;&#x73B0;"><a href="#&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5B9E;&#x73B0;" class="headerlink" title="&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5B9E;&#x73B0;"></a>&#x6838;&#x5FC3;&#x529F;&#x80FD;&#x5B9E;&#x73B0;</h2><p>&#x5EFA;&#x6A21;&#x5B8C;&#x6210;&#x540E;&#x6211;&#x4EEC;&#x67E5;&#x770B;&#x5176;&#x4EE3;&#x7801;&#x751F;&#x6210;&#x8FC7;&#x7A0B;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p><img src="/2017/03/13/greenDAO-analysis/db-gen.png"><p>&#x4F7F;&#x7528;APT&#x5DE5;&#x5177;&#x6839;&#x636E;&#x4E0A;&#x8FF0;java POJO&#x7C7B;&#xFF0C;&#x7ED3;&#x5408;&#x4E00;&#x4E9B;Freemarker&#x6A21;&#x677F;&#x751F;&#x6210;&#x65B0;&#x7684;java POJO&#xFF0C;&#x5BF9;&#x5E94;&#x7684;DAO&#x7C7B;&#xFF0C;&#x7BA1;&#x7406;DAO&#x7C7B;&#x7684;DaoSession&#xFF0C;&#x4EE5;&#x53CA;&#x7BA1;&#x7406;&#x6570;&#x636E;&#x5E93;&#x548C;&#x751F;&#x6210;DaoSession&#x7684;DaoMaster&#x3002;&#x76F8;&#x6BD4;&#x5176;&#x4ED6;&#x5E02;&#x9762;&#x4E0A;&#x7EAF;Java&#x7684;ORM&#x7EC4;&#x4EF6;&#xFF0C;&#x5176;&#x6700;&#x5927;&#x7279;&#x8272;&#x662F;&#x4F7F;&#x7528;APT&#x5728;&#x7F16;&#x8BD1;&#x671F;&#x95F4;&#x5C06;DAO&#x7C7B;&#x90FD;&#x751F;&#x6210;&#x5B8C;&#x6BD5;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x5728;&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x52A8;&#x6001;&#x751F;&#x6210;SQL&#x8BED;&#x53E5;&#xFF0C;&#x56E0;&#x4E3A;&#x5176;&#x4ED6;&#x7EC4;&#x4EF6;&#x901A;&#x5E38;&#x4F7F;&#x7528;&#x6CE8;&#x89E3;&#x5728;&#x8FD0;&#x884C;&#x671F;&#x95F4;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x751F;&#x6210;SQL&#x8BED;&#x53E5;&#xFF0C;&#x8FD9;&#x6837;&#x6548;&#x7387;&#x63D0;&#x5347;&#x4E0D;&#x5C11;&#x3002;</p><p>&#x7531;&#x4E8E;&#x5B98;&#x65B9;GitHub&#x4E2D;&#x5E76;&#x6CA1;&#x6709;&#x628A;&#x4F7F;&#x7528;&#x7684;&#x6CE8;&#x89E3;&#x5904;&#x7406;&#x5668;&#x5F00;&#x6E90;&#xFF0C;&#x800C;&#x4E14;&#x672C;&#x6587;&#x4E3B;&#x8981;&#x8BA8;&#x8BBA;greenDAO&#x8BBE;&#x8BA1;ORM&#x6846;&#x67B6;&#x7684;&#x601D;&#x60F3;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x5173;&#x6CE8;&#x751F;&#x6210;&#x7C7B;&#x548C;&#x7EC4;&#x4EF6;&#x6E90;&#x7801;&#x4E2D;&#x7684;&#x8BBE;&#x8BA1;&#x601D;&#x60F3;&#x3002;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x901A;&#x8FC7;APT&#x5904;&#x7406;&#x540E;&#xFF0C;&#x6BCF;&#x4E2A;java POJO&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5305;&#x542B;&#x5176;&#x5143;&#x6570;&#x636E;&#x7684;Entity&#x7C7B;&#xFF0C;&#x63A5;&#x7740;&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x4E2D;DaoGenerator&#x5DE5;&#x7A0B;&#x751F;&#x6210;&#x4E0A;&#x8FF0;app&#x5DE5;&#x7A0B;&#x9700;&#x8981;&#x7684;&#x7C7B;&#x3002;</p><h3 id="a-master&#x7C7B;"><a href="#a-Master&#x7C7B;" class="headerlink" title="a. Master&#x7C7B;"></a>a. Master&#x7C7B;</h3><p>&#x7EE7;&#x627F;AbstractDaoMaster&#xFF0C;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x6709;&#xFF1A;</p><ol><li><p>&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7684;&#x6570;&#x636E;&#x5E93;&#x5BF9;&#x8C61;SQLiteDatabase(greenDAO&#x4E3A;&#x652F;&#x6301;&#x52A0;&#x5BC6;&#x6570;&#x636E;&#x5E93;&#x589E;&#x52A0;&#x4E86;&#x4E00;&#x5C42;&#x4EE3;&#x7406;)&#xFF0C;&#x5185;&#x90E8;&#x63D0;&#x4F9B;SQLiteOpenHelper&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;&#x5B9E;&#x73B0;SQLiteOpenHelper&#x5F53;&#x505A;&#x6784;&#x9020;&#x53C2;&#x6570;&#x4F20;&#x5165;&#x3002;</p></li><li><p>&#x751F;&#x6210;DaoSession&#xFF1A;<code>#newSession()</code>&#x548C;<code>#newSession(IdentityScopeType)</code>&#xFF0C;&#x8FD9;&#x5F88;&#x7C7B;&#x4F3C;&#x7F51;&#x7EDC;&#x9886;&#x57DF;&#x4E2D;&#x4F1A;&#x8BDD;&#x6982;&#x5FF5;&#xFF0C;&#x4E3B;&#x8981;&#x601D;&#x60F3;&#x662F;&#xFF1A;&#x5BF9;&#x4E00;&#x4E2A;session&#x4E2D;&#x8FDB;&#x884C;&#x67E5;&#x8BE2;&#x7684;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x6B21;&#x83B7;&#x53D6;&#x76F8;&#x540C;&#x5BF9;&#x8C61;(&#x901A;&#x5E38;&#x6839;&#x636E;&#x4E3B;&#x952E;&#x5224;&#x65AD;)&#x53EF;&#x4EE5;&#x8282;&#x7701;&#x6784;&#x5EFA;&#x5BF9;&#x8C61;&#x8FC7;&#x7A0B;&#xFF0C;&#x5F53;&#x7136;&#x8C03;&#x7528;&#x8005;&#x53EF;&#x4EE5;&#x5173;&#x95ED;&#x7F13;&#x5B58;&#x529F;&#x80FD;&#x3002;&#x8FD9;&#x79CD;&#x7F13;&#x5B58;&#x529F;&#x80FD;&#x5E26;&#x6765;&#x6548;&#x7387;&#x63D0;&#x5347;&#xFF0C;&#x540C;&#x65F6;&#x4E5F;&#x4F1A;&#x9762;&#x4E34;&#x7F13;&#x5B58;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x6570;&#x636E;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x60C5;&#x51B5;&#x3002;</p></li><li><p>&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;#registerDaoClass(Class&lt;? extends AbstractDao&lt;?, ?&gt;&gt; daoClass)&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x6BCF;&#x4E2A;DAO&#x7C7B;&#x7684;DaoConfig&#x5BF9;&#x8C61;&#x3002;DaoConfig&#x7C7B;&#x662F;&#x5305;&#x542B;java Bean&#x5143;&#x6570;&#x636E;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5305;&#x62EC;&#x8868;&#x540D;&#xFF0C;&#x5217;&#x540D;&#xFF0C;&#x4E3B;&#x952E;&#x7B49;&#x7B49;&#xFF0C;&#x901A;&#x8FC7;&#x8BFB;&#x53D6;&#x6BCF;&#x4E2A;DAO&#x7C7B;&#x7684;&#x6210;&#x5458;&#x53D8;&#x91CF;TABLENAME&#x548C;&#x5185;&#x90E8;&#x7C7B;Properties&#x5C31;&#x53EF;&#x53D6;&#x5230;&#x3002;</p></li></ol><p>&#x4E00;&#x4E2A;Master&#x5BF9;&#x8C61;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;&#x6240;&#x4EE5;&#x901A;&#x5E38;&#x6574;&#x4E2A;app&#x53EA;&#x9700;&#x6784;&#x5EFA;&#x4E00;&#x4E2A;Master&#x3002;</p><h3 id="b-daosession&#x7C7B;"><a href="#b-DaoSession&#x7C7B;" class="headerlink" title="b. DaoSession&#x7C7B;"></a>b. DaoSession&#x7C7B;</h3><p>&#x8868;&#x793A;&#x4E00;&#x6B21;&#x4E0E;&#x6570;&#x636E;&#x5E93;&#x64CD;&#x4F5C;&#x7684;&#x4F1A;&#x8BDD;&#xFF0C;session&#x5B58;&#x5728;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x51CF;&#x5C11;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x6784;&#x5EFA;&#x5BF9;&#x8C61;&#x6B21;&#x6570;&#x3002;&#x7EE7;&#x627F;AbstractDaoSession&#xFF0C;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x6709;:</p><ol><li><p>&#x521D;&#x59CB;&#x5316;&#x6240;&#x6709;DAO&#x5BF9;&#x8C61;&#x5E76;&#x63D0;&#x4F9B;get&#x65B9;&#x6CD5;&#xFF0C;&#x5BF9;&#x6240;&#x6709;DAO&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x7BA1;&#x7406;</p></li><li><p>&#x6BCF;&#x4E2A;DAO&#x5BF9;&#x8C61;&#x901A;&#x8FC7;&#x5BF9;&#x5E94;DaoConfig&#x7C7B;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x6BCF;&#x4E2A;DaoConfig#IdentityScope&#x4F5C;&#x4E3A;&#x5BF9;&#x5E94;&#x5B9E;&#x4F53;&#x5BF9;&#x8C61;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x7531;DaoSession#clear()&#x8D1F;&#x8D23;&#x6E05;&#x7A7A;&#xFF1B;&#x6BCF;&#x4E2A;DaoSession&#x521B;&#x5EFA;&#x5BF9;&#x5E94;DAO&#x5BF9;&#x8C61;&#x65F6;&#x4F1A;&#x514B;&#x9686;&#x4E00;&#x4EFD;DaoConfig&#x5BF9;&#x8C61;&#xFF0C;&#x4ECE;&#x800C;&#x4FDD;&#x8BC1;&#x6BCF;&#x4E2A;session&#x7F13;&#x5B58;&#x81EA;&#x8EAB;&#x7684;&#x6570;&#x636E;&#x3002;</p></li><li><p>&#x63D0;&#x4F9B;&#x591A;&#x4E2A;DAO&#x4E4B;&#x95F4;&#x7684;&#x4E8B;&#x52A1;&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;&#x5355;&#x4E2A;DAO&#x5BF9;&#x8C61;&#x53EA;&#x80FD;&#x9488;&#x5BF9;&#x5355;&#x4E2A;&#x8868;&#x8FDB;&#x884C;&#x4E8B;&#x52A1;&#x64CD;&#x4F5C;&#x3002;</p></li></ol><p>&#x6839;&#x636E;app&#x4E1A;&#x52A1;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x591A;&#x4E2A;session&#x6216;&#x8005;&#x5355;&#x4E2A;session&#xFF0C;session&#x9700;&#x8981;&#x7F13;&#x5B58;&#x8FD8;&#x662F;&#x4E0D;&#x9700;&#x8981;&#x7F13;&#x5B58;&#x3002;</p><h3 id="c-&#x76F8;&#x5E94;java-pojo&#x7684;dao&#x5BF9;&#x8C61;"><a href="#c-&#x76F8;&#x5E94;java-POJO&#x7684;Dao&#x5BF9;&#x8C61;" class="headerlink" title="c. &#x76F8;&#x5E94;java POJO&#x7684;Dao&#x5BF9;&#x8C61;"></a>c. &#x76F8;&#x5E94;java POJO&#x7684;Dao&#x5BF9;&#x8C61;</h3><p>&#x8868;&#x793A;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x4E00;&#x5F20;&#x8868;&#x7684;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#xFF0C;&#x7EE7;&#x627F;AbstractDao&#x7C7B;&#xFF0C;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x6709;&#xFF1A;</p><ol><li><p>Properties&#x7C7B;&#xFF0C;&#x5B58;&#x50A8;java POJO&#x7C7B;&#x4E2D;&#x6BCF;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x4E0E;&#x6570;&#x636E;&#x5E93;Column&#x5BF9;&#x5E94;&#x5173;&#x7CFB;&#xFF0C;&#x4EE5;User&#x4E3A;&#x4F8B;:</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TABLENAME = <span class="string">&quot;USER&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x7B2C;&#x56DB;&#x4E2A;&#x53D8;&#x91CF;&#x8868;&#x793A;&#x662F;&#x5426;&#x662F;&#x4E3B;&#x952E;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Properties</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Property Id = <span class="keyword">new</span> Property(<span class="number">0</span>, <span class="keyword">long</span>.class, <span class="string">&quot;id&quot;</span>, <span class="keyword">true</span>, <span class="string">&quot;_id&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> Property Name = <span class="keyword">new</span> Property(<span class="number">1</span>, String.class, <span class="string">&quot;name&quot;</span>, <span class="keyword">false</span>, <span class="string">&quot;USER_NAME&quot;</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure></li><li><p>&#x521B;&#x5EFA;&#x8868;/&#x5220;&#x9664;&#x8868;&#x7684;&#x51FD;&#x6570;</p></li><li><p>&#x63D0;&#x4F9B;&#x589E;(inset)&#xFF0C;&#x5220;(delete)&#xFF0C;&#x6539;(update)&#xFF0C;load(PrimaryKey)&#xFF0C;&#x67E5;(queryBuilder)&#x7B49;&#x4E00;&#x7CFB;&#x5217;&#x51FD;&#x6570;&#x64CD;&#x4F5C;&#x3002;&#x4EE5;&#x63D2;&#x5165;USER&#x8868;&#x4E3A;&#x4F8B;&#xFF0C;AbstractDao&#x4E3B;&#x8981;&#x8D1F;&#x8D23;&#x62FC;&#x63A5;SQL&#x6A21;&#x677F;&#xFF0C;&#x5BF9;&#x5E94;DAO&#x5BF9;&#x8C61;&#x8D1F;&#x8D23;bind&#x64CD;&#x4F5C;&#x3002;</p> <img src="/2017/03/13/greenDAO-analysis/db-insert.png"></li><li><p>&#x63D0;&#x4F9B;attach\detach&#x65B9;&#x6CD5;&#xFF0C;&#x9488;&#x5BF9;&#x5355;&#x4E2A;&#x5BF9;&#x8C61;&#x8FDB;&#x884C;&#x7F13;&#x5B58;&#x7BA1;&#x7406;</p></li></ol><h3 id="d-java-pojo&#x5BF9;&#x8C61;"><a href="#d-java-POJO&#x5BF9;&#x8C61;" class="headerlink" title="d. java POJO&#x5BF9;&#x8C61;"></a>d. java POJO&#x5BF9;&#x8C61;</h3><p>&#x7ECF;&#x8FC7;APT&#x8FC7;&#x7A0B;&#x589E;&#x52A0;&#x4EE5;&#x4E0B;&#x51FD;&#x6570;:</p><ol><li><p>&#x5BF9;&#x5E94;getter/setter&#x51FD;&#x6570;</p></li><li><p>&#x8BBE;&#x7F6E;DaoSession&#xFF0C;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x90FD;&#x901A;&#x8FC7;DaoSession&#x5B9E;&#x73B0;</p></li><li><p>@Entity(active = true)&#x65F6;:  </p></li></ol><table><thead><tr><th style="text-align:left">&#x65B9;&#x6CD5;</th><th style="text-align:left">&#x89E3;&#x91CA;</th></tr></thead><tbody><tr><td style="text-align:left">#update()</td><td style="text-align:left">java POJO&#x66F4;&#x65B0;&#x5230;&#x6570;&#x636E;&#x5E93;</td></tr><tr><td style="text-align:left">#refresh()</td><td style="text-align:left">&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x66F4;&#x65B0;java POJO</td></tr><tr><td style="text-align:left">#delete()</td><td style="text-align:left">&#x5220;&#x9664;java POJO</td></tr></tbody></table><h2 id="&#x5176;&#x4ED6;&#x7EC6;&#x8282;"><a href="#&#x5176;&#x4ED6;&#x7EC6;&#x8282;" class="headerlink" title="&#x5176;&#x4ED6;&#x7EC6;&#x8282;"></a>&#x5176;&#x4ED6;&#x7EC6;&#x8282;</h2><h3 id="1-mn&#x5173;&#x7CFB;"><a href="#1-m-n&#x5173;&#x7CFB;" class="headerlink" title="1. m:n&#x5173;&#x7CFB;"></a>1. m:n&#x5173;&#x7CFB;</h3><p>greenDAO&#x5BF9;1:1&#x7684;&#x652F;&#x6301;&#x662F;&#x4F7F;&#x7528;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x5BF9;1:n&#x652F;&#x6301;&#x662F;&#x4F7F;&#x7528;List&#x5217;&#x8868;&#xFF0C;m:n&#x5173;&#x7CFB;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#x4E2D;&#x95F4;&#x8868;&#x8F6C;&#x5316;&#x6210;&#x4E24;&#x4E2A;1:n&#x5B9E;&#x73B0;&#x3002;&#x901A;&#x8FC7;&#x5916;&#x952E;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x662F;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x5373;&#x7B2C;&#x4E00;&#x6B21;&#x4F7F;&#x7528;&#x65F6;&#x624D;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x8BFB;&#x53D6;&#x5E76;&#x751F;&#x6210;&#x5BF9;&#x8C61;&#xFF0C;&#x518D;&#x6B21;&#x8BFB;&#x53D6;&#x8BE5;&#x5BF9;&#x8C61;&#x65F6;&#x76F4;&#x63A5;&#x4ECE;&#x5185;&#x5B58;&#x4E2D;&#x83B7;&#x5F97;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x6570;&#x636E;&#x4E00;&#x81F4;&#x6027;&#x3002;</p><h3 id="2-&#x67E5;&#x8BE2;query"><a href="#2-&#x67E5;&#x8BE2;Query" class="headerlink" title="2. &#x67E5;&#x8BE2;Query"></a>2. &#x67E5;&#x8BE2;Query</h3><p>&#x67E5;&#x8BE2;&#x662F;&#x6700;&#x590D;&#x6742;&#x7684;SQL&#x64CD;&#x4F5C;&#xFF0C;&#x4E0E;&#x67E5;&#x8BE2;&#x76F8;&#x5173;&#x7684;SQL&#x7531;&#x4EE5;&#x4E0B;&#x7C7B;&#x7EC4;&#x6210;&#xFF1A;</p><img src="/2017/03/13/greenDAO-analysis/db-query.png"><p>&#x5176;&#x4E2D;&#xFF0C;&#x6700;&#x5E38;&#x7528;&#x7684;&#x662F;Query,CountQuery&#x548C;DeleteQuery&#xFF0C;&#x5206;&#x522B;&#x8868;&#x793A;&#x8FD4;&#x56DE;&#x76F8;&#x5173;&#x67E5;&#x8BE2;&#x5BF9;&#x8C61;&#xFF0C;&#x6267;&#x884C;count&#x64CD;&#x4F5C;&#x548C;&#x4ECE;&#x6570;&#x636E;&#x5E93;&#x67E5;&#x8BE2;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5E76;&#x5220;&#x9664;&#x3002;Query&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x4E3B;&#x8981;&#x6709;2&#x79CD;&#x5F62;&#x5F0F;&#xFF1A;1.&#x4E00;&#x6B21;&#x6027;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x7ED3;&#x679C;&#xFF1B;2.&#x5B9E;&#x73B0;&#x61D2;&#x52A0;&#x8F7D;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5173;&#x95ED;cursor&#x3002;</p><p>Dao&#x7C7B;&#x4E0E;Query&#x901A;&#x8FC7;QueryBuilder&#x7C7B;&#x8FDB;&#x884C;&#x5173;&#x8054;&#xFF0C;&#x4F7F;&#x7528;&#x6784;&#x5EFA;&#x8005;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x5BF9;&#x5E94;Query&#x5BF9;&#x8C61;&#x751F;&#x6210;&#xFF0C;&#x540C;&#x65F6;QueryBuilder&#x63D0;&#x4F9B;Join&#x64CD;&#x4F5C;&#x5B9E;&#x73B0;&#x8054;&#x8868;&#x67E5;&#x8BE2;&#x3002;</p><h3 id="3-&#x7EBF;&#x7A0B;&#x5B89;&#x5168;"><a href="#3-&#x7EBF;&#x7A0B;&#x5B89;&#x5168;" class="headerlink" title="3. &#x7EBF;&#x7A0B;&#x5B89;&#x5168;"></a>3. &#x7EBF;&#x7A0B;&#x5B89;&#x5168;</h3><p><strong>SQLite&#x7EA7;&#x522B;</strong>&#xFF1A;&#x901A;&#x5E38;&#x6211;&#x4EEC;&#x9488;&#x5BF9;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5E93;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;SQLiteDatabase&#xFF0C;&#x9ED8;&#x8BA4;&#x60C5;&#x51B5;&#x4E0B;&#x5BF9;&#x6570;&#x636E;&#x5E93;CRUD&#x64CD;&#x4F5C;&#x90FD;&#x4F1A;&#x88AB;&#x6570;&#x636E;&#x5E93;&#x52A0;&#x9501;&#xFF0C;&#x56E0;&#x4E3A;DB&#x662F;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x6570;&#x636E;&#x5E93;&#x7EA7;&#x9501;&#x3002;API 11&#x4EE5;&#x4E0A;&#x65F6;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;SQLiteDatabase#enableWriteAheadLogging()&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x5199;&#x7EBF;&#x7A0B;&#x4E0E;&#x591A;&#x4E2A;&#x8BFB;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x5728;&#x4E00;&#x4E2A;SQLiteDatabase&#x4E0A;&#x8D77;&#x4F5C;&#x7528;&#x3002;</p><p><strong>greenDAO&#x7EA7;&#x522B;</strong>&#xFF1A; DaoSession&#x548C;DAO&#x90FD;&#x662F;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#x7684;&#xFF0C;&#x5176;&#x4E2D;&#xFF0C;&#x7F13;&#x5B58;IdentityScope&#x4F7F;&#x7528;ReentrantLock&#x5B9E;&#x73B0;&#x7EBF;&#x7A0B;&#x5B89;&#x5168;&#xFF1B;&#x5199;&#x64CD;&#x4F5C;&#x65F6;&#x4F7F;&#x7528;SQLiteDatabase#isDbLockedByCurrentThread()&#x5224;&#x65AD;&#x662F;&#x5426;&#x83B7;&#x5F97;&#x6570;&#x636E;&#x5E93;&#x8FDE;&#x63A5;&#xFF0C;&#x6CA1;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x901A;&#x8FC7;SQLiteDatabase#beginTransaction()&#x83B7;&#x53D6;&#x6570;&#x636E;&#x8FDE;&#x63A5;(EXCLUSIVE mode)&#xFF1B;&#x8BFB;&#x64CD;&#x4F5C;&#x65F6;&#x63D0;&#x4F9B;#forCurrentThread()&#x65B9;&#x6CD5;&#x83B7;&#x53D6;&#x9488;&#x5BF9;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x7684;&#x67E5;&#x8BE2;&#x914D;&#x7F6E;(&#x901A;&#x8FC7;QueryBuilder&#x8BBE;&#x7F6E;)&#x526F;&#x672C;&#xFF0C;&#x7136;&#x540E;&#x7531;&#x5E95;&#x5C42;SQLite&#x6570;&#x636E;&#x5E93;&#x63A7;&#x5236;&#x591A;&#x7EBF;&#x7A0B;&#x8BFB;&#x64CD;&#x4F5C;&#x3002;</p><h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>greenDAO&#x4F5C;&#x4E3A;2011&#x5E74;&#x5F00;&#x6E90;&#x7684;&#x9879;&#x76EE;&#xFF0C;&#x6574;&#x4F53;&#x8BBE;&#x8BA1;&#x662F;&#x5F88;&#x4F18;&#x79C0;&#x7684;&#xFF0C;&#x6EE1;&#x8DB3;app&#x5BF9;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#x5927;&#x90E8;&#x5206;&#x5E38;&#x7528;&#x64CD;&#x4F5C;&#xFF0C;&#x67B6;&#x6784;&#x53EF;&#x6269;&#x5C55;&#x6027;&#x975E;&#x5E38;&#x4E0D;&#x9519;&#xFF0C;&#x5BF9;&#x53EF;&#x53D8;&#x90E8;&#x5206;&#x4E0E;&#x516C;&#x5171;&#x90E8;&#x5206;&#x7684;&#x4EE3;&#x7801;&#x62C6;&#x5206;&#xFF0C;&#x4F7F;&#x5176;&#x4F18;&#x4E8E;&#x5176;&#x4ED6;ORM&#x6846;&#x67B6;&#x3002;&#x4E2A;&#x4EBA;&#x89C9;&#x5F97;&#x5982;&#x679C;&#x6709;&#x5FD7;&#x4E8E;ORM&#x8F6E;&#x5B50;&#x7684;&#x540C;&#x5B66;&#x53EF;&#x4EE5;&#x4ECE;:1. SQL&#x8BED;&#x53E5;&#x4F18;&#x5316;&#x4E0E;&#x6821;&#x9A8C; 2. &#x591A;&#x7EBF;&#x7A0B;&#x7BA1;&#x7406;&#x63D0;&#x9AD8;&#x6027;&#x80FD; &#x8FD9;&#x4E9B;&#x65B9;&#x9762;&#x53BB;&#x4F18;&#x5316;&#xFF0C;&#x5F53;&#x7136;&#xFF0C;&#x5E95;&#x5C42;&#x4E0D;&#x4F7F;&#x7528;&#x5173;&#x7CFB;&#x6570;&#x636E;&#x5E93;&#xFF0C;&#x76F4;&#x63A5;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x6570;&#x636E;&#x5E93;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x65B9;&#x5411;&#x3002;</p><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><ol><li><a href="http://greenrobot.org/greendao/" target="_blank" rel="noopener">http://greenrobot.org/greendao/</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#简介&quot;&gt;简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#建模&quot;&gt;建模&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#核心功能实现&quot;&gt;核心功能实现&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a-master类&quot;&gt;a. Master类&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b-daosession类&quot;&gt;b. DaoSession类&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#c-相应java-pojo的dao对象&quot;&gt;c. 相应java POJO的Dao对象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#d-java-pojo对象&quot;&gt;d. java POJO对象&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#其他细节&quot;&gt;其他细节&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-mn关系&quot;&gt;1. m:n关系&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-查询query&quot;&gt;2. 查询Query&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-线程安全&quot;&gt;3. 线程安全&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#总结&quot;&gt;总结&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;greenDAO是一个开源的针对Android SQLite数据库的ORM组件，根据官方信息，其主要特点有性能好，包小(&amp;lt;100KB)等，本文主要分析greenDAO设计原理和思想，为今后我们自己使用和开发ORM组件提供指导。&lt;/p&gt;
&lt;h2 id=&quot;建模&quot;&gt;&lt;a href=&quot;#建模&quot; class=&quot;headerlink&quot; title=&quot;建模&quot;&gt;&lt;/a&gt;建模&lt;/h2&gt;&lt;p&gt;ORM组件可以使我们摆脱枯燥的各种SQL操作，使我们专心于对象操作。第一步就是如何进行建模，假设我们需要创建如下数据库:&lt;/p&gt;
&lt;img src=&quot;/2017/03/13/greenDAO-analysis/db.png&quot;&gt;
&lt;p&gt;按照greenDAO规范，我们需要根据数据库schema创建如下两个实体类:&lt;br&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>学习Okio的优化思想</title>
    <link href="http://yoursite.com/2017/02/16/okio/"/>
    <id>http://yoursite.com/2017/02/16/okio/</id>
    <published>2017-02-16T07:43:11.000Z</published>
    <updated>2017-02-16T07:51:38.000Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x7B80;&#x4ECB;">&#x7B80;&#x4ECB;</a></li><li><a href="#okio&#x7B80;&#x5355;demo">Okio&#x7B80;&#x5355;demo</a></li><li><a href="#&#x6838;&#x5FC3;&#x7C7B;">&#x6838;&#x5FC3;&#x7C7B;</a><ul><li><a href="#&#x7ED3;&#x8BBA;">&#x7ED3;&#x8BBA;</a></li></ul></li><li><a href="#buffer&#x8BE6;&#x89E3;">Buffer&#x8BE6;&#x89E3;</a><ul><li><a href="#&#x4E24;&#x4E2A;&#x4F18;&#x5316;&#x5C0F;&#x7EC6;&#x8282;">&#x4E24;&#x4E2A;&#x4F18;&#x5316;&#x5C0F;&#x7EC6;&#x8282;</a></li><li><a href="#&#x4E24;&#x4E2A;&#x7591;&#x95EE;">&#x4E24;&#x4E2A;&#x7591;&#x95EE;</a></li></ul></li><li><a href="#&#x5176;&#x4ED6;&#x4F18;&#x5316;">&#x5176;&#x4ED6;&#x4F18;&#x5316;</a><ul><li><a href="#bytestring">ByteString</a></li><li><a href="#timeout">Timeout</a></li></ul></li><li><a href="#&#x603B;&#x7ED3;">&#x603B;&#x7ED3;</a></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><h2 id="&#x7B80;&#x4ECB;"><a href="#&#x7B80;&#x4ECB;" class="headerlink" title="&#x7B80;&#x4ECB;"></a>&#x7B80;&#x4ECB;</h2><p>Okio&#x662F;&#x7531;Square&#x516C;&#x53F8;&#x5F00;&#x53D1;&#x5E76;&#x5F00;&#x6E90;&#x7684;java IO&#x7EC4;&#x4EF6;&#x5E93;&#xFF0C;&#x6700;&#x521D;&#x7528;&#x4E8E;&#x5176;&#x5F00;&#x53D1;&#x7684;HTTP&#x5BA2;&#x6237;&#x7AEF;OkHttp&#x7684;&#x5E95;&#x5C42;IO&#x5C01;&#x88C5;&#xFF0C;&#x4ECE;Android 4.4&#x8D77;&#xFF0C;HttpURLConnection&#x5E95;&#x5C42;&#x5B9E;&#x73B0;&#x91C7;&#x7528;Okhttp&#xFF0C;Okio&#x7EC4;&#x4EF6;&#x4E5F;&#x88AB;&#x5F00;&#x53D1;&#x8005;&#x6240;&#x8BA4;&#x53EF;&#x3002;&#x6839;&#x636E;GitHub&#x4ECB;&#x7ECD;&#xFF0C;&#x8BE5;&#x7EC4;&#x4EF6;&#x5B9A;&#x4F4D;&#x662F;&#xFF1A;</p><blockquote><p>Okio is a new library that complements java.io and java.nio to make it much easier to access, store, and process your data.</p></blockquote><p>&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x662F;&#x901A;&#x8FC7;&#x6E90;&#x7801;&#x5206;&#x6790;&#x5B66;&#x4E60;&#x5176;&#x4F18;&#x5316;&#x7684;&#x601D;&#x60F3;&#x3002;</p><h2 id="okio&#x7B80;&#x5355;demo"><a href="#Okio&#x7B80;&#x5355;demo" class="headerlink" title="Okio&#x7B80;&#x5355;demo"></a>Okio&#x7B80;&#x5355;demo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inputStream  : &#x8F93;&#x5165;</span></span><br><span class="line"><span class="comment">// outputStream : &#x8F93;&#x51FA;</span></span><br><span class="line"><span class="keyword">try</span> (BufferedSource source = Okio.buffer(Okio.source(inputStream));</span><br><span class="line">     BufferedSink sink = Okio.buffer(HashingSink.md5(Okio.sink(outputStream)))</span><br><span class="line">) {</span><br><span class="line">    sink.writeAll(source);</span><br><span class="line">    sink.flush();</span><br><span class="line">} <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="&#x6838;&#x5FC3;&#x7C7B;"><a href="#&#x6838;&#x5FC3;&#x7C7B;" class="headerlink" title="&#x6838;&#x5FC3;&#x7C7B;"></a>&#x6838;&#x5FC3;&#x7C7B;</h2><img src="/2017/02/16/okio/okio-0.png"><h3 id="&#x7ED3;&#x8BBA;"><a href="#&#x7ED3;&#x8BBA;" class="headerlink" title="&#x7ED3;&#x8BBA;"></a>&#x7ED3;&#x8BBA;</h3><ol><li><p><code>Source</code>/<code>Sink</code>&#x7C7B;&#x4F3C;&#x4E8E;Java&#x7684;<code>InputStream</code>&#x548C;<code>OutputStream</code>&#xFF0C;&#x4E14;&#x6CA1;&#x6709;&#x533A;&#x5206;&#x5B57;&#x8282;&#x6D41;&#x548C;&#x5B57;&#x7B26;&#x6D41;&#xFF0C;&#x7C7B;&#x56FE;&#x76F4;&#x89C2;&#x611F;&#x89C9;&#x662F;&#x6BD4;Java IO&#x7B80;&#x6D01;</p></li><li><p>Java IO&#x4F7F;&#x7528;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#xFF0C;&#x5BFC;&#x81F4;&#x5404;&#x79CD;IO&#x7C7B;&#x6BD4;&#x8F83;&#x81C3;&#x80BF;&#xFF0C;Okio&#x5C06;&#x5E38;&#x7528;&#x65B9;&#x6CD5;&#x5C01;&#x88C5;&#x5728;<code>BufferedSource</code>/<code>BufferedSink</code>&#x63A5;&#x53E3;&#x4E2D;&#xFF0C;&#x628A;&#x5E95;&#x5C42;&#x5B57;&#x8282;&#x6D41;&#x76F4;&#x63A5;&#x52A0;&#x5DE5;&#x6210;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x7C7B;&#x578B;&#xFF0C;&#x6452;&#x5F03;Java IO&#x4E2D;&#x5404;&#x79CD;&#x8F93;&#x5165;&#x6D41;&#x548C;&#x8F93;&#x51FA;&#x6D41;&#x7684;&#x5D4C;&#x5957;&#x6A21;&#x5F0F;&#xFF1B;&#x4F46;Java IO&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x4F18;&#x70B9;&#x662F;&#x6839;&#x636E;&#x5404;&#x79CD;&#x60C5;&#x51B5;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x6700;&#x4F18;&#x65B9;&#x5F0F;&#xFF0C;Okio&#x53EA;&#x662F;&#x9488;&#x5BF9;&#x5927;&#x591A;&#x6570;&#x573A;&#x666F;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x4F7F;&#x7528;&#x65B9;&#x4FBF;&#x3002;</p></li><li><p>&#x4EE5;&#x8F93;&#x5165;&#x6D41;<code>Source</code>&#x4E3A;&#x4F8B;&#xFF0C;&#x6570;&#x636E;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p><p> (1) Okio#source(InputStream)&#x6700;&#x7EC8;&#x4F1A;&#x8C03;&#x7528;Okio#(InputStream, Timeout)&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;InputStream &#x2013;&gt; Buffer</p><p> (2) Okio#buffer(Source)&#x4F1A;&#x521B;&#x5EFA;RealBufferedSource&#x5BF9;&#x8C61;&#xFF0C;&#x8BE5;&#x5BF9;&#x8C61;&#x5305;&#x62EC;(1)&#x4E2D;&#x6784;&#x5EFA;&#x7684;source&#x548C;&#x4E00;&#x4E2A;Buffer&#xFF0C;&#x8BE5;Buffer&#x5C31;&#x662F;(1)&#x4E2D;Buffer</p><p> (3) &#x6570;&#x636E;&#x8BFB;&#x53D6;&#x6700;&#x7EC8;&#x662F;Buffer&#x5BF9;&#x8C61;&#x7684;&#x8BFB;&#x53D6;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x5148;&#x628A;InputStream&#x6570;&#x636E;&#x653E;&#x5165;Buffer&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x4ECE;Buffer&#x5BF9;&#x8C61;&#x8BFB;&#x53D6;&#xFF1B;&#x5982;&#x679C;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x9884;&#x5148;&#x5728;Buffer&#x4E2D;&#xFF0C;&#x5219;&#x51CF;&#x5C11;&#x4E00;&#x6B21;IO</p><p> (4) Buffer&#x597D;&#x5904;&#x662F;&#xFF1A;Buffer&#x5BF9;&#x8C61;&#x662F;&#x4EE5;&#x6570;&#x636E;&#x5757;Segment(&#x4E0B;&#x9762;&#x4F1A;&#x5206;&#x6790;)&#x4ECE;InputStream&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x7684;&#xFF0C;&#x76F8;&#x6BD4;&#x5355;&#x4E2A;&#x5B57;&#x8282;&#x8BFB;&#x53D6;&#x6765;&#x8BF4;&#xFF0C;&#x6548;&#x7387;&#x4F1A;&#x6709;&#x4E00;&#x5B9A;&#x63D0;&#x9AD8;&#xFF0C;&#x4E00;&#x79CD;&#x7A7A;&#x95F4;&#x6362;&#x65F6;&#x95F4;&#x7684;&#x7B56;&#x7565;</p></li><li><p>&#x6269;&#x5C55;&#x6027;&#xFF1A; Okio&#x5B9E;&#x73B0;&#x4E86;&#x900F;&#x660E;Gzip&#x548C;Hash&#x7F16;&#x7801;&#x7684;IO&#xFF0C;&#x4EE5;&#x8F93;&#x5165;&#x6D41;&#x4E3A;&#x4F8B;&#xFF0C;&#x8BFB;&#x53D6;Gzip&#x8F93;&#x5165;&#x6D41;&#x53EA;&#x9700;&#x5982;&#x4E0B;&#x6784;&#x5EFA;:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BufferedSource source = Okio.buffer(<span class="keyword">new</span> GzipSource(Okio.source(inputStream)));</span><br></pre></td></tr></table></figure></li></ol><p>&#x901A;&#x8FC7;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x5B9E;&#x73B0;&#xFF0C;&#x5F53;&#x524D;&#x53EA;&#x5B9E;&#x73B0;&#x4E86;Gzip&#x548C;&#x5E38;&#x7528;Hash&#xFF0C;&#x56E0;&#x5176;&#x672C;&#x8EAB;&#x662F;&#x4F5C;&#x4E3A;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x7684;IO&#x7EC4;&#x4EF6;&#xFF0C;&#x652F;&#x6301;&#x8FD9;&#x4E9B;&#x5E38;&#x7528;&#x7F16;&#x7801;&#x3002;&#x5176;&#x5BF9;&#x5E94;&#x8F93;&#x5165;&#x6D41;&#x7C7B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p><img src="/2017/02/16/okio/okio-1.png"><p>&#x5982;&#x679C;&#x6709;&#x65B0;&#x7F16;&#x7801;&#x9700;&#x6C42;&#xFF0C;&#x53EF;&#x7EE7;&#x627F;<code>Source</code>&#x8FDB;&#x884C;&#x6269;&#x5C55;&#xFF0C;&#x603B;&#x4E4B;&#xFF0C;&#x88C5;&#x9970;&#x5668;&#x6A21;&#x5F0F;&#x4F7F;&#x5176;&#x6269;&#x5C55;&#x6027;&#x8FD8;&#x662F;&#x4E0D;&#x9519;&#x7684;</p><h2 id="buffer&#x8BE6;&#x89E3;"><a href="#Buffer&#x8BE6;&#x89E3;" class="headerlink" title="Buffer&#x8BE6;&#x89E3;"></a>Buffer&#x8BE6;&#x89E3;</h2><img src="/2017/02/16/okio/okio-2.png"><p>Buffer&#x7EF4;&#x62A4;Segment&#x7EC4;&#x6210;&#x7684;&#x53CC;&#x5411;&#x94FE;&#x8868;&#xFF0C;Segment&#x5B58;&#x50A8;&#x5E95;&#x5C42;&#x6570;&#x636E;(byte&#x6570;&#x7EC4;)&#xFF1B;&#x63D0;&#x4F9B;SegmentPool&#x7528;&#x4E8E;&#x5FEB;&#x901F;&#x5206;&#x914D;&#x548C;&#x56DE;&#x6536;Segment&#x8282;&#x70B9;&#xFF0C;&#x6BCF;&#x4E2A;Segment&#x5E95;&#x5C42;byte&#x6570;&#x7EC4;&#x5927;&#x5C0F;&#x4E3A;8192&#xFF0C;&#x800C;SegmentPool&#x6682;&#x8BBE;&#x5B9A;&#x4E3A;8&#x4E2A;Segment&#x3002;&#x6BCF;&#x4E2A;Segment&#x7684;pos&#x8868;&#x793A;&#x53EF;&#x8BFB;byte&#x5750;&#x6807;&#xFF0C;limit&#x8868;&#x793A;&#x53EF;&#x5199;byte&#x5750;&#x6807;&#xFF0C;&#x7CFB;&#x7EDF;&#x7EF4;&#x62A4;&#x8FD9;&#x4E24;&#x4E2A;&#x53D8;&#x91CF;&#x3002;&#x4F7F;&#x7528;Segment&#x7EF4;&#x62A4;&#x5E95;&#x5C42;&#x6570;&#x636E;&#x7684;&#x597D;&#x5904;&#xFF1A;</p><ol><li><p>&#x4E00;&#x5B9A;&#x7A0B;&#x5EA6;&#x4E0A;&#x63D0;&#x9AD8;IO&#x541E;&#x5410;&#x91CF; </p></li><li><p>&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x6570;&#x636E;&#x79FB;&#x52A8;&#x65F6;&#xFF0C;&#x53EA;&#x9700;&#x79FB;&#x52A8;&#x5BF9;&#x5E94;Segment&#x548C;&#x5C11;&#x91CF;&#x6570;&#x636E;copy&#x5373;&#x53EF;</p></li></ol><p>&#x8003;&#x8651;Okio&#x6700;&#x521D;&#x662F;&#x4F5C;&#x4E3A;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x5E95;&#x5C42;&#x7684;IO&#x5C01;&#x88C5;&#xFF0C;&#x800C;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x95F4;&#x6570;&#x636E;&#x79FB;&#x52A8;&#x662F;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x90E8;&#x5206;&#x4F18;&#x5316;&#x5BF9;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x6574;&#x4F53;&#x6027;&#x80FD;&#x63D0;&#x5347;&#x662F;&#x6BD4;&#x8F83;&#x660E;&#x663E;&#x7684;&#x3002;</p><h3 id="&#x4E24;&#x4E2A;&#x4F18;&#x5316;&#x5C0F;&#x7EC6;&#x8282;"><a href="#&#x4E24;&#x4E2A;&#x4F18;&#x5316;&#x5C0F;&#x7EC6;&#x8282;" class="headerlink" title="&#x4E24;&#x4E2A;&#x4F18;&#x5316;&#x5C0F;&#x7EC6;&#x8282;"></a>&#x4E24;&#x4E2A;&#x4F18;&#x5316;&#x5C0F;&#x7EC6;&#x8282;</h3><img src="/2017/02/16/okio/okio-3.png"><p>&#x76EE;&#x6807;&#x662F;&#xFF1A;&#x5C3D;&#x91CF;&#x4FDD;&#x8BC1;Segment&#x6709;&#x6548;&#x6570;&#x636E;&#x91CF;&#x591A;&#x4E14;&#x5360;&#x7528;&#x4E2A;&#x6570;&#x5C11;&#xFF0C;&#x540C;&#x65F6;&#x51CF;&#x5C11;&#x5E95;&#x5C42;&#x5B57;&#x8282;&#x6570;&#x7EC4;copy&#x3002;</p><h3 id="&#x4E24;&#x4E2A;&#x7591;&#x95EE;"><a href="#&#x4E24;&#x4E2A;&#x7591;&#x95EE;" class="headerlink" title="&#x4E24;&#x4E2A;&#x7591;&#x95EE;"></a>&#x4E24;&#x4E2A;&#x7591;&#x95EE;</h3><p>SegmentPool&#x4F1A;&#x51CF;&#x5C11;&#x5185;&#x5B58;&#x7684;&#x591A;&#x6B21;&#x5206;&#x914D;&#xFF0C;&#x4E2A;&#x4EBA;&#x611F;&#x89C9;&#x5F53;&#x524D;&#x8BBE;&#x5B9A;8&#x4E2A;Segment&#x4F1A;&#x4E0D;&#x4F1A;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#xFF1B;&#x5F53;&#x524D;&#x5355;&#x4E2A;Segment&#x5927;&#x5C0F;&#x9009;&#x62E9;8KB&#xFF0C;&#x5982;&#x679C;&#x9009;&#x62E9;linux&#x9ED8;&#x8BA4;&#x9875;&#x5927;&#x5C0F;(4KB)&#x4F1A;&#x4E0D;&#x4F1A;&#x66F4;&#x597D;&#x4E00;&#x70B9;&#xFF1F;</p><h2 id="&#x5176;&#x4ED6;&#x4F18;&#x5316;"><a href="#&#x5176;&#x4ED6;&#x4F18;&#x5316;" class="headerlink" title="&#x5176;&#x4ED6;&#x4F18;&#x5316;"></a>&#x5176;&#x4ED6;&#x4F18;&#x5316;</h2><h3 id="bytestring"><a href="#ByteString" class="headerlink" title="ByteString"></a>ByteString</h3><p>&#x672C;&#x8D28;&#x662F;&#x4E00;&#x4E2A;&#x6301;&#x6709;byte&#x6570;&#x7EC4;&#x548C;&#x5BF9;&#x5E94;utf8&#x7F16;&#x7801;String&#x7684;&#x7C7B;&#xFF0C;&#x63D0;&#x4F9B;&#x5B57;&#x7B26;&#x4E32;&#x5E38;&#x89C1;&#x64CD;&#x4F5C;&#x548C;&#x5404;&#x79CD;&#x7F16;&#x7801;&#x65B9;&#x6CD5;(hex&#xFF0C;base64&#x7B49;)&#xFF0C;&#x7F13;&#x5B58;utf-8&#x5B57;&#x7B26;&#x4E32;&#x53EF;&#x6709;&#x6548;&#x63D0;&#x9AD8;utf-8&#x7F16;&#x89E3;&#x7801;&#x6548;&#x7387;&#xFF0C;&#x66F4;&#x9002;&#x7528;&#x4E8E;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x3002;</p><h3 id="timeout"><a href="#Timeout" class="headerlink" title="Timeout"></a>Timeout</h3><p>Java&#x539F;&#x751F;IO&#x5E76;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x8D85;&#x65F6;&#x673A;&#x5236;&#xFF0C;&#x5C24;&#x5176;&#x5411;Socket&#x5199;&#x6570;&#x636E;&#x65F6;&#x7531;&#x4E8E;&#x7F51;&#x7EDC;&#x95EE;&#x9898;&#x4F1A;&#x957F;&#x65F6;&#x95F4;&#x963B;&#x585E;&#xFF0C;&#x6240;&#x4EE5;Okio&#x9488;&#x5BF9;IO&#x672C;&#x8EAB;&#x63D0;&#x4F9B;&#x8D85;&#x65F6;&#x673A;&#x5236;&#xFF0C;&#x4E3B;&#x8981;&#x63D0;&#x4F9B;&#x4E24;&#x79CD;&#x673A;&#x5236;&#xFF1A;&#x540C;&#x6B65;&#x548C;&#x5F02;&#x6B65;&#x673A;&#x5236;&#xFF0C;&#x5206;&#x522B;&#x7531;Timeout&#x548C;AsyncTimeout&#x5B9E;&#x73B0;&#xFF0C;&#x793A;&#x610F;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p><img src="/2017/02/16/okio/okio-4.png"><hr><img src="/2017/02/16/okio/okio-5.png"><p><strong>&#x63D0;&#x4F9B;&#x8D85;&#x65F6;&#x673A;&#x5236;&#x662F;&#x5BF9;Java IO&#x8FDB;&#x884C;&#x8865;&#x5145;&#xFF0C;&#x5C24;&#x5176;&#x5F02;&#x6B65;&#x8D85;&#x65F6;&#x673A;&#x5236;&#x5BF9;&#x4E8E;Socket&#x7F16;&#x7A0B;&#x975E;&#x5E38;&#x53CB;&#x597D;</strong></p><h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>Okio&#x7EC4;&#x4EF6;&#x662F;&#x9488;&#x5BF9;HTTP&#x5BA2;&#x6237;&#x7AEF;&#x573A;&#x666F;&#x5BF9;Java I/O&#x8FDB;&#x884C;&#x7684;&#x4F18;&#x5316;&#xFF0C;&#x4F7F;&#x7528;&#x66F4;&#x52A0;&#x4FBF;&#x6377;&#xFF0C;app&#x4E2D;&#x4E00;&#x822C;IO&#x64CD;&#x4F5C;&#x4E5F;&#x53EF;&#x4F7F;&#x7528;&#xFF0C;&#x5C24;&#x5176;&#x662F;&#x5176;&#x63D0;&#x4F9B;&#x5F88;&#x4FBF;&#x6377;&#x7684;&#x52A0;&#x89E3;&#x5BC6;&#x3001;&#x538B;&#x7F29;&#x89E3;&#x538B;&#x6548;&#x679C;&#x3002;</p><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><ol><li><a href="https://github.com/square/okio" target="_blank" rel="noopener">https://github.com/square/okio</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#简介&quot;&gt;简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#okio简单demo&quot;&gt;Okio简单demo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#核心类&quot;&gt;核心类&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#结论&quot;&gt;结论&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#buffer详解&quot;&gt;Buffer详解&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#两个优化小细节&quot;&gt;两个优化小细节&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#两个疑问&quot;&gt;两个疑问&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#其他优化&quot;&gt;其他优化&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#bytestring&quot;&gt;ByteString&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#timeout&quot;&gt;Timeout&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#总结&quot;&gt;总结&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;Okio是由Square公司开发并开源的java IO组件库，最初用于其开发的HTTP客户端OkHttp的底层IO封装，从Android 4.4起，HttpURLConnection底层实现采用Okhttp，Okio组件也被开发者所认可。根据GitHub介绍，该组件定位是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Okio is a new library that complements java.io and java.nio to make it much easier to access, store, and process your data.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;我们主要是通过源码分析学习其优化的思想。&lt;/p&gt;
&lt;h2 id=&quot;Okio简单demo&quot;&gt;&lt;a href=&quot;#Okio简单demo&quot; class=&quot;headerlink&quot; title=&quot;Okio简单demo&quot;&gt;&lt;/a&gt;Okio简单demo&lt;/h2&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// inputStream  : 输入&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// outputStream : 输出&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; (BufferedSource source = Okio.buffer(Okio.source(inputStream));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     BufferedSink sink = Okio.buffer(HashingSink.md5(Okio.sink(outputStream)))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sink.writeAll(source);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    sink.flush();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (IOException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android 开发参考规范</title>
    <link href="http://yoursite.com/2017/01/10/android-style-guide/"/>
    <id>http://yoursite.com/2017/01/10/android-style-guide/</id>
    <published>2017-01-10T08:03:08.000Z</published>
    <updated>2017-01-10T08:08:22.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x53C2;&#x8003;&#x6765;&#x6E90;"><a href="#&#x53C2;&#x8003;&#x6765;&#x6E90;" class="headerlink" title="&#x53C2;&#x8003;&#x6765;&#x6E90;"></a>&#x53C2;&#x8003;&#x6765;&#x6E90;</h2><p> <strong> &#x5EFA;&#x8BAE;&#x4ED4;&#x7EC6;&#x9605;&#x8BFB;&#x4EE5;&#x4E0B;&#x6587;&#x6863;:</strong></p><ol><li><a href="http://google.github.io/styleguide/javaguide.html" target="_blank" rel="noopener">Google Java Style Guide</a></li><li><a href="https://google.github.io/styleguide/cppguide.html" target="_blank" rel="noopener">Google C++ Style Guide</a></li><li><a href="http://source.android.com/source/code-style.html#java-language-rules" target="_blank" rel="noopener">Android Source Style Guide</a></li></ol><h2 id="&#x76EE;&#x6807;"><a href="#&#x76EE;&#x6807;" class="headerlink" title="&#x76EE;&#x6807;"></a>&#x76EE;&#x6807;</h2><p><strong>&#x7B80;&#x5355;&#xFF0C;&#x7EDF;&#x4E00;&#xFF0C;&#x9AD8;&#x6548;</strong></p><a id="more"></a><h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><h3 id="java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p><strong>1.</strong> &#x7C7B;&#x540D;&#x5927;&#x5C0F;&#x5199;&#x654F;&#x611F;&#xFF0C;&#x9996;&#x5B57;&#x6BCD;&#x5C0F;&#x5199;&#xFF0C;&#x540E;&#x7F00;&#x540D;<code>.java</code></p><p><strong>2.</strong> &#x6E90;&#x4EE3;&#x7801;UTF-8&#x7F16;&#x7801;</p><p><strong>3.</strong> &#x7F29;&#x8FDB;&#x4F7F;&#x7528;&#x7A7A;&#x683C;(0x20)&#xFF0C;&#x9664;&#x53BB;&#x7A7A;&#x683C;&#x7684;&#x5176;&#x4F59;&#x6240;&#x6709;&#x7A7A;&#x767D;&#x5B57;&#x7B26;&#x4F7F;&#x7528;&#x8F6C;&#x4E49;(<code>\t</code>&#x7B49;)</p><p><strong>4.</strong> &#x8F6C;&#x4E49;&#x5B57;&#x7B26;&#x4F18;&#x5148;&#x4F7F;&#x7528;(<code>\b</code>, <code>\t</code>, <code>\n</code>, <code>\f</code>, <code>\r</code>, <code>\&quot;</code>, <code>\&apos;</code>&#x548C;<code>\\</code>)&#xFF0C;&#x5176;&#x6B21;&#x4F7F;&#x7528;&#x516B;&#x8FDB;&#x5236;&#x6216;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x8868;&#x793A;&#xFF1B;&#x5728;&#x5E03;&#x5C40;&#x6587;&#x4EF6;xml&#x4E2D;&#x7684;&#x7279;&#x6B8A;&#x5B57;&#x7B26;Android Studio&#x4F1A;&#x7ED9;&#x51FA;&#x5BF9;&#x5E94;&#x8F6C;&#x4E49;&#x63D0;&#x793A;</p><p><strong>5.</strong> &#x4E0D;&#x4F7F;&#x7528;&#x901A;&#x914D;&#x7B26;(*)&#x8FDB;&#x884C;&#x5BFC;&#x5165;import</p><p><strong>6.</strong> &#x7C7B;&#x7684;&#x91CD;&#x8F7D;&#x65B9;&#x6CD5;&#x5E94;&#x8BE5;&#x6309;&#x987A;&#x5E8F;&#x5728;&#x4E00;&#x8D77;&#xFF0C;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x540C;&#x7406;</p><p><strong>7.</strong> &#x5373;&#x4F7F;<code>if</code>&#x7B49;&#x8BED;&#x53E5;&#x53EA;&#x6709;&#x4E00;&#x884C;&#x8BED;&#x53E5;&#x65F6;&#xFF0C;&#x4E5F;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x82B1;&#x62EC;&#x53F7;(<code>{}</code>)&#xFF0C;&#x82B1;&#x62EC;&#x53F7;&#x9075;&#x5FAA;K&amp;R Style</p><p><strong>8.</strong> &#x4E00;&#x884C;&#x4E00;&#x6761;&#x8BED;&#x53E5;&#xFF0C;&#x957F;&#x5EA6;&#x6700;&#x5927;100</p><p><strong>9.</strong> &#x6C34;&#x5E73;&#x7A7A;&#x767D;&#x548C;&#x5782;&#x76F4;&#x7A7A;&#x767D;&#x6839;&#x636E;&#x903B;&#x8F91;&#x548C;&#x7F8E;&#x89C2;&#x8FDB;&#x884C;&#x6DFB;&#x52A0;</p><p><strong>10.</strong> &#x8FD0;&#x7B97;&#x7B26;&#x4F18;&#x5148;&#x7EA7;&#x4F7F;&#x7528;&#x5C0F;&#x62EC;&#x53F7;&#x6307;&#x5B9A;</p><p><strong>11.</strong> switch&#x90FD;&#x5305;&#x542B;<code>default</code>&#x8BED;&#x53E5;&#xFF0C;&#x5373;&#x4F7F;&#x4EC0;&#x4E48;&#x4EE3;&#x7801;&#x4E5F;&#x6CA1;&#x6709;</p><p><strong>12.</strong> &#x6CE8;&#x91CA;&#x5757;&#x9075;&#x5FAA;&#x5982;&#x4E0B;&#x683C;&#x5F0F; </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * This is          // And so           /* Or you can</span><br><span class="line"> * okay.            // is this.          * even do this. */</span><br><span class="line"> */</span><br></pre></td></tr></table></figure><p><strong>13.</strong> Modifiers&#x51FA;&#x73B0;&#x987A;&#x5E8F;</p><p><code>public protected private abstract static final transient volatile synchronized native strictfp</code></p><p><strong>14.</strong> long &#x540E;&#x7F00;&#x4F7F;&#x7528; <code>L</code>&#xFF0C;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x548C;&#x516B;&#x8FDB;&#x5236;&#x524D;&#x7F00;&#x4F7F;&#x7528;<code>0x</code>&#x548C;<code>o</code></p><p><strong>15.</strong> &#x547D;&#x540D;&#x7EA6;&#x5B9A;&#xFF1A;</p><ul><li><p>&#x6807;&#x8BC6;&#x7B26;&#x53EA;&#x4F7F;&#x7528;ASCII&#x548C;&#x6570;&#x5B57;  </p></li><li><p>&#x5305;&#x540D;&#x5168;&#x90E8;&#x5C0F;&#x5199;&#xFF0C;&#x4E2D;&#x95F4;&#x65E0;&#x4E0B;&#x5212;&#x7EBF;</p></li><li><p>&#x7C7B;&#x540D;&#x4F7F;&#x7528;<code>UpperCamelCase</code>&#x98CE;&#x683C;</p></li><li><p>&#x65B9;&#x6CD5;&#x540D;&#x4F7F;&#x7528;<code>lowerCamelCase</code>&#x98CE;&#x683C;</p></li><li><p>&#x5E38;&#x91CF;&#x4F7F;&#x7528;static fianl&#xFF0C;&#x5927;&#x5199;&#x5B57;&#x6BCD;&#x5E76;&#x4EE5;&#x4E0B;&#x5212;&#x7EBF;&#x5206;&#x5272;</p></li><li><p>CamelCase&#xFF1A;&#x6BCF;&#x4E2A;&#x5355;&#x8BCD;&#x9996;&#x5B57;&#x6BCD;&#x5927;&#x5199;&#xFF0C;&#x5176;&#x4F59;&#x5C0F;&#x5199;</p></li></ul><p><strong>16.</strong> &#x7F16;&#x7A0B;&#x4E60;&#x60EF;&#xFF1A;</p><ul><li><p>&#x4F7F;&#x7528;Java&#x63D0;&#x4F9B;&#x7684;&#x6CE8;&#x89E3;(@Override, @Deprecated &#x548C; @SuppressWarnings)</p></li><li><p>&#x5F02;&#x5E38;&#x6355;&#x83B7;&#x6700;&#x597D;&#x6307;&#x5B9A;&#x7C7B;&#x578B;&#xFF0C;&#x5E76;&#x7ED9;&#x51FA;&#x5F02;&#x5E38;&#x65F6;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</p></li><li><p>&#x9759;&#x6001;&#x6210;&#x5458;&#x548C;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x4F7F;&#x7528;&#x7C7B;&#x53D8;&#x91CF;&#x8FDB;&#x884C;&#x8C03;&#x7528;</p></li><li><p>&#x7C7B;&#x6210;&#x5458;&#x7684;&#x4E60;&#x60EF;&#x547D;&#x540D;&#x683C;&#x5F0F;(&#x6CE8;&#x610F;&#x524D;&#x9762;&#x7684;<code>m</code>)</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SOME_CONSTANT = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> publicField;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyClass sSingleton;</span><br><span class="line">    <span class="keyword">int</span> mPackagePrivate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mPrivate;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> mProtected;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><ul><li><p>&#x7279;&#x6709;&#x540D;&#x8BCD;&#x5F53;&#x6210;&#x666E;&#x901A;&#x5355;&#x8BCD;&#xFF0C;&#x4F8B;&#x5982; IOS-&gt;Ios</p></li><li><p>&#x4F7F;&#x7528;TODO&#x8FDB;&#x884C;&#x672A;&#x5B8C;&#x6210;&#x7684;&#x6CE8;&#x91CA;</p></li><li><p>&#x65E5;&#x5FD7;&#x4F7F;&#x7528;Log&#xFF0C;&#x4F7F;&#x7528;tag&#x5206;&#x7C7B;&#xFF0C;&#x6CE8;&#x610F;&#x5404;&#x79CD;&#x7EA7;&#x522B;&#xFF1A;</p></li></ul><table><thead><tr><th style="text-align:left">&#x7EA7;&#x522B;</th><th style="text-align:left">&#x9002;&#x7528;&#x573A;&#x666F;</th></tr></thead><tbody><tr><td style="text-align:left"><code>ERROR</code></td><td style="text-align:left">&#x81F4;&#x547D;&#x9519;&#x8BEF;&#x5BFC;&#x81F4;&#x7684;&#x8FD0;&#x884C;&#x65F6;&#x5F02;&#x5E38;(crash)</td></tr><tr><td style="text-align:left"><code>WARNING</code></td><td style="text-align:left">&#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x5D29;&#x6E83;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x8FDB;&#x4E00;&#x6B65;&#x53BB;&#x6539;&#x8FDB;</td></tr><tr><td style="text-align:left"><code>INFORMATION</code></td><td style="text-align:left">&#x62A5;&#x544A;&#x4E00;&#x4E9B;&#x5BF9;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4FE1;&#x606F;</td></tr><tr><td style="text-align:left"><code>DEBUG</code></td><td style="text-align:left">&#x8C03;&#x8BD5;&#x65F6;&#x4EA7;&#x751F;&#x5F02;&#x5E38;&#x7684;&#x4FE1;&#x606F;</td></tr><tr><td style="text-align:left"><code>VERBOSE</code></td><td style="text-align:left">&#x666E;&#x901A;&#x63D0;&#x793A;&#x4FE1;&#x606F;&#xFF0C;&#x7528;&#x4E8E;&#x89C2;&#x5BDF;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;</td></tr></tbody></table><ul><li><p>Java&#x8BBF;&#x95EE;&#x6743;&#x9650;&#x6700;&#x5C0F;&#x5316;&#xFF0C;&#x5305;&#x62EC;:</p><ul><li>&#x53D8;&#x91CF;&#x4F18;&#x5148;&#x4F7F;&#x7528;&#x5C40;&#x90E8;&#x53D8;&#x91CF; &gt; &#x6210;&#x5458;&#x53D8;&#x91CF; &gt; &#x9759;&#x6001;&#x53D8;&#x91CF;</li><li>&#x65B9;&#x6CD5;&#x4F18;&#x5148;&#x4F7F;&#x7528;private &gt; protected &gt; default &gt; public </li><li>&#x5B9A;&#x4E49;&#x4F18;&#x5148;&#x6A21;&#x5757; &gt; &#x5168;&#x5C40;</li></ul></li><li><p>&#x4F7F;&#x7528;Annotations&#x548C;&#x5E38;&#x91CF;&#x4EE3;&#x66FF;&#x679A;&#x4E3E;</p></li><li><p>&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x547D;&#x540D;&#x8981;&#x4F7F;&#x7528;&#x7C7B;&#x578B;&#x524D;&#x7F00;&#xFF0C;&#x8D44;&#x6E90;id&#x8981;&#x4F7F;&#x7528;&#x8D44;&#x6E90;&#x6587;&#x4EF6;&#x540D;&#x4F5C;&#x4E3A;&#x524D;&#x7F00;</p></li><li><p>&#x4F18;&#x5148;&#x4F7F;&#x7528;res&#x8FDB;&#x884C;&#x8D44;&#x6E90;&#x5B9A;&#x4E49;&#xFF0C;&#x907F;&#x514D;&#x4EE3;&#x7801;&#x5199;&#x6B7B;</p></li><li><p>&#x591A;&#x4F7F;&#x7528;Android&#x63D0;&#x4F9B;&#x7684;&#x7279;&#x5B9A;API </p></li></ul><h3 id="cc"><a href="#C-C" class="headerlink" title="C/C++"></a>C/C++</h3><p>&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x4F7F;&#x7528;NDK&#x5F00;&#x53D1;&#xFF0C;&#x5F85;&#x7EED;&#x3002;&#x3002;&#x3002;</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;参考来源&quot;&gt;&lt;a href=&quot;#参考来源&quot; class=&quot;headerlink&quot; title=&quot;参考来源&quot;&gt;&lt;/a&gt;参考来源&lt;/h2&gt;&lt;p&gt; &lt;strong&gt; 建议仔细阅读以下文档:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://google.github.io/styleguide/javaguide.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Google Java Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://google.github.io/styleguide/cppguide.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Google C++ Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://source.android.com/source/code-style.html#java-language-rules&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Android Source Style Guide&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;目标&quot;&gt;&lt;a href=&quot;#目标&quot; class=&quot;headerlink&quot; title=&quot;目标&quot;&gt;&lt;/a&gt;目标&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;简单，统一，高效&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>《Java TCP/IP Socket编程》读书笔记(下)</title>
    <link href="http://yoursite.com/2016/12/08/java-tcp-ip-socket-program-note-1/"/>
    <id>http://yoursite.com/2016/12/08/java-tcp-ip-socket-program-note-1/</id>
    <published>2016-12-08T08:23:32.000Z</published>
    <updated>2016-12-08T08:30:08.000Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#&#x7B2C;&#x56DB;&#x7AE0;-&#x8FDB;&#x9636;">&#x7B2C;&#x56DB;&#x7AE0; &#x8FDB;&#x9636;</a></li><li><a href="#&#x7B2C;&#x4E94;&#x7AE0;-nio">&#x7B2C;&#x4E94;&#x7AE0; NIO</a></li><li><a href="#&#x7B2C;&#x516D;&#x7AE0;-&#x6DF1;&#x5165;&#x5256;&#x6790;">&#x7B2C;&#x516D;&#x7AE0; &#x6DF1;&#x5165;&#x5256;&#x6790;</a></li></ul><!-- tocstop --><h2 id="&#x7B2C;&#x56DB;&#x7AE0;-&#x8FDB;&#x9636;"><a href="#&#x7B2C;&#x56DB;&#x7AE0;-&#x8FDB;&#x9636;" class="headerlink" title="&#x7B2C;&#x56DB;&#x7AE0; &#x8FDB;&#x9636;"></a>&#x7B2C;&#x56DB;&#x7AE0; &#x8FDB;&#x9636;</h2><img src="/2016/12/08/java-tcp-ip-socket-program-note-1/chapter4.png"><a id="more"></a><h2 id="&#x7B2C;&#x4E94;&#x7AE0;-nio"><a href="#&#x7B2C;&#x4E94;&#x7AE0;-NIO" class="headerlink" title="&#x7B2C;&#x4E94;&#x7AE0; NIO"></a>&#x7B2C;&#x4E94;&#x7AE0; NIO</h2><p><strong>1. Buffer</strong></p><p>1.Buffer&#x7D22;&#x5F15;</p><table><thead><tr><th style="text-align:left">&#x7D22;&#x5F15;</th><th style="text-align:left">&#x63CF;&#x8FF0;</th></tr></thead><tbody><tr><td style="text-align:left">capacity</td><td style="text-align:left">&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5143;&#x7D20;&#x603B;&#x6570;(&#x4E0D;&#x53EF;&#x4FEE;&#x6539;)</td></tr><tr><td style="text-align:left">position</td><td style="text-align:left">&#x4E0B;&#x4E00;&#x4E2A;&#x8981;&#x8BFB;/&#x5199;&#x7684;&#x5143;&#x7D20;(&#x4ECE;0&#x5F00;&#x59CB;)</td></tr><tr><td style="text-align:left">limit</td><td style="text-align:left">&#x7B2C;&#x4E00;&#x4E2A;&#x4E0D;&#x53EF;&#x8BFB;/&#x5199;&#x5143;&#x7D20;</td></tr><tr><td style="text-align:left">mark</td><td style="text-align:left">&#x7528;&#x6237;&#x9009;&#x5B9A;position&#x7684;&#x524D;&#x4E00;&#x4E2A;&#x4F4D;&#x7F6E;&#xFF0C;&#x6216;0</td></tr></tbody></table><p>ByteBuffer#hasRemaining: &#x5F53;&#x7F13;&#x51B2;&#x533A;&#x81F3;&#x5C11;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;true</p><p>ByteBuffer#remaining(): &#x8FD4;&#x56DE;&#x5269;&#x4F59;&#x5143;&#x7D20;&#x7684;&#x4E2A;&#x6570;</p><p>2.&#x521B;&#x5EFA;Buffer</p><ul><li>ByteBuffer#allocate(int capacity) &#x6216; ByteBuffer#allocateDirect(int capacity)</li><li>ByteBuffer#wrap()&#x65B9;&#x6CD5;</li></ul><p><strong>Tips:</strong> </p><p>&#x540E;&#x63F4;&#x6570;&#x7EC4;&#xFF1A;</p><p>a) &#x7F13;&#x51B2;&#x533A;&#x8C03;&#x7528;array()&#x83B7;&#x53D6;&#x540E;&#x63F4;&#x6570;&#x7EC4;<br>b) &#x8C03;&#x7528;arrayOffset()&#x83B7;&#x53D6;&#x7F13;&#x51B2;&#x533A;&#x7B2C;&#x4E00;&#x4E2A;&#x5143;&#x7D20;&#x5728;&#x540E;&#x63F4;&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x504F;&#x79FB;&#x91CF;</p><p>direct buffers&#x4F7F;&#x7528;&#x65F6;&#x5FC5;&#x987B;&#x8C03;&#x7528;isDirect()&#x8FDB;&#x884C;&#x68C0;&#x67E5;</p><p>3.&#x5B58;&#x50A8;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;</p><ul><li>get()/put() &#x2013;&gt;  &#x7EDD;&#x5BF9;&#x4F4D;&#x7F6E;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;position&#xFF0C;&#x800C;&#x76F8;&#x5BF9;&#x4F4D;&#x7F6E;&#x4F1A;</li><li>&#x5141;&#x8BB8;&#x94FE;&#x5F0F;&#x8C03;&#x7528;</li><li>Java&#x9ED8;&#x8BA4;big-endian&#xFF1B;ByteOrder#nativeOrder()&#x83B7;&#x53D6;&#x7CFB;&#x7EDF;&#x652F;&#x6301;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x5217;</li></ul><p>4.&#x51C6;&#x5907;Buffer</p><table><thead><tr><th style="text-align:left">&#x65B9;&#x6CD5;</th><th style="text-align:left">&#x63CF;&#x8FF0;</th><th style="text-align:left">&#x7ED3;&#x679C;&#x503C;Position</th><th style="text-align:left">&#x7ED3;&#x679C;&#x503C;Limit</th></tr></thead><tbody><tr><td style="text-align:left">clear()</td><td style="text-align:left">&#x5C06;&#x6570;&#x636E;read()/put()&#x8FDB;&#x7F13;&#x51B2;&#x533A;</td><td style="text-align:left">0</td><td style="text-align:left">capacity</td></tr><tr><td style="text-align:left">flip()</td><td style="text-align:left">&#x4ECE;&#x7F13;&#x51B2;&#x533A;write()/get()</td><td style="text-align:left">0</td><td style="text-align:left">position</td></tr><tr><td style="text-align:left">rewind()</td><td style="text-align:left">&#x4ECE;&#x7F13;&#x51B2;&#x533A;rewrite()/get()</td><td style="text-align:left">0</td><td style="text-align:left">&#x65E0;&#x53D8;&#x5316;&#xFF0C;&#x4F7F;mark&#x503C;&#x65E0;&#x6548;</td></tr></tbody></table><p>5.&#x538B;&#x7F29;Buffer&#x7684;&#x6570;&#x636E;</p><p>compact()&#x65B9;&#x6CD5;&#x5C06;&#x6240;&#x6709;&#x672A;&#x8BFB;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;Buffer&#x8D77;&#x59CB;&#x5904;&#xFF0C;&#x7136;&#x540E;&#x5C06;position&#x8BBE;&#x5230;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x672A;&#x8BFB;&#x5143;&#x7D20;&#x540E;&#x9762;&#xFF0C;limit&#x5C5E;&#x6027;&#x4F9D;&#x7136;&#x50CF;clear()&#x65B9;&#x6CD5;&#x4E00;&#x6837;&#xFF0C;&#x8BBE;&#x7F6E;&#x6210;capacity&#x3002;&#x8FD9;&#x6837;Buffer&#x51C6;&#x5907;&#x597D;&#x5199;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x4E0D;&#x4F1A;&#x8986;&#x76D6;&#x672A;&#x8BFB;&#x7684;&#x6570;&#x636E;&#x3002;</p><p>6.Buffer&#x900F;&#x89C6; </p><p>&#x4E0E;&#x539F;&#x59CB;&#x7F13;&#x51B2;&#x533A;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x540E;&#x63F4;&#x5B58;&#x50A8;&#x7A7A;&#x95F4;&#xFF0C;&#x65B9;&#x6CD5;&#x6709;&#xFF1A;duplicate()&#xFF0C;slice()&#xFF0C;asReadOnlyBuffer()&#xFF0C;asReadOnlyBuffer()&#x4EE5;&#x53CA;asXXXBuffer()&#xFF1B;<br>&#x65B0;&#x7F13;&#x51B2;&#x533A;&#x8C03;&#x7528;array()&#x8FD8;&#x662F;&#x4F1A;&#x8FD4;&#x56DE;&#x6574;&#x4E2A;&#x6570;&#x7EC4;&#xFF0C;&#x4F7F;&#x7528;isReadOnly()&#x68C0;&#x6D4B;&#x662F;&#x5426;&#x53EA;&#x8BFB;&#x3002;</p><p>7.&#x5B57;&#x7B26;&#x7F16;&#x7801;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Charset charSet = Charset.forName(<span class="string">&quot;US-ASCII&quot;</span>);</span><br><span class="line">CharsetEncoder encoder = charSet.newEncoder();</span><br><span class="line"></span><br><span class="line">encoder.reset();<span class="comment">// &#x975E;&#x5FC5;&#x987B;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(encoder.encode(CharBuffer.wrap(<span class="string">&quot;input...&quot;</span>), buffer, <span class="keyword">false</span>) == CoderResult.OVERFLOW){</span><br><span class="line">    <span class="comment">// ... deal with lack of space in buffer ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="comment">// &#x5230;&#x8FBE;&#x8F93;&#x5165;&#x6570;&#x636E;&#x7ED3;&#x5C3E;&#x8BBE;&#x4E3A; true</span></span><br><span class="line"><span class="keyword">if</span>(encoder.encode(CharBuffer.wrap(<span class="string">&quot;last input...&quot;</span>), buffer, <span class="keyword">true</span>) == CoderResult.OVERFLOW){</span><br><span class="line">    <span class="comment">// ... deal with lack of space in buffer ...</span></span><br><span class="line">}</span><br><span class="line">encoder.flush(buffer);</span><br></pre></td></tr></table></figure><p><strong>2. TCP Channel</strong></p><ul><li><p>SocketChannel </p><ul><li>&#x201C;&#x5305;&#x88F9;&#x201D;&#x4E00;&#x4E2A;&#x57FA;&#x672C;Java Socket&#xFF0C;&#x901A;&#x8FC7;socket()&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x8BBF;&#x95EE;</li><li>&#x6563;&#x5C04;&#x5F0F;&#x8BFB;/&#x805A;&#x96C6;&#x5F0F;&#x5199; (Scattering read/gathering write)</li></ul></li><li><p>ServerSocketChannel</p><ul><li>&#x5C06;&#x4FE1;&#x9053;&#x8BBE;&#x7F6E;&#x4E3A;&#x975E;&#x963B;&#x585E;&#x5F0F;</li><li>&#x6D4B;&#x8BD5;&#x8FDE;&#x63A5;&#x6027;:<br>isConnectionPending() -&gt; finishConnect() -&gt; isConnected()</li></ul></li></ul><p><strong>3. Selector</strong></p><table><thead><tr><th style="text-align:left">&#x64CD;&#x4F5C;</th><th style="text-align:left">&#x5173;&#x952E;&#x4EE3;&#x7801;</th></tr></thead><tbody><tr><td style="text-align:left">&#x5174;&#x8DA3;&#x64CD;&#x4F5C;&#x96C6;SelectionKey</td><td style="text-align:left">OP_ACCEPT<br>OP_CONNECT<br>OP_READ<br>OP_WRITE</td></tr><tr><td style="text-align:left">&#x6CE8;&#x518C;Selector</td><td style="text-align:left">SelectionKey register(Selector sel, int ops)<br>SelectionKey register(Selector sel, int ops, Object attachment)<br></td></tr><tr><td style="text-align:left">SelectionKey &#x83B7;&#x53D6;&#x548C;&#x53D6;&#x6D88;</td><td style="text-align:left">Selector selector()<br>SelectableChannel channel()<br>void cancel()<br></td></tr><tr><td style="text-align:left">Selector&#x9009;&#x53D6;&#x548C;&#x8BC6;&#x522B;&#x5C31;&#x7EEA;&#x7684;&#x4FE1;&#x9053;</td><td style="text-align:left">int select()<br>int select(long timeout)<br>int selectNow()<br>Selector wakeup() <br> int &#x8FD4;&#x56DE;&#x503C;&#xFF1A;&#x51C6;&#x5907;&#x597D;&#x7684;&#x4FE1;&#x9053;&#x603B;&#x6570;</td></tr><tr><td style="text-align:left">Selector&#x83B7;&#x53D6;&#x952E;&#x96C6;</td><td style="text-align:left">Set<selectionkey> keys() -&gt; &#x4E0D;&#x4FEE;&#x6539; <br> Set<selectionkey> selectedKeys() -&gt; &#x53EF;&#x4FEE;&#x6539;&#xFF0C;&#x9700;&#x8981;&#x624B;&#x52A8;&#x6E05;&#x7A7A;</selectionkey></selectionkey></td></tr><tr><td style="text-align:left">SelectionKey&#x67E5;&#x627E;&#x5C31;&#x7EEA;&#x7684;I/O&#x64CD;&#x4F5C;</td><td style="text-align:left">boolean isAcceptable()<br>boolean isConnectable()<br>boolean isReadable()<br>boolean isWritable()<br>boolean isValid() -&gt; &#x952E;&#x662F;&#x5426;&#x6709;&#x6548;</td></tr><tr><td style="text-align:left">SelectionKey&#x67E5;&#x627E;&#x51C6;&#x5907;&#x5C31;&#x7EEA;&#x7684;I/O&#x64CD;&#x4F5C;</td><td style="text-align:left">Object attach(Object) <br> Object attachment()</td></tr></tbody></table><p><strong>4. UDP Channel</strong></p><ul><li>DatagramChannel</li></ul><table><thead><tr><th style="text-align:left">&#x64CD;&#x4F5C;</th><th style="text-align:left">&#x5173;&#x952E;&#x4EE3;&#x7801;</th></tr></thead><tbody><tr><td style="text-align:left">&#x521B;&#x5EFA;&#x3001;&#x8FDE;&#x63A5;&#x548C;&#x5173;&#x95ED;</td><td style="text-align:left">static DatagramChannel open() <br> boolean isOpen() <br> DatagramSocket socket() <br> void close()</td></tr><tr><td style="text-align:left">&#x53D1;&#x9001;&#x548C;&#x8FDE;&#x63A5;</td><td style="text-align:left">int send(ByteBuffer src, SocketAddress target) <br> SocketAddress receive(ByteBuffer dst)</td></tr><tr><td style="text-align:left">&#x8FDE;&#x63A5;DatagramChannel</td><td style="text-align:left">DatagramChannel connect(SocketAddress remote) <br> read()/write()&#x65B9;&#x6CD5;</td></tr><tr><td style="text-align:left">&#x8BBE;&#x7F6E;&#x963B;&#x585E;&#x884C;&#x4E3A;&#x548C;&#x4F7F;&#x7528;&#x9009;&#x62E9;&#x5668;</td><td style="text-align:left">&#x4E0E;SocketChannel&#x548C;ServerSocketChannel&#x65B9;&#x6CD5;&#x4E00;&#x81F4;</td></tr></tbody></table><h2 id="&#x7B2C;&#x516D;&#x7AE0;-&#x6DF1;&#x5165;&#x5256;&#x6790;"><a href="#&#x7B2C;&#x516D;&#x7AE0;-&#x6DF1;&#x5165;&#x5256;&#x6790;" class="headerlink" title="&#x7B2C;&#x516D;&#x7AE0; &#x6DF1;&#x5165;&#x5256;&#x6790;"></a>&#x7B2C;&#x516D;&#x7AE0; &#x6DF1;&#x5165;&#x5256;&#x6790;</h2><img src="/2016/12/08/java-tcp-ip-socket-program-note-1/chapter6.png"><img src="/2016/12/08/java-tcp-ip-socket-program-note-1/TCP_3way_handshake.png"><img src="/2016/12/08/java-tcp-ip-socket-program-note-1/TCP_4way_close.png">]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#第四章-进阶&quot;&gt;第四章 进阶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第五章-nio&quot;&gt;第五章 NIO&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第六章-深入剖析&quot;&gt;第六章 深入剖析&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;第四章-进阶&quot;&gt;&lt;a href=&quot;#第四章-进阶&quot; class=&quot;headerlink&quot; title=&quot;第四章 进阶&quot;&gt;&lt;/a&gt;第四章 进阶&lt;/h2&gt;&lt;img src=&quot;/2016/12/08/java-tcp-ip-socket-program-note-1/chapter4.png&quot;&gt;
    
    </summary>
    
      <category term="读书笔记" scheme="http://yoursite.com/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="Socket" scheme="http://yoursite.com/tags/Socket/"/>
    
  </entry>
  
  <entry>
    <title>Android Studio 常用插件</title>
    <link href="http://yoursite.com/2016/11/13/android-studio-plugin/"/>
    <id>http://yoursite.com/2016/11/13/android-studio-plugin/</id>
    <published>2016-11-13T09:04:28.000Z</published>
    <updated>2016-11-13T15:43:05.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>&#x6574;&#x7406;&#x4F7F;&#x7528;Android Studio&#x8FDB;&#x884C;&#x5F00;&#x53D1;&#x65F6;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x5982;&#x53D1;&#x73B0;&#x66F4;&#x597D;&#x7528;&#x7684;&#x63D2;&#x4EF6;&#x4F1A;&#x53CA;&#x65F6;&#x66F4;&#x65B0;&#x3002;</strong></p><p><strong>1. GsonFormat</strong><br>&#x5FEB;&#x901F;&#x5C06;json&#x5B57;&#x7B26;&#x4E32;&#x8F6C;&#x6362;&#x6210;&#x4E00;&#x4E2A;JavaBean.</p><p><strong>2. Android Code Generator</strong><br>&#x6839;&#x636E;&#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x5FEB;&#x901F;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;Activity,Fragment,Adapter,Menu.</p><p><strong>3. Android Parcelable code generator</strong><br>JavaBean&#x5FEB;&#x901F;&#x5B9E;&#x73B0;Parcelable&#x63A5;&#x53E3;.</p><p><strong>4. Android Methods Count</strong><br>&#x663E;&#x793A;&#x4F9D;&#x8D56;&#x5E93;&#x7684;&#x65B9;&#x6CD5;&#x6570;.</p><a id="more"></a><p><strong>5. Lifecycle Sorter</strong><br>&#x636E;Activity&#x6216;&#x8005;fragment&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x5BF9;&#x5176;&#x751F;&#x547D;&#x5468;&#x671F;&#x65B9;&#x6CD5;&#x4F4D;&#x7F6E;&#x8FDB;&#x884C;&#x5148;&#x540E;&#x6392;&#x5E8F;.</p><p><strong>6. CodeGlance</strong><br>&#x53F3;&#x8FB9;&#x9884;&#x89C8;&#x4EE3;&#x7801;&#xFF0C;&#x5B9E;&#x73B0;&#x5FEB;&#x901F;&#x5B9A;&#x4F4D;.</p><p><strong>7. FindBugs-IDEA</strong><br>&#x4EE3;&#x7801;&#x5BA1;&#x67E5;&#x529F;&#x80FD;</p><p><strong>8. ADB WIFI</strong><br>&#x4F7F;&#x7528;wifi&#x65E0;&#x7EBF;&#x8C03;&#x8BD5;App</p><p><strong>9. JSONOnlineViewer</strong><br>Json&#x8BF7;&#x6C42;&#x63A5;&#x53E3;&#x8C03;&#x8BD5;</p><p><strong>10. Android Styler</strong><br>&#x6839;&#x636E;XML&#x81EA;&#x52A8;&#x751F;&#x6210;style&#x4EE3;&#x7801;</p><p><strong>11. Android Drawable Importer</strong><br>&#x975E;&#x5E38;&#x5F3A;&#x5927;&#x7684;&#x56FE;&#x7247;&#x5BFC;&#x5165;&#x63D2;&#x4EF6;&#xFF0C;&#x81EA;&#x52A8;&#x9002;&#x914D;&#x591A;&#x79CD;dpi</p><p><strong>12. SelectorChapek for Android</strong><br>&#x901A;&#x8FC7;res&#x6587;&#x4EF6;&#x547D;&#x540D;&#x81EA;&#x52A8;&#x751F;&#x6210;Selector&#x6587;&#x4EF6;</p><p><strong>13. Markdown support/Markdown Navigator</strong><br>&#x5B98;&#x65B9;&#x63D0;&#x4F9B;&#x7684;Markdown&#x652F;&#x6301;</p><p><strong>14. Android DPI Calculator</strong><br>&#x4E0D;&#x540C;dpi&#x76F8;&#x4E92;&#x8BA1;&#x7B97;</p><p><strong>15. Android Studio Prettify</strong><br>&#x81EA;&#x52A8;&#x751F;&#x6210;findViewById&#x4EE3;&#x7801;&#xFF0C;&#x5FEB;&#x901F;&#x62BD;&#x79BB;string resource</p><p><strong>16. Material Theme UI</strong><br>&#x6DFB;&#x52A0;&#x4F7F;&#x7528;Material&#x4E3B;&#x9898;</p><p><strong>17. PermissionsDispatcher plugin</strong><br>&#x81EA;&#x52A8;&#x751F;&#x6210;Android6.0&#x6743;&#x9650;&#x7684;&#x4EE3;&#x7801;</p><p><strong>18. Codota</strong><br>&#x641C;&#x7D22;&#x6700;&#x597D;&#x7684;Android&#x4EE3;&#x7801;</p><p><strong>19. Android Strings Search Plugin</strong><br>&#x901A;&#x8FC7;&#x8F93;&#x5165;&#x6587;&#x5B57;&#x67E5;&#x627E;&#x5BF9;&#x5E94;strings.xml&#x7684;id</p><p><strong>20. eventbus3-intellij-plugin</strong><br>&#x5FEB;&#x901F;&#x5BFB;&#x627E;EventBus 3.0 post/event &#x5BF9;&#x5E94;&#x5173;&#x7CFB;</p><p><strong>21. Exynap</strong><br>&#x5E2E;&#x52A9;&#x5F00;&#x53D1;&#x8005;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x6837;&#x677F;&#x4EE3;&#x7801;</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;整理使用Android Studio进行开发时所使用的插件，如发现更好用的插件会及时更新。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. GsonFormat&lt;/strong&gt;&lt;br&gt;快速将json字符串转换成一个JavaBean.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Android Code Generator&lt;/strong&gt;&lt;br&gt;根据布局文件快速生成对应的Activity,Fragment,Adapter,Menu.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Android Parcelable code generator&lt;/strong&gt;&lt;br&gt;JavaBean快速实现Parcelable接口.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. Android Methods Count&lt;/strong&gt;&lt;br&gt;显示依赖库的方法数.&lt;/p&gt;
    
    </summary>
    
      <category term="Android Studio" scheme="http://yoursite.com/categories/Android-Studio/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android自定义View和Drawable总结</title>
    <link href="http://yoursite.com/2016/09/13/android-custom-view-and-drawable/"/>
    <id>http://yoursite.com/2016/09/13/android-custom-view-and-drawable/</id>
    <published>2016-09-13T08:15:29.000Z</published>
    <updated>2016-09-13T08:21:09.000Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#android&#x81EA;&#x5B9A;&#x4E49;view&#x7B80;&#x8FF0;">Android&#x81EA;&#x5B9A;&#x4E49;View&#x7B80;&#x8FF0;</a><ul><li><a href="#&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;">&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;</a></li><li><a href="#onmeasure">onMeasure()</a></li><li><a href="#onlayout">onLayout()</a></li><li><a href="#ondraw">onDraw()</a></li><li><a href="#&#x4E00;&#x4E9B;tips">&#x4E00;&#x4E9B;Tips&#xFF1A;</a></li></ul></li><li><a href="#drawable&#x603B;&#x7ED3;">Drawable&#x603B;&#x7ED3;</a><ul><li><a href="#bitmapdrawable">BitmapDrawable</a></li><li><a href="#ninepatchdrawable">NinePatchDrawable</a></li><li><a href="#layerdrawable">LayerDrawable</a></li><li><a href="#statelistdrawable">StateListDrawable</a></li><li><a href="#transitiondrawable">TransitionDrawable</a></li><li><a href="#insertdrawable">InsertDrawable</a></li><li><a href="#clipdrawable">ClipDrawable</a></li></ul></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><h2 id="android&#x81EA;&#x5B9A;&#x4E49;view&#x7B80;&#x8FF0;"><a href="#Android&#x81EA;&#x5B9A;&#x4E49;View&#x7B80;&#x8FF0;" class="headerlink" title="Android&#x81EA;&#x5B9A;&#x4E49;View&#x7B80;&#x8FF0;"></a>Android&#x81EA;&#x5B9A;&#x4E49;View&#x7B80;&#x8FF0;</h2><p>Android&#x81EA;&#x5B9A;&#x4E49;View&#x65B9;&#x5F0F;&#x6709;&#x8BB8;&#x591A;&#xFF0C;&#x672C;&#x6587;&#x5BF9;&#x76F4;&#x63A5;&#x7EE7;&#x627F;View&#x7684;&#x65B9;&#x5F0F;&#x8FDB;&#x884C;&#x603B;&#x7ED3;&#xFF0C;&#x5EFA;&#x8BAE;&#x6DF1;&#x5165;&#x9605;&#x8BFB;&#x6E90;&#x7801;&#x4E86;&#x89E3;View&#x662F;&#x5982;&#x4F55;&#x8FDB;&#x884C;&#x7ED8;&#x5236;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x4ECE; <strong>ViewRootImpl#performTraversals()</strong> &#x65B9;&#x6CD5;&#x5F00;&#x59CB;&#xFF0C;&#x5E76;&#x4E14;&#x5EFA;&#x8BAE;&#x540C;&#x65F6;&#x7406;&#x89E3;View&#x7684;&#x4E8B;&#x4EF6;&#x4F20;&#x9012;&#x673A;&#x5236;&#x548C;&#x52A8;&#x753B;&#x673A;&#x5236;&#xFF0C;&#x8FD9;&#x6837;&#x624D;&#x80FD;&#x5B9E;&#x73B0;&#x975E;&#x5E38;&#x70AB;&#x4E3D;&#x7684;View&#xFF1B;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x8BA8;&#x8BBA;onMeasure()&#x3001;onLayout()&#x548C;onDraw()&#x8FDB;&#x884C;override&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;&#xFF0C;&#x4E0D;&#x4F1A;&#x8BA8;&#x8BBA;&#x589E;&#x52A0;&#x4EA4;&#x4E92;&#x548C;&#x52A8;&#x753B;&#x7B49;&#x4E8B;&#x5B9C;&#x3002;</p><h3 id="&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;"><a href="#&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;" class="headerlink" title="&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;"></a>&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;</h3><p><strong>1.</strong> &#x5EFA;&#x7ACB;<code>res/values/attrs.xml</code>&#xFF0C;demo&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">&quot;PieChart&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;showText&quot;</span> <span class="attr">format</span>=<span class="string">&quot;boolean&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">&quot;labelPosition&quot;</span> <span class="attr">format</span>=<span class="string">&quot;enum&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">enum</span> <span class="attr">name</span>=<span class="string">&quot;left&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">enum</span> <span class="attr">name</span>=<span class="string">&quot;right&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">attr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><strong>2.</strong> &#x5E03;&#x5C40;&#x6587;&#x4EF6;&#x4E2D;&#x4F7F;&#x7528;&#x81EA;&#x5B9A;&#x4E49;&#x5C5E;&#x6027;&#x65F6;&#xFF0C;Gradle&#x5EFA;&#x8BAE;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x7EDF;&#x4E00;&#x4F7F;&#x7528;<code>&quot;http://schemas.android.com/apk/res-auto&quot;</code><br><strong>3.</strong> &#x5B98;&#x65B9;&#x5EFA;&#x8BAE;&#x901A;&#x8FC7;<code>TypedArray</code>&#x5728;&#x7A0B;&#x5E8F;&#x4E2D;&#x8BFB;&#x53D6;&#x5B9A;&#x4E49;&#x7684;&#x5C5E;&#x6027;&#xFF0C;demo&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PieChart</span><span class="params">(Context context, AttributeSet attrs)</span> </span>{</span><br><span class="line">   <span class="keyword">super</span>(context, attrs);</span><br><span class="line">   TypedArray a = context.getTheme().obtainStyledAttributes(</span><br><span class="line">        attrs,</span><br><span class="line">        R.styleable.PieChart,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">try</span> {</span><br><span class="line">       mShowText = a.getBoolean(R.styleable.PieChart_showText, <span class="keyword">false</span>);</span><br><span class="line">       mTextPos = a.getInteger(R.styleable.PieChart_labelPosition, <span class="number">0</span>);</span><br><span class="line">   } <span class="keyword">finally</span> {</span><br><span class="line">       a.recycle();</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><a id="more"></a><h3 id="onmeasure"><a href="#onMeasure" class="headerlink" title="onMeasure()"></a>onMeasure()</h3><p>&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x7684;LinearLayout&#x7B49;ViewGroup&#x7EC4;&#x4EF6;&#x4F1A;&#x7EE7;&#x627F;&#x5E76;&#x91CD;&#x5199; <strong>View#onMeasure()</strong> &#x65B9;&#x6CD5;&#xFF0C;&#x4E3B;&#x8981;&#x4F5C;&#x7528;&#x662F;&#x904D;&#x5386;&#x6BCF;&#x4E2A;&#x5B50;View&#x5E76;&#x8C03;&#x7528;&#x5B50;View&#x7684; <strong>View#onMeasure()</strong> &#x65B9;&#x6CD5;&#x3002;&#x603B;&#x4E4B;&#xFF0C;&#x8BE5;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7684;&#x4F5C;&#x7528;&#x5C31;&#x662F;&#x5F97;&#x5230;View&#x6D4B;&#x91CF;&#x8FC7;&#x7684;width&#x548C;height&#xFF0C;&#x6240;&#x4EE5;override&#x65F6;&#x4E00;&#x5B9A;&#x8981;&#x8C03;&#x7528; <strong>View#setMeasuredDimension(int measuredWidth, int measuredHeight)</strong> &#x65B9;&#x6CD5;&#x8BBE;&#x7F6E;&#x5BBD;&#x9AD8;&#xFF0C;<strong>View#getMeasuredWidth()</strong> &#x548C; <strong>View#getMeasuredHeight()</strong> &#x5C31;&#x662F;&#x53D6;&#x5F97;&#x4E0A;&#x8FF0;&#x51FD;&#x6570;&#x8BBE;&#x7F6E;&#x7684;&#x5BBD;&#x5EA6;&#x548C;&#x9AD8;&#x5EA6;&#x3002;<strong>View#onMeasure()</strong> &#x51FD;&#x6570;&#x539F;&#x578B;&#x4EE5;&#x53CA;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">    setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),</span><br><span class="line">            getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>&#x5176;&#x53C2;&#x6570;&#x542B;&#x4E49;&#x53C2;&#x89C1;<code>View.MeasureSpec</code>&#x7C7B;&#xFF0C;&#x5176;&#x9AD8;2&#x4F4D;&#x8868;&#x793A;SpecMode&#xFF0C;&#x4F4E;30&#x4F4D;&#x8868;&#x793A;SpecSize&#xFF0C;&#x524D;&#x8005;&#x8868;&#x793A;&#x6D4B;&#x91CF;&#x6A21;&#x5F0F;&#xFF0C;&#x540E;&#x8005;&#x8868;&#x793A;&#x5176;&#x89C4;&#x683C;&#x5927;&#x5C0F;&#x3002;&#x5176;&#x4E2D;SpecMode&#x5B9A;&#x4E49;&#x4E09;&#x79CD;&#x53D6;&#x503C;&#xFF1A;</p><table><thead><tr><th style="text-align:left">Mode</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><code>AT_MOST</code></td><td style="text-align:left">&#x7236;&#x5BB9;&#x5668;&#x6307;&#x5B9A;&#x53EF;&#x7528;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x5177;&#x4F53;View&#x5BF9;&#x5176;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#xFF0C;&#x901A;&#x5E38;&#x5BF9;&#x5E94;LayoutParams&#x4E2D;&#x7684;wrap_content</td></tr><tr><td style="text-align:left"><code>EXACTLY</code></td><td style="text-align:left">&#x7236;&#x5BB9;&#x5668;&#x6307;&#x5B9A;&#x8BE5;View&#x6D4B;&#x91CF;&#x7684;&#x7CBE;&#x786E;&#x503C;&#xFF0C;&#x5C31;&#x662F;SpecSize&#xFF0C;&#x901A;&#x5E38;&#x5BF9;&#x5E94;LayoutParams&#x4E2D;&#x7684;match_parent&#x548C;&#x5177;&#x4F53;&#x6570;&#x503C;</td></tr><tr><td style="text-align:left"><code>UNSPECIFIED</code></td><td style="text-align:left">&#x7236;&#x5BB9;&#x5668;&#x6CA1;&#x6709;&#x9650;&#x5236;&#xFF0C;&#x901A;&#x5E38;&#x7CFB;&#x7EDF;&#x5185;&#x90E8;&#x4F7F;&#x7528;</td></tr></tbody></table><p>&#x6574;&#x4E2A;measure&#x8FC7;&#x7A0B;&#x4ECE;&#x9876;&#x5C42;View(DecorView)&#x5F00;&#x59CB;&#xFF0C;&#x5176;&#x957F;&#x5EA6;&#x548C;&#x9AD8;&#x5EA6;&#x7684;MeasureSpec&#x751F;&#x6210;&#x53C2;&#x8003; <strong>ViewRootImp#getRootMeasureSpec()</strong>&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Figures out the measure spec for the root view in a window based on it&apos;s</span></span><br><span class="line"><span class="comment"> * layout params.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> windowSize</span></span><br><span class="line"><span class="comment"> *            The available width or height of the window</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rootDimension</span></span><br><span class="line"><span class="comment"> *            The layout params for one dimension (width or height) of the</span></span><br><span class="line"><span class="comment"> *            window.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The measure spec to use to measure the root view.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getRootMeasureSpec</span><span class="params">(<span class="keyword">int</span> windowSize, <span class="keyword">int</span> rootDimension)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> measureSpec;</span><br><span class="line">    <span class="keyword">switch</span> (rootDimension) {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> ViewGroup.LayoutParams.MATCH_PARENT:</span><br><span class="line">        <span class="comment">// Window can&apos;t resize. Force root view to be windowSize.</span></span><br><span class="line">        measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.EXACTLY);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ViewGroup.LayoutParams.WRAP_CONTENT:</span><br><span class="line">        <span class="comment">// Window can resize. Set max size for root view.</span></span><br><span class="line">        measureSpec = MeasureSpec.makeMeasureSpec(windowSize, MeasureSpec.AT_MOST);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">// Window wants to be an exact size. Force root view to be that size.</span></span><br><span class="line">        measureSpec = MeasureSpec.makeMeasureSpec(rootDimension, MeasureSpec.EXACTLY);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> measureSpec;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>&#x7136;&#x540E;&#x8FDB;&#x884C;DecorView&#x7684;measure&#xFF0C;DecorView&#x672C;&#x8D28;&#x662F;FrameLayout&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5173;&#x6CE8; <strong>ViewGroup#onMeasure()</strong>&#x3002;&#x4E0D;&#x540C;&#x7684;Layout&#x5BF9;onMeasure()&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#xFF0C;&#x4F46;&#x90FD;&#x4F1A;&#x904D;&#x5386;&#x5176;&#x5B50;View&#x8C03;&#x7528;measure()&#x65B9;&#x6CD5;&#xFF0C;&#x6700;&#x7EC8;&#x6267;&#x884C;&#x81F3; <strong>View#onMeasure()</strong>&#xFF1B;&#x4EE5;FrameLayout&#x4E3A;&#x4F8B;&#xFF0C;&#x770B; <strong>View#onMeasure()</strong> &#x7684;&#x53C2;&#x6570;&#x662F;&#x5982;&#x4F55;&#x751F;&#x6210;&#x7684;&#x3002;&#x5176;&#x5173;&#x952E;&#x4EE3;&#x7801;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FrameLayout</span></span>{</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">            <span class="keyword">final</span> View child = mMatchParentChildren.get(i);</span><br><span class="line">            <span class="keyword">final</span> MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> childWidthMeasureSpec;</span><br><span class="line">            <span class="keyword">if</span> (lp.width == LayoutParams.MATCH_PARENT) {</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> width = Math.max(<span class="number">0</span>, getMeasuredWidth()</span><br><span class="line">                        - getPaddingLeftWithForeground() - getPaddingRightWithForeground()</span><br><span class="line">                        - lp.leftMargin - lp.rightMargin);</span><br><span class="line">                childWidthMeasureSpec = MeasureSpec.makeMeasureSpec(</span><br><span class="line">                        width, MeasureSpec.EXACTLY);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                childWidthMeasureSpec = getChildMeasureSpec(widthMeasureSpec,</span><br><span class="line">                        getPaddingLeftWithForeground() + getPaddingRightWithForeground() +</span><br><span class="line">                        lp.leftMargin + lp.rightMargin,</span><br><span class="line">                        lp.width);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> childHeightMeasureSpec;</span><br><span class="line">            <span class="keyword">if</span> (lp.height == LayoutParams.MATCH_PARENT) {</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> height = Math.max(<span class="number">0</span>, getMeasuredHeight()</span><br><span class="line">                        - getPaddingTopWithForeground() - getPaddingBottomWithForeground()</span><br><span class="line">                        - lp.topMargin - lp.bottomMargin);</span><br><span class="line">                childHeightMeasureSpec = MeasureSpec.makeMeasureSpec(</span><br><span class="line">                        height, MeasureSpec.EXACTLY);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,</span><br><span class="line">                        getPaddingTopWithForeground() + getPaddingBottomWithForeground() +</span><br><span class="line">                        lp.topMargin + lp.bottomMargin,</span><br><span class="line">                        lp.height);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br><span class="line">        }</span><br><span class="line">        ...</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewGroup</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getChildMeasureSpec</span><span class="params">(<span class="keyword">int</span> spec, <span class="keyword">int</span> padding, <span class="keyword">int</span> childDimension)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> specMode = MeasureSpec.getMode(spec);</span><br><span class="line">        <span class="keyword">int</span> specSize = MeasureSpec.getSize(spec);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> size = Math.max(<span class="number">0</span>, specSize - padding);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> resultSize = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> resultMode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (specMode) {</span><br><span class="line">            <span class="comment">// Parent has imposed an exact size on us</span></span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">                <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) {</span><br><span class="line">                    resultSize = childDimension;</span><br><span class="line">                    resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class="line">                    <span class="comment">// Child wants to be our size. So be it.</span></span><br><span class="line">                    resultSize = size;</span><br><span class="line">                    resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class="line">                    <span class="comment">// Child wants to determine its own size. It can&apos;t be</span></span><br><span class="line">                    <span class="comment">// bigger than us.</span></span><br><span class="line">                    resultSize = size;</span><br><span class="line">                    resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Parent has imposed a maximum size on us</span></span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">                <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) {</span><br><span class="line">                    <span class="comment">// Child wants a specific size... so be it</span></span><br><span class="line">                    resultSize = childDimension;</span><br><span class="line">                    resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class="line">                    <span class="comment">// Child wants to be our size, but our size is not fixed.</span></span><br><span class="line">                    <span class="comment">// Constrain child to not be bigger than us.</span></span><br><span class="line">                    resultSize = size;</span><br><span class="line">                    resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class="line">                    <span class="comment">// Child wants to determine its own size. It can&apos;t be</span></span><br><span class="line">                    <span class="comment">// bigger than us.</span></span><br><span class="line">                    resultSize = size;</span><br><span class="line">                    resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Parent asked to see how big we want to be</span></span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">                <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) {</span><br><span class="line">                    <span class="comment">// Child wants a specific size... let him have it</span></span><br><span class="line">                    resultSize = childDimension;</span><br><span class="line">                    resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) {</span><br><span class="line">                    <span class="comment">// Child wants to be our size... find out how big it should</span></span><br><span class="line">                    <span class="comment">// be</span></span><br><span class="line">                    resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="number">0</span> : size;</span><br><span class="line">                    resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) {</span><br><span class="line">                    <span class="comment">// Child wants to determine its own size.... find out how</span></span><br><span class="line">                    <span class="comment">// big it should be</span></span><br><span class="line">                    resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="number">0</span> : size;</span><br><span class="line">                    resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>&#x901A;&#x8FC7;&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x5F97;&#x51FA;&#x7ED3;&#x8BBA; <strong>View#onMeasure()</strong> &#x53C2;&#x6570;&#x4E0E; <strong>&#x7236;&#x5BB9;&#x5668;&#x7684;MeasureSpec</strong> &#x548C; <strong>&#x81EA;&#x8EAB;&#x7684;LayoutParams</strong> &#x90FD;&#x6709;&#x5173;&#x7CFB;&#x3002;&#x6700;&#x540E;&#x770B;&#x4E00;&#x4E0B; <strong>View#onMeasure()</strong> &#x7684;&#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#xFF0C;&#x4EE5;width&#x4E3A;&#x4F8B;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">View</span></span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>{</span><br><span class="line">        setMeasuredDimension(getDefaultSize(getSuggestedMinimumWidth(), widthMeasureSpec),</span><br><span class="line">                getDefaultSize(getSuggestedMinimumHeight(), heightMeasureSpec));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getDefaultSize</span><span class="params">(<span class="keyword">int</span> size, <span class="keyword">int</span> measureSpec)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> result = size;</span><br><span class="line">        <span class="keyword">int</span> specMode = MeasureSpec.getMode(measureSpec);</span><br><span class="line">        <span class="keyword">int</span> specSize = MeasureSpec.getSize(measureSpec);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (specMode) {</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">                result = size;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">            <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">                result = specSize;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getSuggestedMinimumWidth</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> (mBackground == <span class="keyword">null</span>) ? mMinWidth : max(mMinWidth, mBackground.getMinimumWidth());</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Drawable:</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMinimumWidth</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> intrinsicWidth = getIntrinsicWidth();</span><br><span class="line">    <span class="keyword">return</span> intrinsicWidth &gt; <span class="number">0</span> ? intrinsicWidth : <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p>&#x5176;&#x4E2D; mMinWidth &#x5BF9;&#x5E94;<code>android:miandroid:minWidth</code>&#xFF0C;&#x6709;&#x4E9B;Drawable(&#x6BD4;&#x5982;BitmapDrawable)&#x662F;&#x6709;&#x539F;&#x59CB;&#x957F;&#x5EA6;&#x7684;&#xFF0C;&#x6709;&#x4E9B;(&#x6BD4;&#x5982;ShapeDrawable)&#x6CA1;&#x6709;&#x3002;<strong>View#onMeasure()</strong> &#x9ED8;&#x8BA4;&#x5B9E;&#x73B0;&#x5E76;&#x6CA1;&#x6709;&#x533A;&#x5206;LayoutParams&#x4E2D;match_parent&#x548C;wrap_content&#xFF0C;&#x81EA;&#x5B9A;&#x4E49;View&#x65F6;&#x5EFA;&#x8BAE;&#x5B9E;&#x73B0;&#x3002;&#x4E3A;&#x5B8C;&#x6574;&#x5B9E;&#x73B0;View&#x7684;&#x6D4B;&#x91CF;&#x8FC7;&#x7A0B;&#xFF0C;&#x52A1;&#x5FC5; <strong>View#onMeasure()</strong> &#x4E2D;&#x4E00;&#x5B9A;&#x8981;&#x6267;&#x884C;<strong> View#setMeasuredDimension(int measuredWidth, int measuredHeight)</strong> &#x65B9;&#x6CD5;&#x3002;<strong>ViewGroup#onMeasure()</strong> &#x5B9E;&#x73B0;&#x65F6;&#x9700;&#x8981;&#x5148;&#x5BF9;&#x5B50;View&#x904D;&#x5386;&#x8FDB;&#x884C;&#x6D4B;&#x91CF;&#xFF0C;&#x6700;&#x540E;&#x8BBE;&#x7F6E;ViewGroup&#x7684;measuredWidth&#x548C;measuredHeight&#xFF0C;&#x5EFA;&#x8BAE;&#x9605;&#x8BFB;FrameLayout&#x6E90;&#x7801;&#x8FDB;&#x884C;&#x7406;&#x89E3;&#x3002;</p><h3 id="onlayout"><a href="#onLayout" class="headerlink" title="onLayout()"></a>onLayout()</h3><p>View&#x5B8C;&#x6210;&#x6D4B;&#x91CF;&#x540E;&#xFF0C;&#x6839;&#x636E; <strong>View#getMeasuredWidth()</strong> &#x548C; <strong>View#getMeasuredHeight()</strong> &#x5F97;&#x5230;View&#x6D4B;&#x91CF;&#x7684;&#x9AD8;&#x5EA6;&#x548C;&#x5BBD;&#x5EA6;&#xFF0C;&#x7136;&#x540E;&#x786E;&#x5B9A;View&#x5E03;&#x5C40;&#x5728;Window&#x4E2D;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x5373;&#x786E;&#x5B9A;mLeft&#xFF0C;mRight&#xFF0C;mTop&#x548C;mBottom&#x503C;&#x3002;&#x51FD;&#x6570;&#x539F;&#x578B;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>{}</span><br></pre></td></tr></table></figure></p><p>&#x901A;&#x5E38;View&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x5B9E;&#x73B0;&#xFF0C;ViewGroup&#x4F1A;&#x5B9E;&#x73B0;&#x8BE5;&#x65B9;&#x6CD5;&#xFF0C;&#x6839;&#x636E;&#x5E03;&#x5C40;&#x7279;&#x6027;&#x8BA1;&#x7B97;&#x6BCF;&#x4E2A;&#x5B50;View&#x4E0A;&#x8FF0;&#x56DB;&#x4E2A;&#x503C;&#xFF0C;&#x8C03;&#x7528; <strong>View#setFrame(int left, int top, int right, int bottom)</strong> &#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x3002;View&#x5E03;&#x5C40;&#x5B8C;&#x6210;&#x540E;&#x624D;&#x53EF;&#x4EE5;&#x8C03;&#x7528; <strong>View#getWidth()</strong> &#x548C; <strong>View#getHeight()</strong> &#x65B9;&#x6CD5;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the width of the your view.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The width of your view, in pixels.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ViewDebug</span>.ExportedProperty(category = <span class="string">&quot;layout&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getWidth</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> mRight - mLeft;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the height of your view.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The height of your view, in pixels.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ViewDebug</span>.ExportedProperty(category = <span class="string">&quot;layout&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> mBottom - mTop;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></p><p><strong> Tips: </strong><br>Activity&#x5728;onResume()&#x65B9;&#x6CD5;&#x6267;&#x884C;&#x540E;&#x624D;&#x4F1A;&#x6267;&#x884C; <strong>ViewRootImpl#performTraversals()</strong> &#xFF0C;&#x6240;&#x4EE5;&#x83B7;&#x5F97;View&#x7684;&#x957F;&#x5EA6;&#x548C;&#x5BBD;&#x5EA6;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528; <strong>View#post()</strong>&#xFF0C;&#x76F8;&#x6BD4;ViewTreeObserver&#x7B80;&#x5355;&#x6027;&#x80FD;&#x597D;&#x3002;demo&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">view.post(<span class="keyword">new</span> Runnable() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> width = view.getMeasuredWidth()</span><br><span class="line">        <span class="keyword">int</span> height = view.getMeasuredHeight();</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></table></figure></p><h3 id="ondraw"><a href="#onDraw" class="headerlink" title="onDraw()"></a>onDraw()</h3><p><strong>View#draw()</strong> &#x65B9;&#x6CD5;&#x660E;&#x786E;&#x4E86;View&#x7ED8;&#x5236;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. Draw the background</span><br><span class="line">2. If necessary, save the canvas&apos; layers to prepare for fading</span><br><span class="line">3. Draw view&apos;s content</span><br><span class="line">4. Draw children</span><br><span class="line">5. If necessary, draw the fading edges and restore layers</span><br><span class="line">6. Draw decorations (scrollbars for instance)</span><br></pre></td></tr></table></figure><p><strong>View#onDraw()</strong> &#x5C5E;&#x4E8E;&#x7B2C;&#x4E09;&#x6B65;&#xFF0C;&#x6CE8;&#x610F;padding&#x5C5E;&#x6027;&#x5B9E;&#x73B0;&#xFF0C;&#x5176;&#x51FD;&#x6570;&#x539F;&#x578B;&#xFF1A;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implement this to do your drawing.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> canvas the canvas on which the background will be drawn</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>{}</span><br></pre></td></tr></table></figure><h3 id="&#x4E00;&#x4E9B;tips"><a href="#&#x4E00;&#x4E9B;Tips&#xFF1A;" class="headerlink" title="&#x4E00;&#x4E9B;Tips&#xFF1A;"></a>&#x4E00;&#x4E9B;Tips&#xFF1A;</h3><ol><li><strong>View#post()</strong> &#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x66FF;&#x4EE3;Handler</li><li><strong>View#onAttachedToWindow()</strong> &#x548C; <strong>View#onDetachedFromWindow()</strong> &#x6CE8;&#x610F;&#x8D44;&#x6E90;&#x7684;&#x56DE;&#x6536;&#xFF0C;&#x6BD4;&#x5982;&#x52A8;&#x753B;&#x6216;&#x7EBF;&#x7A0B;&#x3002;</li><li><strong>View#onDraw()</strong> &#x4E2D;&#x4E0D;&#x8981;&#x6709;&#x5BF9;&#x8C61;&#x7684;&#x5206;&#x914D;&#x7B49;&#x5BB9;&#x6613;&#x5F15;&#x8D77;&#x5783;&#x573E;&#x56DE;&#x6536;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x6CE8;&#x610F;invalidate()&#x548C;requestLayout()&#x8C03;&#x7528;&#x6B21;&#x6570;&#x3002;</li></ol><h2 id="drawable&#x603B;&#x7ED3;"><a href="#Drawable&#x603B;&#x7ED3;" class="headerlink" title="Drawable&#x603B;&#x7ED3;"></a>Drawable&#x603B;&#x7ED3;</h2><p>Drawable&#x8868;&#x793A;&#x4E00;&#x79CD;&#x53EF;&#x4EE5;&#x753B;&#x5728;&#x5C4F;&#x5E55;&#x4E0A;&#x7684;&#x62BD;&#x8C61;&#x6982;&#x5FF5;&#xFF0C;&#x4E00;&#x822C;&#x901A;&#x8FC7;XML&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EE3;&#x7801;&#x521B;&#x5EFA;&#x5177;&#x4F53;&#x7684;Drawable&#x5BF9;&#x8C61;&#xFF1B;Drawable&#x662F;&#x62BD;&#x8C61;&#x7C7B;&#xFF0C;&#x6BCF;&#x4E2A;&#x5177;&#x4F53;&#x7684;Drawable&#x90FD;&#x662F;&#x5176;&#x5B50;&#x7C7B;&#xFF1B;&#x6709;&#x4E9B;Drawable&#x4F1A;&#x6709;&#x5185;&#x90E8;&#x5BBD;/&#x9AD8;(<strong>Drawable#getIntrinsicWidth()</strong> &#x548C;<strong>Drawable#getIntrinsicHeight()</strong>)&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x5F20;&#x56FE;&#x7247;&#x3002;&#x4EE5;&#x4E0B;&#x5BF9;&#x5E38;&#x89C1;Drawable&#x8FDB;&#x884C;&#x4ECB;&#x7ECD;&#xFF1A;</p><h3 id="bitmapdrawable"><a href="#BitmapDrawable" class="headerlink" title="BitmapDrawable"></a>BitmapDrawable</h3><p>&#x4F4D;&#x56FE;&#x652F;&#x6301;&#x4E09;&#x79CD;&#x683C;&#x5F0F;&#xFF1A;.png&#xFF0C;.jpg&#xFF0C;.gif&#xFF0C;&#x63A8;&#x8350;.png&#x683C;&#x5F0F;&#x3002;&#x5B58;&#x5728;res/drawable/&#x8DEF;&#x5F84;&#x4E0B;&#xFF0C;APK&#x6784;&#x5EFA;&#x671F;&#x95F4;&#x4F1A;&#x5BF9;&#x8BE5;&#x8DEF;&#x5F84;&#x4E0B;&#x7684;&#x4F4D;&#x56FE;&#x8FDB;&#x884C;&#x538B;&#x7F29;&#xFF0C;&#x6240;&#x4EE5;&#x5982;&#x679C;&#x9700;&#x8981;&#x8BFB;&#x4F4D;&#x56FE;&#x7684;bit stream&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x628A;&#x4F4D;&#x56FE;&#x5B58;&#x4E8E;res/raw/&#x8DEF;&#x5F84;&#x4E0B;&#x3002;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.png (.png, .jpg, or .gif)</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br></pre></td></tr></table></figure></p><p>&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;XML&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#xFF0C;&#x597D;&#x5904;&#x662F;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x989D;&#x5916;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x8BED;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bitmap</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:src</span>=<span class="string">&quot;@[package:]drawable/drawable_resource&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:antialias</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">    <span class="attr">android:dither</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">    <span class="attr">android:filter</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">    <span class="attr">android:gravity</span>=<span class="string">[</span>&quot;<span class="attr">top</span>&quot;|&quot;<span class="attr">bottom</span>&quot;|&quot;<span class="attr">left</span>&quot;|&quot;<span class="attr">right</span>&quot;|&quot;<span class="attr">center_vertical</span>&quot;|</span></span><br><span class="line"><span class="tag">                    &quot;<span class="attr">fill_vertical</span>&quot;|&quot;<span class="attr">center_horizontal</span>&quot;|&quot;<span class="attr">fill_horizontal</span>&quot;|</span></span><br><span class="line"><span class="tag">                    &quot;<span class="attr">center</span>&quot;|&quot;<span class="attr">fill</span>&quot;|&quot;<span class="attr">clip_vertical</span>&quot;|&quot;<span class="attr">clip_horizontal</span>&quot;]</span></span><br><span class="line"><span class="tag">    <span class="attr">android:mipMap</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">    <span class="attr">android:tileMode</span>=<span class="string">[</span>&quot;<span class="attr">disabled</span>&quot;|&quot;<span class="attr">clamp</span>&quot;|&quot;<span class="attr">repeat</span>&quot;|&quot;<span class="attr">mirror</span>&quot;] /&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="ninepatchdrawable"><a href="#NinePatchDrawable" class="headerlink" title="NinePatchDrawable"></a>NinePatchDrawable</h3><p>.9&#x56FE;&#x5BF9;&#x5E94;&#x7684;Drawable&#x5B50;&#x7C7B;&#xFF0C;&#x6587;&#x4EF6;&#x4F4D;&#x4E8E;res/drawable/&#x4E0B;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;:</span><br><span class="line">    res/drawable/filename.9.png</span><br><span class="line">&#x8D44;&#x6E90;&#x4F7F;&#x7528;:</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br></pre></td></tr></table></figure></p><p>&#x540C;&#x6837;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;XML&#x8FDB;&#x884C;&#x5B9A;&#x4E49;&#xFF0C;&#x8BED;&#x6CD5;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nine-patch</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:src</span>=<span class="string">&quot;@[package:]drawable/drawable_resource&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:dither</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;] /&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="layerdrawable"><a href="#LayerDrawable" class="headerlink" title="LayerDrawable"></a>LayerDrawable</h3><p>&#x8868;&#x793A;&#x4E00;&#x79CD;&#x5C42;&#x6B21;&#x5316;&#x7684;Drawable&#x96C6;&#x5408;&#xFF0C;&#x4E0B;&#x5C42;Item&#x4F1A;&#x8986;&#x76D6;&#x4E0A;&#x5C42;Item&#xFF0C;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">layer-list</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawable</span>=<span class="string">&quot;@[package:]drawable/drawable_resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@[+][package:]id/resource_name&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:top</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:right</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:bottom</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:left</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>&#x4E3A;&#x4E86;&#x9632;&#x6B62;Item&#x9ED8;&#x8BA4;scale&#x81F3;&#x7236;&#x5BB9;&#x5668;&#xFF0C;&#x901A;&#x5E38;<code>&lt;Item&gt;</code>&#x4E2D;&#x5D4C;&#x5957;<code>&lt;bitmap&gt;</code>&#x6807;&#x7B7E;&#x8FBE;&#x5230;&#x60F3;&#x8981;&#x7684;&#x5C42;&#x6B21;&#x6548;&#x679C;&#xFF0C;demo&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layer-list</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">android:src</span>=<span class="string">&quot;@drawable/android_red&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:top</span>=<span class="string">&quot;10dp&quot;</span> <span class="attr">android:left</span>=<span class="string">&quot;10dp&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">android:src</span>=<span class="string">&quot;@drawable/android_green&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:top</span>=<span class="string">&quot;20dp&quot;</span> <span class="attr">android:left</span>=<span class="string">&quot;20dp&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">android:src</span>=<span class="string">&quot;@drawable/android_blue&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">&quot;center&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="statelistdrawable"><a href="#StateListDrawable" class="headerlink" title="StateListDrawable"></a>StateListDrawable</h3><p>&#x5BF9;&#x5E94;<code>&lt;selector&gt;</code>&#x6807;&#x7B7E;&#xFF0C;&#x8868;&#x793A;View&#x5404;&#x79CD;&#x72B6;&#x6001;&#x7684;Drawable&#x96C6;&#x5408;&#xFF0C;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:constantSize</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">        <span class="attr">android:dither</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">        <span class="attr">android:variablePadding</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;] &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawable</span>=<span class="string">&quot;@[package:]drawable/drawable_resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_pressed</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_focused</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_hovered</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_selected</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_checkable</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_checked</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_enabled</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_activated</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;]</span></span><br><span class="line"><span class="tag">            <span class="attr">android:state_window_focused</span>=<span class="string">[</span>&quot;<span class="attr">true</span>&quot;|&quot;<span class="attr">false</span>&quot;] /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure><p>&#x5176;&#x4E2D;&#xFF0C;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### LevelListDrawable</span><br><span class="line">Drawable&#x96C6;&#x5408;&#x4E2D;&#x6BCF;&#x4E2A;Drawable&#x90FD;&#x6709;Level&#xFF0C;Level&#x53D6;&#x503C;&#x4ECE;0&#x5230;10000&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;Drawable#setLevel()&#x548C;ImageView#setImageLevel()&#x6539;&#x53D8;Level&#xFF0C;&#x4ECE;&#x800C;&#x6539;&#x53D8;&#x5BF9;&#x5E94;&#x7684;Drawable&#xFF0C;&#x5339;&#x914D;&#x89C4;&#x5219;&#x662F;&#x4ECE;&#x4E0A;&#x5230;&#x4E0B;&#x5BFB;&#x627E;&#x7B2C;&#x4E00;&#x4E2A;&#x4F7F;&#x5F97;Level&#x5904;&#x4E8E;minLevel&#x548C;maxLevel&#x4E4B;&#x4E2D;&#x7684;Item&#x3002;</span><br><span class="line">``` xml</span><br><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">    &lt;level-list</span><br><span class="line">        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; &gt;</span><br><span class="line">        &lt;item</span><br><span class="line">            android:drawable=&quot;@drawable/drawable_resource&quot;</span><br><span class="line">            android:maxLevel=&quot;integer&quot;</span><br><span class="line">            android:minLevel=&quot;integer&quot; /&gt;</span><br><span class="line">    &lt;/level-list&gt;</span><br></pre></td></tr></table></figure></p><h3 id="transitiondrawable"><a href="#TransitionDrawable" class="headerlink" title="TransitionDrawable"></a>TransitionDrawable</h3><p>&#x5B9E;&#x73B0;&#x4E24;&#x4E2A;Drawable&#x4E4B;&#x95F4;&#x7684;&#x6DE1;&#x5165;&#x6DE1;&#x51FA;&#x6548;&#x679C;&#xFF0C;&#x5411;&#x524D;&#x542F;&#x52A8;&#x65F6;&#x8C03;&#x7528; <strong>Drawable#startTransition()</strong>&#xFF0C;&#x5411;&#x540E;&#x8C03;&#x7528; <strong>Drawable#reverseTransition()</strong>&#x3002;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transition</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:drawable</span>=<span class="string">&quot;@[package:]drawable/drawable_resource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@[+][package:]id/resource_name&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:top</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:right</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:bottom</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:left</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transition</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="insertdrawable"><a href="#InsertDrawable" class="headerlink" title="InsertDrawable"></a>InsertDrawable</h3><p>&#x7528;&#x4E8E;&#x5D4C;&#x5165;&#x5176;&#x4ED6;Drawable&#x5E76;&#x80FD;&#x7559;&#x51FA;&#x4E00;&#x5B9A;&#x95F4;&#x8DDD;&#x7684;&#x573A;&#x666F;&#x3002;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">inset</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/drawable_resource&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:insetTop</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:insetRight</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:insetBottom</span>=<span class="string">&quot;dimension&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:insetLeft</span>=<span class="string">&quot;dimension&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="clipdrawable"><a href="#ClipDrawable" class="headerlink" title="ClipDrawable"></a>ClipDrawable</h3><p>&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6839;&#x636E;Level&#x88C1;&#x526A;Drawable&#x800C;&#x751F;&#x6210;&#x7684;Drawable&#xFF0C;&#x901A;&#x5E38;&#x7528;&#x4E8E;&#x8FDB;&#x5EA6;&#x6761;&#x7684;&#x5B9E;&#x73B0;&#x3002;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">clip</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/drawable_resource&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:clipOrientation</span>=<span class="string">[</span>&quot;<span class="attr">horizontal</span>&quot;|&quot;<span class="attr">vertical</span>&quot;]</span></span><br><span class="line"><span class="tag">        <span class="attr">android:gravity</span>=<span class="string">[</span>&quot;<span class="attr">top</span>&quot;|&quot;<span class="attr">bottom</span>&quot;|&quot;<span class="attr">left</span>&quot;|&quot;<span class="attr">right</span>&quot;|&quot;<span class="attr">center_vertical</span>&quot;|</span></span><br><span class="line"><span class="tag">                        &quot;<span class="attr">fill_vertical</span>&quot;|&quot;<span class="attr">center_horizontal</span>&quot;|&quot;<span class="attr">fill_horizontal</span>&quot;|</span></span><br><span class="line"><span class="tag">                        &quot;<span class="attr">center</span>&quot;|&quot;<span class="attr">fill</span>&quot;|&quot;<span class="attr">clip_vertical</span>&quot;|&quot;<span class="attr">clip_horizontal</span>&quot;] /&gt;</span></span><br></pre></td></tr></table></figure></p><p>&#x9ED8;&#x8BA4;Level&#x4E3A;0&#xFF0C;&#x8868;&#x793A;&#x5168;&#x90E8;&#x88C1;&#x526A;&#xFF1B;level&#x6700;&#x5927;&#x503C;&#x4E3A;10000&#xFF0C;&#x8868;&#x793A;&#x4E0D;&#x88C1;&#x526A;&#x3002;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### ScaleDrawable</span><br><span class="line">&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x6839;&#x636E;Level&#x7F29;&#x653E;Drawable&#x800C;&#x751F;&#x6210;&#x7684;Drawable&#xFF0C;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</span><br><span class="line">``` xml</span><br><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">    &lt;scale</span><br><span class="line">        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">        android:drawable=&quot;@drawable/drawable_resource&quot;</span><br><span class="line">        android:scaleGravity=[&quot;top&quot;|&quot;bottom&quot;|&quot;left&quot;|&quot;right&quot;|&quot;center_vertical&quot;|</span><br><span class="line">                              &quot;fill_vertical&quot;|&quot;center_horizontal&quot;|&quot;fill_horizontal&quot;|</span><br><span class="line">                              &quot;center&quot;|&quot;fill&quot;|&quot;clip_vertical&quot;|&quot;clip_horizontal&quot;]</span><br><span class="line">        android:scaleHeight=&quot;percentage&quot;</span><br><span class="line">        android:scaleWidth=&quot;percentage&quot; /&gt;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### GradientDrawable</span><br><span class="line">&#x4F7F;&#x7528;XML&#x5B9A;&#x4E49;&#x7684;&#x901A;&#x7528;&#x56FE;&#x5F62;&#xFF0C;&#x4F7F;&#x7528;&#x5982;&#x4E0B;&#xFF1A;</span><br><span class="line">``` xml</span><br><span class="line">&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#xFF1A;</span><br><span class="line">    res/drawable/filename.xml</span><br><span class="line">&#x8D44;&#x6E90;&#x5F15;&#x7528;&#xFF1A;</span><br><span class="line">    In Java: R.drawable.filename</span><br><span class="line">    In XML: @[package:]drawable/filename</span><br><span class="line">&#x8BED;&#x6CD5;&#xFF1A;</span><br><span class="line">    &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">    &lt;shape</span><br><span class="line">        xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">        android:shape=[&quot;rectangle&quot;|&quot;oval&quot;|&quot;line&quot;|&quot;ring&quot;] &gt;</span><br><span class="line">        &lt;corners</span><br><span class="line">            android:radius=&quot;integer&quot;</span><br><span class="line">            android:topLeftRadius=&quot;integer&quot;</span><br><span class="line">            android:topRightRadius=&quot;integer&quot;</span><br><span class="line">            android:bottomLeftRadius=&quot;integer&quot;</span><br><span class="line">            android:bottomRightRadius=&quot;integer&quot; /&gt;</span><br><span class="line">        &lt;gradient</span><br><span class="line">            android:angle=&quot;integer&quot;</span><br><span class="line">            android:centerX=&quot;float&quot;</span><br><span class="line">            android:centerY=&quot;float&quot;</span><br><span class="line">            android:centerColor=&quot;integer&quot;</span><br><span class="line">            android:endColor=&quot;color&quot;</span><br><span class="line">            android:gradientRadius=&quot;integer&quot;</span><br><span class="line">            android:startColor=&quot;color&quot;</span><br><span class="line">            android:type=[&quot;linear&quot;|&quot;radial&quot;|&quot;sweep&quot;]</span><br><span class="line">            android:useLevel=[&quot;true&quot;|&quot;false&quot;] /&gt;</span><br><span class="line">        &lt;padding</span><br><span class="line">            android:left=&quot;integer&quot;</span><br><span class="line">            android:top=&quot;integer&quot;</span><br><span class="line">            android:right=&quot;integer&quot;</span><br><span class="line">            android:bottom=&quot;integer&quot; /&gt;</span><br><span class="line">        &lt;size</span><br><span class="line">            android:width=&quot;integer&quot;</span><br><span class="line">            android:height=&quot;integer&quot; /&gt;</span><br><span class="line">        &lt;solid</span><br><span class="line">            android:color=&quot;color&quot; /&gt;</span><br><span class="line">        &lt;stroke</span><br><span class="line">            android:width=&quot;integer&quot;</span><br><span class="line">            android:color=&quot;color&quot;</span><br><span class="line">            android:dashWidth=&quot;integer&quot;</span><br><span class="line">            android:dashGap=&quot;integer&quot; /&gt;</span><br><span class="line">    &lt;/shape&gt;</span><br></pre></td></tr></table></figure><p><strong>Tips:</strong>  </p><p><strong>1.</strong> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**2.** &#x4EE5;&#x4E0B;&#x5C5E;&#x6027;&#x4EC5;&#x5BF9;```android:shape=&quot;ring&quot;```&#x6709;&#x6548;&#xFF1A;</span><br><span class="line"></span><br><span class="line">|Attribute|Description|</span><br><span class="line">|:-|:-|</span><br><span class="line">|```android:innerRadius```|&#x5185;&#x534A;&#x5F84;|</span><br><span class="line">|```android:innerRadiusRatio```|&#x5185;&#x534A;&#x5F84;&#x6BD4;&#x7387;&#xFF0C;&#x6700;&#x7EC8;&#x503C;&#x4E3A;&#x73AF;&#x5BBD;&#x5EA6;/n&#xFF0C;&#x9ED8;&#x8BA4;n=9&#xFF1B;&#x53EF;&#x88AB;innerRadius&#x8986;&#x76D6;|</span><br><span class="line">|```android:thickness```|&#x73AF;&#x7684;&#x539A;&#x5EA6;|</span><br><span class="line">|```android:thicknessRatio```|&#x73AF;&#x539A;&#x5EA6;&#x6BD4;&#x7387;&#xFF0C;&#x6700;&#x7EC8;&#x503C;&#x4E3A;&#x73AF;&#x5BBD;&#x5EA6;/n&#xFF0C;&#x9ED8;&#x8BA4;n=3&#xFF1B;&#x53EF;&#x88AB;thickness&#x8986;&#x76D6;|</span><br><span class="line">|```android:useLevel```|true&#x8868;&#x793A;&#x7528;&#x4E8E;LevelListDrawable&#xFF0C;&#x901A;&#x5E38;&#x5E94;&#x8BE5;&#x662F;false|</span><br><span class="line"></span><br><span class="line">**3.** &#x6E10;&#x53D8;&#x8272;```&lt;gradient&gt;</span><br></pre></td></tr></table></figure></p><table><thead><tr><th style="text-align:left">Attribute</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><code>android:angle</code></td><td style="text-align:left">&#x6E10;&#x53D8;&#x89D2;&#x5EA6;&#xFF0C;0&#x8868;&#x793A;&#x4ECE;&#x5DE6;&#x5230;&#x53F3;&#xFF0C;90&#x8868;&#x793A;&#x4ECE;&#x4E0B;&#x5F80;&#x4E0A;&#xFF0C;&#x5FC5;&#x987B;&#x662F;45&#x500D;&#x6570;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;0</td></tr><tr><td style="text-align:left"><code>android:centerX</code></td><td style="text-align:left">&#x6E10;&#x53D8;&#x4E2D;&#x5FC3;X&#x5750;&#x6807;&#xFF0C;&#x53D6;&#x503C;[0-1]&#xFF0C;&#x9ED8;&#x8BA4;0.5</td></tr><tr><td style="text-align:left"><code>android:centerY</code></td><td style="text-align:left">&#x6E10;&#x53D8;&#x4E2D;&#x5FC3;Y&#x5750;&#x6807;&#xFF0C;&#x53D6;&#x503C;[0-1]&#xFF0C;&#x9ED8;&#x8BA4;0.5</td></tr><tr><td style="text-align:left"><code>android:startColor</code></td><td style="text-align:left">&#x6E10;&#x53D8;&#x5F00;&#x59CB;&#x989C;&#x8272;</td></tr><tr><td style="text-align:left"><code>android:endColor</code></td><td style="text-align:left">&#x6E10;&#x53D8;&#x7ED3;&#x675F;&#x989C;&#x8272;</td></tr><tr><td style="text-align:left"><code>android:centerColor</code></td><td style="text-align:left">&#x6E10;&#x53D8;&#x4E2D;&#x95F4;&#x989C;&#x8272;&#xFF0C;&#x53EF;&#x9009;</td></tr><tr><td style="text-align:left"><code>android:type</code></td><td style="text-align:left">&#x7C7B;&#x578B;&#xFF1A;linear&#xFF0C;radial&#xFF0C;sweep</td></tr><tr><td style="text-align:left"><code>android:gradientRadius</code></td><td style="text-align:left">&#x4EC5;&#x5BF9;type=radial&#x6709;&#x6548;&#xFF0C;&#x6E10;&#x53D8;&#x534A;&#x5F84;</td></tr><tr><td style="text-align:left"><code>android:useLevel</code></td><td style="text-align:left">true&#x8868;&#x793A;&#x7528;&#x4E8E;LevelListDrawable</td></tr></tbody></table><p><strong>4.</strong> <code>&lt;padding&gt;</code>&#x4E0D;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;&#xFF0C;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x751F;&#x6548;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;InsertDrawable&#x6216;&#x8005;LayerDrawable&#x5D4C;&#x5957;&#x5B9E;&#x73B0;&#x5BF9;&#x5E94;&#x6548;&#x679C;&#x3002;</p><p><strong>5.</strong> <code>&lt;size&gt;</code> &#x4E0E; <strong>Drawable#getIntrinsicWidth()</strong> &#x548C; <strong>Drawable#getIntrinsicHeight()</strong> &#x5BF9;&#x5E94;&#xFF1B;Drawable&#x5B9E;&#x9645;&#x5927;&#x5C0F;&#x901A;&#x8FC7; <strong>Drawable#getBounds()</strong> &#x83B7;&#x5F97;</p><p><strong>6.</strong> <code>&lt;solid&gt;</code> &#x8868;&#x793A;&#x586B;&#x5145;&#x7EAF;&#x8272;</p><p><strong>7.</strong> <code>&lt;stroke&gt;</code>  </p><table><thead><tr><th style="text-align:left">Attribute</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><code>android:width</code></td><td style="text-align:left">&#x7EBF;&#x5BBD;&#x5EA6;</td></tr><tr><td style="text-align:left"><code>android:color</code></td><td style="text-align:left">&#x7EBF;&#x989C;&#x8272;</td></tr><tr><td style="text-align:left"><code>android:dashGap</code></td><td style="text-align:left">&#x7EBF;&#x95F4;&#x9694;&#x957F;&#x5EA6;</td></tr><tr><td style="text-align:left"><code>android:dashWidth</code></td><td style="text-align:left">&#x5982;&#x679C;&#x5B58;&#x5728;&#x95F4;&#x9694;&#xFF0C;&#x95F4;&#x9694;&#x7EBF;&#x7684;&#x5BBD;&#x5EA6;</td></tr></tbody></table><h2 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h2><p>[1] <a href="https://developer.android.com/training/custom-views/create-view.html" target="_blank" rel="noopener">https://developer.android.com/training/custom-views/create-view.html</a><br>[2] <a href="https://developer.android.com/guide/topics/resources/drawable-resource.html" target="_blank" rel="noopener">https://developer.android.com/guide/topics/resources/drawable-resource.html</a><br>[3] &#x300A;Android&#x5F00;&#x53D1;&#x827A;&#x672F;&#x63A2;&#x7D22;&#x300B; &#x4EFB;&#x7389;&#x521A; &#x8457;</p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#android自定义view简述&quot;&gt;Android自定义View简述&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#自定义属性&quot;&gt;自定义属性&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#onmeasure&quot;&gt;onMeasure()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#onlayout&quot;&gt;onLayout()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#ondraw&quot;&gt;onDraw()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#一些tips&quot;&gt;一些Tips：&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#drawable总结&quot;&gt;Drawable总结&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#bitmapdrawable&quot;&gt;BitmapDrawable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#ninepatchdrawable&quot;&gt;NinePatchDrawable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#layerdrawable&quot;&gt;LayerDrawable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#statelistdrawable&quot;&gt;StateListDrawable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#transitiondrawable&quot;&gt;TransitionDrawable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#insertdrawable&quot;&gt;InsertDrawable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#clipdrawable&quot;&gt;ClipDrawable&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;h2 id=&quot;Android自定义View简述&quot;&gt;&lt;a href=&quot;#Android自定义View简述&quot; class=&quot;headerlink&quot; title=&quot;Android自定义View简述&quot;&gt;&lt;/a&gt;Android自定义View简述&lt;/h2&gt;&lt;p&gt;Android自定义View方式有许多，本文对直接继承View的方式进行总结，建议深入阅读源码了解View是如何进行绘制的，可以从 &lt;strong&gt;ViewRootImpl#performTraversals()&lt;/strong&gt; 方法开始，并且建议同时理解View的事件传递机制和动画机制，这样才能实现非常炫丽的View；我们主要讨论onMeasure()、onLayout()和onDraw()进行override的注意事项，不会讨论增加交互和动画等事宜。&lt;/p&gt;
&lt;h3 id=&quot;自定义属性&quot;&gt;&lt;a href=&quot;#自定义属性&quot; class=&quot;headerlink&quot; title=&quot;自定义属性&quot;&gt;&lt;/a&gt;自定义属性&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;1.&lt;/strong&gt; 建立&lt;code&gt;res/values/attrs.xml&lt;/code&gt;，demo如下：&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;resources&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;declare-styleable&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;PieChart&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;showText&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;boolean&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;attr&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;labelPosition&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;format&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;enum&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;left&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;right&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;value&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;attr&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;declare-styleable&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;resources&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.&lt;/strong&gt; 布局文件中使用自定义属性时，Gradle建议命名空间统一使用&lt;code&gt;&amp;quot;http://schemas.android.com/apk/res-auto&amp;quot;&lt;/code&gt;&lt;br&gt;&lt;strong&gt;3.&lt;/strong&gt; 官方建议通过&lt;code&gt;TypedArray&lt;/code&gt;在程序中读取定义的属性，demo如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;PieChart&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context, AttributeSet attrs)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(context, attrs);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   TypedArray a = context.getTheme().obtainStyledAttributes(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        attrs,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        R.styleable.PieChart,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       mShowText = a.getBoolean(R.styleable.PieChart_showText, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       mTextPos = a.getInteger(R.styleable.PieChart_labelPosition, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125; &lt;span class=&quot;keyword&quot;&gt;finally&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       a.recycle();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Andorid学习笔记" scheme="http://yoursite.com/categories/Andorid%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>Android 多线程使用总结</title>
    <link href="http://yoursite.com/2016/08/31/Android-multiThread-summary/"/>
    <id>http://yoursite.com/2016/08/31/Android-multiThread-summary/</id>
    <published>2016-08-31T12:23:25.000Z</published>
    <updated>2016-08-31T12:30:00.000Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#asynctask&#x7C7B;">AsyncTask&#x7C7B;</a></li><li><a href="#loaders&#x6846;&#x67B6;">Loaders&#x6846;&#x67B6;</a></li><li><a href="#handlerthread&#x7C7B;">HandlerThread&#x7C7B;</a></li><li><a href="#intentservice&#x7C7B;">IntentService&#x7C7B;</a></li><li><a href="#&#x7EBF;&#x7A0B;&#x6C60;threadpoolexecutor">&#x7EBF;&#x7A0B;&#x6C60;ThreadPoolExecutor</a></li><li><a href="#&#x53C2;&#x8003;">&#x53C2;&#x8003;</a></li></ul><!-- tocstop --><p>APK&#x542F;&#x52A8;&#x65F6;&#x4F1A;&#x6267;&#x884C;ActivityThread&#x4E2D;main()&#x65B9;&#x6CD5;&#xFF0C;&#x5176;&#x4E2D;&#x521B;&#x5EFA;ActivityThread&#x7684;&#x7EBF;&#x7A0B;&#x4F5C;&#x4E3A;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x7531;&#x4E8E;&#x8BE5;&#x7EBF;&#x7A0B;&#x4E3B;&#x8981;&#x4E0E;UI&#x4EA4;&#x4E92;&#x76F8;&#x5173;&#xFF0C;&#x6240;&#x4EE5;&#x79F0;&#x4E3A;UI&#x7EBF;&#x7A0B;&#xFF1B;UI&#x7EBF;&#x7A0B;&#x4E2D;&#x4E0D;&#x80FD;&#x6267;&#x884C;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#xFF0C;&#x5426;&#x5219;&#x5BB9;&#x6613;&#x5F15;&#x8D77;ANR&#xFF0C;&#x6240;&#x4EE5;Google&#x5EFA;&#x8BAE;&#x5F00;&#x542F;worker thread&#x6267;&#x884C;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;Handler&#x673A;&#x5236;&#x901A;&#x77E5;&#x4E3B;&#x7EBF;&#x7A0B;&#x5237;&#x65B0;UI&#x3002;&#x7CFB;&#x7EDF;&#x63D0;&#x4F9B;&#x4E09;&#x79CD;&#x65B9;&#x6CD5;&#xFF1A;</p><ol><li>Activity.runOnUiThread(Runnable)</li><li>View.post(Runnable)</li><li>View.postDelayed(Runnable,long)</li></ol><p>&#x4F7F;&#x5F97;worker thread&#x4E2D;&#x65B9;&#x4FBF;&#x7684;&#x5237;&#x65B0;View&#xFF0C;&#x4F46;&#x4E0A;&#x8FF0;&#x65B9;&#x6CD5;&#x4E0D;&#x4FBF;&#x4E8E;&#x7BA1;&#x7406;&#x3002;&#x9488;&#x5BF9;&#x8FD9;&#x79CD;&#x573A;&#x666F;&#xFF0C;&#x7CFB;&#x7EDF;&#x5BF9;Handler&#x673A;&#x5236;&#x8FDB;&#x884C;&#x4E00;&#x5B9A;&#x8F7B;&#x91CF;&#x7EA7;&#x5C01;&#x88C5;&#xFF0C;&#x65B9;&#x4FBF;worker thread&#x901A;&#x77E5;&#x4E3B;&#x7EBF;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x4E3B;&#x8981;&#x5206;&#x6790;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7C7B;&#xFF1A;</p><a id="more"></a><h3 id="asynctask&#x7C7B;"><a href="#AsyncTask&#x7C7B;" class="headerlink" title="AsyncTask&#x7C7B;"></a>AsyncTask&#x7C7B;</h3><p>AsyncTask&#x7C7B;&#x5BF9;Thread&#x548C;Handler&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x9002;&#x7528;&#x4E8E;&#x540E;&#x53F0;&#x6267;&#x884C;&#x77ED;&#x65F6;&#x95F4;&#x4EFB;&#x52A1;&#x5E76;&#x901A;&#x77E5;UI&#x7684;&#x573A;&#x666F;&#xFF0C;demo&#x5982;&#x4E0B;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadFilesTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">URL</span>, <span class="title">Integer</span>, <span class="title">Long</span>&gt; </span>{</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Long <span class="title">doInBackground</span><span class="params">(URL... urls)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> count = urls.length;</span><br><span class="line">        <span class="keyword">long</span> totalSize = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) {</span><br><span class="line">            totalSize += Downloader.downloadFile(urls[i]);</span><br><span class="line">            publishProgress((<span class="keyword">int</span>) ((i / (<span class="keyword">float</span>) count) * <span class="number">100</span>));</span><br><span class="line">            <span class="comment">// Escape early if cancel() is called</span></span><br><span class="line">            <span class="keyword">if</span> (isCancelled()) <span class="keyword">break</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> totalSize;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(Integer... progress)</span> </span>{</span><br><span class="line">        setProgressPercent(progress[<span class="number">0</span>]);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPostExecute</span><span class="params">(Long result)</span> </span>{</span><br><span class="line">        showDialog(<span class="string">&quot;Downloaded &quot;</span> + result + <span class="string">&quot; bytes&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> DownloadFilesTask().execute(url1, url2, url3);</span><br></pre></td></tr></table></figure></p><p><strong>Tips&#xFF1A;</strong><br><strong>1.</strong> AsyncTask&#x4E09;&#x4E2A;&#x6CDB;&#x578B;&#x53C2;&#x6570;Params&#xFF0C;Progress&#x548C;Result(&#x5982;&#x679C;&#x4E0D;&#x9700;&#x8981;&#x5219;&#x4F20;Void)&#xFF0C;&#x5176;&#x610F;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p><table><thead><tr><th style="text-align:left">&#x53C2;&#x6570;</th><th style="text-align:left">&#x610F;&#x4E49;</th></tr></thead><tbody><tr><td style="text-align:left">Params</td><td style="text-align:left">&#x542F;&#x52A8;AsyncTask&#x65F6;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#xFF0C;&#x4F20;&#x5165;doInBackground()</td></tr><tr><td style="text-align:left">Progress</td><td style="text-align:left">&#x6807;&#x8BC6;&#x540E;&#x53F0;&#x4EFB;&#x52A1;&#x8FDB;&#x5EA6;&#xFF0C;&#x901A;&#x5E38;&#x5728;doInBackground()&#x4E2D;&#x901A;&#x8FC7;&#x8C03;&#x7528;publishProgress()&#x65B9;&#x6CD5;&#x4F20;&#x9012;&#x7ED9;onProgressUpdate()</td></tr><tr><td style="text-align:left">Result</td><td style="text-align:left">doInBackground()&#x8FD4;&#x56DE;&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x4F20;&#x7ED9;onPostExecute()</td></tr></tbody></table><p><strong>2.</strong> AsyncTask&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x793A;&#x610F;&#x56FE;&#xFF1A;</p><p><img src="pic_0.png" alt=""></p><p><strong>3.</strong> &#x5EFA;&#x8BAE;&#x770B;&#x6E90;&#x7801;&#x7406;&#x89E3;&#x5176;&#x5B9E;&#x73B0;&#x539F;&#x7406;&#xFF0C;&#x4F7F;&#x7528;AsyncTask&#x9700;&#x8981;&#x9075;&#x5FAA;&#x4E0B;&#x5217;&#x89C4;&#x5219;&#xFF1A;<br>a. AsyncTask&#x7C7B;&#x5FC5;&#x987B;&#x5728;UI&#x7EBF;&#x7A0B;load&#xFF0C;Android4.3&#x540E;&#x7CFB;&#x7EDF;&#x81EA;&#x52A8;&#x63D0;&#x4F9B;&#x4FDD;&#x8BC1;<br>b. AsyncTask&#x5B9E;&#x4F8B;&#x5FC5;&#x987B;&#x5728;UI&#x7EBF;&#x7A0B;&#x521B;&#x5EFA;<br>c. execute(Params&#x2026;)&#x5FC5;&#x987B;&#x5728;UI&#x7EBF;&#x7A0B;&#x8C03;&#x7528;<br>d. &#x4E0D;&#x8981;&#x624B;&#x52A8;&#x8C03;&#x7528;onPreExecute()&#xFF0C;onPostExecute(Result)&#xFF0C;doInBackground(Params&#x2026;)&#x548C;onProgressUpdate(Progress&#x2026;)<br>e. AsyncTask&#x5B9E;&#x4F8B;&#x53EA;&#x80FD;&#x6267;&#x884C;&#x4E00;&#x6B21;  </p><p><strong>4.</strong> &#x4ECE;Andorid 3.0&#x8D77;&#xFF0C;AsyncTask&#x5B9E;&#x4F8B;&#x662F;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x7684;&#xFF1B;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x5E76;&#x53D1;&#x6267;&#x884C;&#xFF0C;&#x53EF;&#x4EE5;&#x8C03;&#x7528;&#x51FD;&#x6570;executeOnExecutor(java.util.concurrent.Executor, Object[])<br>&#x5E76;&#x4F20;&#x5165;&#x53C2;&#x6570;AsyncTask#THREAD_POOL_EXECUTOR&#xFF0C;THREAD_POOL_EXECUTOR&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CPU_COUNT = Runtime.getRuntime().availableProcessors();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CORE_POOL_SIZE = CPU_COUNT + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_POOL_SIZE = CPU_COUNT * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> KEEP_ALIVE = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadFactory sThreadFactory = <span class="keyword">new</span> ThreadFactory() {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicInteger mCount = <span class="keyword">new</span> AtomicInteger(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(Runnable r)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Thread(r, <span class="string">&quot;AsyncTask #&quot;</span> + mCount.getAndIncrement());</span><br><span class="line">    }</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BlockingQueue&lt;Runnable&gt; sPoolWorkQueue =</span><br><span class="line">        <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">128</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An {<span class="doctag">@link</span> Executor} that can be used to execute tasks in parallel.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Executor THREAD_POOL_EXECUTOR</span><br><span class="line">        = <span class="keyword">new</span> ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE,</span><br><span class="line">        TimeUnit.SECONDS, sPoolWorkQueue, sThreadFactory);</span><br></pre></td></tr></table></figure><p><strong>5.</strong> AsyncTask&#x672C;&#x8EAB;&#x8BBE;&#x8BA1;&#x5B58;&#x5728;&#x4E00;&#x4E9B;&#x95EE;&#x9898;&#xFF0C;&#x6BD4;&#x5982;&#x8BF4;&#xFF1A;&#x751F;&#x547D;&#x5468;&#x671F;&#x7684;&#x63A7;&#x5236;&#xFF0C;Configuration&#x53D8;&#x5316;&#x5BB9;&#x6613;&#x5F15;&#x8D77;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x7B49;&#xFF0C;&#x53C2;&#x8003;blog(<a href="#reference_1">[1]</a>)&#x5173;&#x4E8E;AsyncTask&#x548C;Loaders&#x7684;&#x5BF9;&#x6BD4;&#xFF0C;&#x5EFA;&#x8BAE;Activity/Fragment&#x4E2D;&#x4F7F;&#x7528;Loaders&#x6846;&#x67B6;&#x4EE3;&#x66FF;AsyncTask&#x3002;</p><h3 id="loaders&#x6846;&#x67B6;"><a href="#Loaders&#x6846;&#x67B6;" class="headerlink" title="Loaders&#x6846;&#x67B6;"></a>Loaders&#x6846;&#x67B6;</h3><p>&#x4E13;&#x95E8;&#x5728;Activity&#x548C;Fragment&#x4E2D;&#x5B9E;&#x73B0;&#x5F02;&#x6B65;&#x6570;&#x636E;&#x52A0;&#x8F7D;&#x529F;&#x80FD;&#xFF0C;&#x5185;&#x90E8;&#x5BF9;AsyncTask&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#xFF0C;&#x6709;&#x4EE5;&#x4E0B;&#x7279;&#x5F81;&#xFF1A;</p><ol><li>Activity/Fragment&#x5929;&#x7136;&#x652F;&#x6301;&#xFF1B; </li><li>&#x63D0;&#x4F9B;&#x5F02;&#x6B65;&#x52A0;&#x8F7D;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x6570;&#x636E;&#x6E90;&#x53D8;&#x5316;&#x65F6;&#x8FDB;&#x884C;&#x901A;&#x77E5;&#xFF1B;</li><li>Activity Configuration&#x53D8;&#x5316;&#x65F6;&#x4E0D;&#x9700;&#x8981;re-query&#x3002;</li></ol><p>Loaders&#x6846;&#x67B6;&#x4E3B;&#x8981;&#x6D89;&#x53CA;LoaderManager&#xFF0C;LoaderManager.LoaderCallbacks&#xFF0C;Loader&#xFF0C;AsyncTaskLoader&#x548C;CursorLoader&#x51E0;&#x4E2A;&#x7C7B;&#xFF0C;&#x5B98;&#x65B9;&#x53EA;&#x63D0;&#x4F9B;&#x5BF9;&#x6570;&#x636E;&#x6E90;&#x662F;Cursor&#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x4E49;Loader&#x5BF9;&#x4EFB;&#x610F;&#x6570;&#x636E;&#x6E90;&#x8FDB;&#x884C;&#x5C01;&#x88C5;&#x3002;&#x5177;&#x4F53;&#x7528;&#x6CD5;&#x53C2;&#x7167;<a href="#reference_2">[2]</a>&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5173;&#x6CE8;&#x4E3B;&#x8981;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x4EE5;&#x53CA;&#x81EA;&#x5B9A;&#x4E49;Loader&#x65F6;&#x9700;&#x8981;Override&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5E76;&#x7ED9;&#x51FA;&#x81EA;&#x5B9A;&#x4E49;Loader&#x6A21;&#x677F;&#xFF1B;&#x5EFA;&#x8BAE;&#x53C2;&#x7167;&#x6E90;&#x7801;&#x7406;&#x89E3;&#x3002;</p><p>Loaders&#x6846;&#x67B6;&#x5404;&#x4E2A;&#x7C7B;&#x7684;&#x5173;&#x7CFB;&#x4EE5;&#x53CA;&#x6D41;&#x7A0B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p><p><img src="pic_1.png" alt=""></p><p>&#x901A;&#x5E38;&#x81EA;&#x5B9A;&#x4E49;Loader&#x65F6;&#x9700;&#x8981;Override&#x4E0A;&#x8FF0;&#x9EC4;&#x8272;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x53C2;&#x8003;<a href="#reference_3">[3]</a>&#x7ED9;&#x51FA;&#x8BE6;&#x7EC6;&#x7684;&#x89E3;&#x91CA;&#xFF0C;&#x5E76;&#x603B;&#x7ED3;&#x81EA;&#x5B9A;&#x4E49;Loader&#x7684;&#x6A21;&#x677F;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleLoader</span> <span class="keyword">extends</span> <span class="title">AsyncTaskLoader</span>&lt;<span class="title">List</span>&lt;<span class="title">SampleItem</span>&gt;&gt; </span>{</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We hold a reference to the Loader&#x2019;s data here.</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;SampleItem&gt; mData;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SampleLoader</span><span class="params">(Context ctx)</span> </span>{</span><br><span class="line">    <span class="comment">// Loaders may be used across multiple Activitys (assuming they aren&apos;t</span></span><br><span class="line">    <span class="comment">// bound to the LoaderManager), so NEVER hold a reference to the context</span></span><br><span class="line">    <span class="comment">// directly. Doing so will cause you to leak an entire Activity&apos;s context.</span></span><br><span class="line">    <span class="comment">// The superclass constructor will store a reference to the Application</span></span><br><span class="line">    <span class="comment">// Context instead, and can be retrieved with a call to getContext().</span></span><br><span class="line">    <span class="keyword">super</span>(ctx);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/****************************************************/</span></span><br><span class="line">  <span class="comment">/** (1) A task that performs the asynchronous load **/</span></span><br><span class="line">  <span class="comment">/****************************************************/</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;SampleItem&gt; <span class="title">loadInBackground</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// This method is called on a background thread and should generate a</span></span><br><span class="line">    <span class="comment">// new set of data to be delivered back to the client.</span></span><br><span class="line">    List&lt;SampleItem&gt; data = <span class="keyword">new</span> ArrayList&lt;SampleItem&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Perform the query here and add the results to &apos;data&apos;.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/********************************************************/</span></span><br><span class="line">  <span class="comment">/** (2) Deliver the results to the registered listener **/</span></span><br><span class="line">  <span class="comment">/********************************************************/</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliverResult</span><span class="params">(List&lt;SampleItem&gt; data)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (isReset()) {</span><br><span class="line">      <span class="comment">// The Loader has been reset; ignore the result and invalidate the data.</span></span><br><span class="line">      releaseResources(data);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hold a reference to the old data so it doesn&apos;t get garbage collected.</span></span><br><span class="line">    <span class="comment">// We must protect it until the new data has been delivered.</span></span><br><span class="line">    List&lt;SampleItem&gt; oldData = mData;</span><br><span class="line">    mData = data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isStarted()) {</span><br><span class="line">      <span class="comment">// If the Loader is in a started state, deliver the results to the</span></span><br><span class="line">      <span class="comment">// client. The superclass method does this for us.</span></span><br><span class="line">      <span class="keyword">super</span>.deliverResult(data);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Invalidate the old data as we don&apos;t need it any more.</span></span><br><span class="line">    <span class="keyword">if</span> (oldData != <span class="keyword">null</span> &amp;&amp; oldData != data) {</span><br><span class="line">      releaseResources(oldData);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*********************************************************/</span></span><br><span class="line">  <span class="comment">/** (3) Implement the Loader&#x2019;s state-dependent behavior **/</span></span><br><span class="line">  <span class="comment">/*********************************************************/</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStartLoading</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (mData != <span class="keyword">null</span>) {</span><br><span class="line">      <span class="comment">// Deliver any previously loaded data immediately.</span></span><br><span class="line">      deliverResult(mData);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Begin monitoring the underlying data source.</span></span><br><span class="line">    <span class="keyword">if</span> (mObserver == <span class="keyword">null</span>) {</span><br><span class="line">      mObserver = <span class="keyword">new</span> SampleObserver();</span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> register the observer</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (takeContentChanged() || mData == <span class="keyword">null</span>) {</span><br><span class="line">      <span class="comment">// When the observer detects a change, it should call onContentChanged()</span></span><br><span class="line">      <span class="comment">// on the Loader, which will cause the next call to takeContentChanged()</span></span><br><span class="line">      <span class="comment">// to return true. If this is ever the case (or if the current data is</span></span><br><span class="line">      <span class="comment">// null), we force a new load.</span></span><br><span class="line">      forceLoad();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStopLoading</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// The Loader is in a stopped state, so we should attempt to cancel the </span></span><br><span class="line">    <span class="comment">// current load (if there is one).</span></span><br><span class="line">    cancelLoad();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Note that we leave the observer as is. Loaders in a stopped state</span></span><br><span class="line">    <span class="comment">// should still monitor the data source for changes so that the Loader</span></span><br><span class="line">    <span class="comment">// will know to force a new load if it is ever started again.</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onReset</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// Ensure the loader has been stopped.</span></span><br><span class="line">    onStopLoading();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// At this point we can release the resources associated with &apos;mData&apos;.</span></span><br><span class="line">    <span class="keyword">if</span> (mData != <span class="keyword">null</span>) {</span><br><span class="line">      releaseResources(mData);</span><br><span class="line">      mData = <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The Loader is being reset, so we should stop monitoring for changes.</span></span><br><span class="line">    <span class="keyword">if</span> (mObserver != <span class="keyword">null</span>) {</span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> unregister the observer</span></span><br><span class="line">      mObserver = <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCanceled</span><span class="params">(List&lt;SampleItem&gt; data)</span> </span>{</span><br><span class="line">    <span class="comment">// Attempt to cancel the current asynchronous load.</span></span><br><span class="line">    <span class="keyword">super</span>.onCanceled(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The load has been canceled, so we should release the resources</span></span><br><span class="line">    <span class="comment">// associated with &apos;data&apos;.</span></span><br><span class="line">    releaseResources(data);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">releaseResources</span><span class="params">(List&lt;SampleItem&gt; data)</span> </span>{</span><br><span class="line">    <span class="comment">// For a simple List, there is nothing to do. For something like a Cursor, we </span></span><br><span class="line">    <span class="comment">// would close it in this method. All resources associated with the Loader</span></span><br><span class="line">    <span class="comment">// should be released here.</span></span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*********************************************************************/</span></span><br><span class="line">  <span class="comment">/** (4) Observer which receives notifications when the data changes **/</span></span><br><span class="line">  <span class="comment">/*********************************************************************/</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// <span class="doctag">NOTE:</span> Implementing an observer is outside the scope of this post (this example</span></span><br><span class="line">  <span class="comment">// uses a made-up &quot;SampleObserver&quot; to illustrate when/where the observer should </span></span><br><span class="line">  <span class="comment">// be initialized). </span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// The observer could be anything so long as it is able to detect content changes</span></span><br><span class="line">  <span class="comment">// and report them to the loader with a call to onContentChanged(). For example,</span></span><br><span class="line">  <span class="comment">// if you were writing a Loader which loads a list of all installed applications</span></span><br><span class="line">  <span class="comment">// on the device, the observer could be a BroadcastReceiver that listens for the</span></span><br><span class="line">  <span class="comment">// ACTION_PACKAGE_ADDED intent, and calls onContentChanged() on the particular </span></span><br><span class="line">  <span class="comment">// Loader whenever the receiver detects that a new application has been installed.</span></span><br><span class="line">  <span class="comment">// Please don&#x2019;t hesitate to leave a comment if you still find this confusing! :)</span></span><br><span class="line">  <span class="keyword">private</span> SampleObserver mObserver;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="handlerthread&#x7C7B;"><a href="#HandlerThread&#x7C7B;" class="headerlink" title="HandlerThread&#x7C7B;"></a>HandlerThread&#x7C7B;</h3><p>&#x8BE5;Thread&#x5185;&#x81EA;&#x52A8;&#x521B;&#x5EFA;Handler&#xFF0C;&#x7531;&#x4E8E;&#x5176;run()&#x662F;&#x4E00;&#x4E2A;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x65B9;&#x6CD5;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x624B;&#x52A8;&#x4F7F;&#x7528;quit()&#x6216;quitSafely()&#x65B9;&#x6CD5;&#x7EC8;&#x6B62;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF0C;&#x5176;&#x6E90;&#x7801;HandlerThread#run&#x65B9;&#x6CD5;&#xFF1A;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">    mTid = Process.myTid();</span><br><span class="line">    Looper.prepare();</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) {</span><br><span class="line">        mLooper = Looper.myLooper();</span><br><span class="line">        notifyAll();</span><br><span class="line">    }</span><br><span class="line">    Process.setThreadPriority(mPriority);</span><br><span class="line">    onLooperPrepared();</span><br><span class="line">    Looper.loop();</span><br><span class="line">    mTid = -<span class="number">1</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h3 id="intentservice&#x7C7B;"><a href="#IntentService&#x7C7B;" class="headerlink" title="IntentService&#x7C7B;"></a>IntentService&#x7C7B;</h3><p>IntentService&#x5185;&#x90E8;&#x4F7F;&#x7528;HandlerThread&#x5B9E;&#x73B0;&#x4E86;&#x957F;&#x8017;&#x65F6;&#x4EFB;&#x52A1;&#x5728;&#x540E;&#x53F0;&#x7EBF;&#x7A0B;&#x8FD0;&#x884C;&#x7684;&#x573A;&#x666F;&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x53EA;&#x9700;Override&#x5176;<figure class="highlight plain"><figcaption><span>intent)```&#x5373;&#x53EF;&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x6CE8;&#x610F;&#x4EE5;&#x4E0B;&#x51E0;&#x70B9;&#xFF1A;  </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. &#x4E0D;&#x80FD;&#x76F4;&#x63A5;&#x4E0E;UI&#x4EA4;&#x4E92;&#xFF0C;&#x901A;&#x5E38;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;broadcast&#x5B9E;&#x73B0;</span><br><span class="line">2. &#x4EFB;&#x52A1;&#x662F;&#x987A;&#x5E8F;&#x6267;&#x884C;&#x7684;&#xFF0C;&#x6240;&#x6709;&#x4EFB;&#x52A1;&#x6267;&#x884C;&#x5B8C;&#x6BD5;&#x540E;&#x81EA;&#x52A8;&#x5173;&#x95ED;service</span><br><span class="line">3. &#x4EFB;&#x52A1;&#x65E0;&#x6CD5;&#x4E2D;&#x65AD;</span><br><span class="line"></span><br><span class="line">&#x5176;&#x5173;&#x952E;&#x6E90;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</span><br><span class="line"></span><br><span class="line">``` java</span><br><span class="line">    public abstract class IntentService extends Service {</span><br><span class="line">        ...</span><br><span class="line">        @Override</span><br><span class="line">        public void onCreate() {</span><br><span class="line">            ...</span><br><span class="line">            HandlerThread thread = new HandlerThread(&quot;IntentService[&quot; + mName + &quot;]&quot;);</span><br><span class="line">            thread.start();</span><br><span class="line"></span><br><span class="line">            mServiceLooper = thread.getLooper();</span><br><span class="line">            mServiceHandler = new ServiceHandler(mServiceLooper);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onStart(Intent intent, int startId) {</span><br><span class="line">            Message msg = mServiceHandler.obtainMessage();</span><br><span class="line">            msg.arg1 = startId;</span><br><span class="line">            msg.obj = intent;</span><br><span class="line">            mServiceHandler.sendMessage(msg);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        private final class ServiceHandler extends Handler {</span><br><span class="line">            public ServiceHandler(Looper looper) {</span><br><span class="line">                super(looper);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void handleMessage(Message msg) {</span><br><span class="line">            onHandleIntent((Intent)msg.obj);</span><br><span class="line">            stopSelf(msg.arg1);</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        @Override</span><br><span class="line">        public void onDestroy() {</span><br><span class="line">            mServiceLooper.quit();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * This method is invoked on the worker thread with a request to process.</span><br><span class="line">         * Only one Intent is processed at a time, but the processing happens on a</span><br><span class="line">         * worker thread that runs independently from other application logic.</span><br><span class="line">         * So, if this code takes a long time, it will hold up other requests to</span><br><span class="line">         * the same IntentService, but it will not hold up anything else.</span><br><span class="line">         * When all requests have been handled, the IntentService stops itself,</span><br><span class="line">         * so you should not call {@link #stopSelf}.</span><br><span class="line">         *</span><br><span class="line">         * @param intent The value passed to {@link</span><br><span class="line">         *               android.content.Context#startService(Intent)}.</span><br><span class="line">         */</span><br><span class="line">        @WorkerThread</span><br><span class="line">        protected abstract void onHandleIntent(Intent intent);</span><br><span class="line">        ...</span><br><span class="line">    }</span><br></pre></td></tr></table></figure></p><h3 id="&#x7EBF;&#x7A0B;&#x6C60;threadpoolexecutor"><a href="#&#x7EBF;&#x7A0B;&#x6C60;ThreadPoolExecutor" class="headerlink" title="&#x7EBF;&#x7A0B;&#x6C60;ThreadPoolExecutor"></a>&#x7EBF;&#x7A0B;&#x6C60;ThreadPoolExecutor</h3><p>&#x5BF9;Java&#x63D0;&#x4F9B;&#x7684;&#x7EBF;&#x7A0B;&#x6C60;&#x603B;&#x7ED3;&#xFF0C;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#x53C2;&#x89C1;Oracle&#x6587;&#x6863;(<a href="#reference_4">&#x53C2;&#x8003;[4]</a>)&#x3002;</p><p>&#x5176;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF1A;<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor(<span class="keyword">int</span> corePoolSize, <span class="keyword">int</span> maximumPoolSize, <span class="keyword">long</span> keepAliveTime, TimeUnit unit,</span><br><span class="line">BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler)</span><br></pre></td></tr></table></figure></p><p>&#x5176;&#x4E2D;&#xFF0C;workQueue&#x6709;&#x4E09;&#x4E2D;&#x7B56;&#x7565;&#xFF1A;</p><table><thead><tr><th style="text-align:left">strategy</th><th style="text-align:left">example</th></tr></thead><tbody><tr><td style="text-align:left">Direct handoffs</td><td style="text-align:left">SynchronousQueue</td></tr><tr><td style="text-align:left">Unbounded queues</td><td style="text-align:left">LinkedBlockingQueue</td></tr><tr><td style="text-align:left">Bounded queues</td><td style="text-align:left">ArrayBlockingQueue</td></tr></tbody></table><p>Rejected tasks strategy&#xFF1A;</p><table><thead><tr><th style="text-align:left">strategy</th><th style="text-align:left">explanation</th></tr></thead><tbody><tr><td style="text-align:left">ThreadPoolExecutor.AbortPolicy</td><td style="text-align:left">default&#xFF0C;throw RejectedExecutionException upon</td></tr><tr><td style="text-align:left">ThreadPoolExecutor.CallerRunsPolicy</td><td style="text-align:left">the thread that invokes execute itself runs the task</td></tr><tr><td style="text-align:left">ThreadPoolExecutor.DiscardPolicy</td><td style="text-align:left">a task that cannot be executed is simply dropped</td></tr><tr><td style="text-align:left">ThreadPoolExecutor.DiscardOldestPolicy</td><td style="text-align:left">discards the oldest unhandled request and then retries execute</td></tr></tbody></table><p><strong>&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#xFF1A;</strong></p><ol><li>&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x6570;&#x5C0F;&#x4E8E;corePoolSize&#x65F6;&#xFF0C;&#x76F4;&#x63A5;&#x542F;&#x52A8;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4EFB;&#x52A1;</li><li>&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x6570;&#x5C0F;&#x4E8E;&#x7B49;&#x4E8E;corePoolSize&#x65F6;&#xFF0C;&#x4EFB;&#x52A1;&#x63D2;&#x5165;&#x4EFB;&#x52A1;&#x961F;&#x5217;</li><li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x5DF2;&#x6EE1;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x6570;&#x5C0F;&#x4E8E;maximumPoolSize&#x65F6;&#xFF0C;&#x542F;&#x52A8;&#x975E;&#x6838;&#x5FC3;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4EFB;&#x52A1;</li><li>&#x5982;&#x679C;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x5DF2;&#x6EE1;&#xFF0C;&#x7EBF;&#x7A0B;&#x6C60;&#x4E2D;&#x7EBF;&#x7A0B;&#x6570;&#x7B49;&#x4E8E;maximumPoolSize&#x65F6;&#xFF0C;&#x8C03;&#x7528;RejectedExecutionHandler&#x8FDB;&#x884C;&#x901A;&#x77E5;</li></ol><p><strong>&#x56DB;&#x79CD;&#x5E38;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x6784;&#x9020;&#x53C2;&#x6570;&#xFF1A;</strong></p><table><thead><tr><th style="text-align:left">Type</th><th style="text-align:left">corePoolSize</th><th style="text-align:left">maximumPoolSize</th><th style="text-align:left">keepAliveTime</th><th style="text-align:left">unit</th><th style="text-align:left">workQueue</th></tr></thead><tbody><tr><td style="text-align:left">newFixedThreadPool</td><td style="text-align:left">nThreads</td><td style="text-align:left">nThreads</td><td style="text-align:left">0L</td><td style="text-align:left">TimeUnit.MILLISECONDS</td><td style="text-align:left">new LinkedBlockingQueue<runnable>()</runnable></td></tr><tr><td style="text-align:left">newSingleThreadExecutor</td><td style="text-align:left">1</td><td style="text-align:left">1</td><td style="text-align:left">0L</td><td style="text-align:left">TimeUnit.MILLISECONDS</td><td style="text-align:left">new LinkedBlockingQueue<runnable>()</runnable></td></tr><tr><td style="text-align:left">newCachedThreadPool</td><td style="text-align:left">0</td><td style="text-align:left">Integer.MAX_VALUE</td><td style="text-align:left">60L</td><td style="text-align:left">TimeUnit.SECONDS</td><td style="text-align:left">new SynchronousQueue<runnable>()</runnable></td></tr><tr><td style="text-align:left">newScheduledThreadPool</td><td style="text-align:left">corePoolSize</td><td style="text-align:left">Integer.MAX_VALUE</td><td style="text-align:left">10L</td><td style="text-align:left">MILLISECONDS</td><td style="text-align:left">new DelayedWorkQueue()</td></tr></tbody></table><h3 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h3><p><a name="reference_1"></a>[1] <a href="http://saurabhsharma123k.blogspot.com/2013/11/android-loader-versus-asynctask.html" target="_blank" rel="noopener">http://saurabhsharma123k.blogspot.com/2013/11/android-loader-versus-asynctask.html</a><br><a name="reference_2"></a>[2] <a href="https://developer.android.com/guide/components/loaders.html" target="_blank" rel="noopener">https://developer.android.com/guide/components/loaders.html</a><br><a name="reference_3"></a>[3] <a href="http://www.androiddesignpatterns.com/2012/08/implementing-loaders.html" target="_blank" rel="noopener">http://www.androiddesignpatterns.com/2012/08/implementing-loaders.html</a><br><a name="reference_4"></a>[4] <a href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ThreadPoolExecutor.html" target="_blank" rel="noopener">http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ThreadPoolExecutor.html</a><br>[5] <a href="https://developer.android.com/guide/components/processes-and-threads.html" target="_blank" rel="noopener">https://developer.android.com/guide/components/processes-and-threads.html</a><br>[6] <a href="https://developer.android.com/training/run-background-service/index.html" target="_blank" rel="noopener">https://developer.android.com/training/run-background-service/index.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#asynctask类&quot;&gt;AsyncTask类&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#loaders框架&quot;&gt;Loaders框架&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#handlerthread类&quot;&gt;HandlerThread类&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#intentservice类&quot;&gt;IntentService类&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#线程池threadpoolexecutor&quot;&gt;线程池ThreadPoolExecutor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#参考&quot;&gt;参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
&lt;p&gt;APK启动时会执行ActivityThread中main()方法，其中创建ActivityThread的线程作为主线程，由于该线程主要与UI交互相关，所以称为UI线程；UI线程中不能执行耗时操作，否则容易引起ANR，所以Google建议开启worker thread执行耗时操作，然后通过Handler机制通知主线程刷新UI。系统提供三种方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Activity.runOnUiThread(Runnable)&lt;/li&gt;
&lt;li&gt;View.post(Runnable)&lt;/li&gt;
&lt;li&gt;View.postDelayed(Runnable,long)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;使得worker thread中方便的刷新View，但上述方法不便于管理。针对这种场景，系统对Handler机制进行一定轻量级封装，方便worker thread通知主线程，我们主要分析以下几个类：&lt;/p&gt;
    
    </summary>
    
      <category term="Android学习笔记" scheme="http://yoursite.com/categories/Android%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
</feed>
